<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>copy-3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="16072024 copy 3_files/libs/clipboard/clipboard.min.js"></script>
<script src="16072024 copy 3_files/libs/quarto-html/quarto.js"></script>
<script src="16072024 copy 3_files/libs/quarto-html/popper.min.js"></script>
<script src="16072024 copy 3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="16072024 copy 3_files/libs/quarto-html/anchor.min.js"></script>
<link href="16072024 copy 3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="16072024 copy 3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="16072024 copy 3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="16072024 copy 3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="16072024 copy 3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import anubisPlotUtils as anPlot</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hist <span class="im">as</span> hi</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> colors</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>matplotlib.use(<span class="st">'TkAgg'</span>)  <span class="co"># or 'Qt5Agg', 'GTK3Agg', etc.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mplhep <span class="im">as</span> hep</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>hep.style.use([hep.style.ATLAS])</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># import ANUBIS_triggered_functions as ANT</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.backends.backend_pdf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> MultipleLocator</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy.stats import normpip install pillow</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, <span class="st">'Osiris Temp\processing\python'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rawFileReader</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> groupby</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cProfile</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pstats</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:26: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:26: SyntaxWarning: invalid escape sequence '\p'
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\3398728753.py:26: SyntaxWarning: invalid escape sequence '\p'
  sys.path.insert(1, 'Osiris Temp\processing\python')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> rpcHit():</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, channel, time, eta, event_num, rpc):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rpc <span class="op">=</span> rpc</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.time <span class="op">=</span> time</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.channel <span class="op">=</span> channel</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eta <span class="op">=</span> eta</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.event_num <span class="op">=</span> event_num</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"rpcHit(channel=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>channel<span class="sc">}</span><span class="ss">, time=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>time<span class="sc">}</span><span class="ss">, eta=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>eta<span class="sc">}</span><span class="ss">, event_num=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>event_num<span class="sc">}</span><span class="ss">, rpc=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>rpc<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> rpcCoincidence():</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, event_num, time_bin, hits):</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.event_num <span class="op">=</span> event_num</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.time_bin <span class="op">=</span> time_bin</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hits <span class="op">=</span> hits</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"rpcCoincidence(event_num=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>event_num<span class="sc">}</span><span class="ss">, time_bin=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>time_bin<span class="sc">}</span><span class="ss">, hits=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>hits<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> realigner():</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, fReader, max_process_event, adjustment <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                interval <span class="op">=</span> <span class="dv">100</span>, monitor_factor <span class="op">=</span> <span class="dv">3</span>, window_size <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]], scDiffs <span class="op">=</span> [], normDiffs <span class="op">=</span> [],</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                residEta <span class="op">=</span> [] ,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                residPhi <span class="op">=</span> [] , record_inserted_events <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                tof_correction <span class="op">=</span> <span class="va">False</span>, diffHists <span class="op">=</span> [],</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                successful_reconstructed_coords <span class="op">=</span> [],</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                failed_reconstructed_coords <span class="op">=</span> [], possible_reconstructions_coords <span class="op">=</span> [],</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)],</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                dev_mode <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.events <span class="op">=</span> []</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.popt <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.temp_events <span class="op">=</span> []</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.event_chunk <span class="op">=</span> []</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.global_alignment <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.globally_aligned_events <span class="op">=</span> []</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.globally_aligned_mets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(order))]</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.interval <span class="op">=</span> interval</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lastWasBad <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adjustment <span class="op">=</span> adjustment</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.order <span class="op">=</span> order</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fReader <span class="op">=</span> fReader</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.updates <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(order))]</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(order))]</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.offsetlist <span class="op">=</span> [p <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, (<span class="dv">4</span> <span class="op">+</span> <span class="va">self</span>.adjustment)) <span class="cf">for</span> p <span class="kw">in</span> (o, <span class="op">-</span>o)]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processedEvents <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_process_event <span class="op">=</span> max_process_event</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.insertion_list <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.debug_statement <span class="op">=</span> dev_mode</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tdc3status <span class="op">=</span> [<span class="va">True</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lasttdc3Status <span class="op">=</span> [<span class="va">True</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]  </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tdc_mets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.monitor_factor <span class="op">=</span> monitor_factor</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.etaHits <span class="op">=</span> etaHits</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.phiHits <span class="op">=</span> phiHits</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tol <span class="op">=</span> [<span class="dv">15</span>]</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.window_size <span class="op">=</span> window_size</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.successful_reconstructions <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.tol))] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tof_correction <span class="op">=</span> tof_correction</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.possible_reconstructions <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> rppc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.record_inserted_events <span class="op">=</span> record_inserted_events</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.totDiffs <span class="op">=</span> {<span class="dv">0</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                <span class="dv">3</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>                <span class="dv">5</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nDiffs <span class="op">=</span> {<span class="dv">0</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">1</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">2</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">3</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">4</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">5</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> diffHists <span class="op">==</span> []:</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.diffHists <span class="op">=</span> {<span class="dv">0</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc0etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">1</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc1etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc2etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">3</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc3etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">4</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc4etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">5</span>:[[hi.Hist(hi.axis.Regular(bins<span class="op">=</span><span class="dv">376</span>, start<span class="op">=-</span><span class="fl">150.4</span>, stop<span class="op">=</span><span class="fl">150.4</span>, name<span class="op">=</span><span class="st">"rpc5etPhiDiff"</span>)) <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.diffHists <span class="op">=</span> diffHists</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residEta <span class="op">=</span> residEta</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residPhi <span class="op">=</span> residPhi</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scDiffs <span class="op">==</span> []:</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.scDiffs <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.normDiffs <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.scDiffs <span class="op">=</span> scDiffs</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.normDiffs <span class="op">=</span> normDiffs</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chi2 <span class="op">=</span> []</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.event_of_interest <span class="op">=</span> []</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.event_hist <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> successful_reconstructed_coords <span class="op">==</span> []:</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.successful_reconstructed_coords <span class="op">=</span> {<span class="dv">0</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>                <span class="dv">3</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                <span class="dv">5</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.successful_reconstructed_coords <span class="op">=</span> successful_reconstructed_coords</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> failed_reconstructed_coords <span class="op">==</span> []:</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.failed_reconstructed_coords <span class="op">=</span> {<span class="dv">0</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                <span class="dv">3</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                <span class="dv">5</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.failed_reconstructed_coords <span class="op">=</span> failed_reconstructed_coords</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> possible_reconstructions_coords <span class="op">==</span> []:</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.possible_reconstructions_coords <span class="op">=</span> {<span class="dv">0</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                <span class="dv">1</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>                <span class="dv">3</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                <span class="dv">5</span>:[[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.possible_reconstructions_coords <span class="op">=</span> possible_reconstructions_coords</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.recorded <span class="op">=</span> []</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.count <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.count2 <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rpc_involvement <span class="op">=</span> {i: [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">6</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)}</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cluster_sizes <span class="op">=</span> []</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.successful_cluster_size <span class="op">=</span> []</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eta_histogram <span class="op">=</span> np.zeros(<span class="bu">len</span>(np.arange(<span class="op">-</span><span class="fl">90.5</span>, <span class="fl">91.5</span>, <span class="dv">1</span>)) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.phi_histogram <span class="op">=</span> np.zeros(<span class="bu">len</span>(np.arange(<span class="op">-</span><span class="fl">90.5</span>, <span class="fl">91.5</span>, <span class="dv">1</span>)) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.solid_theta_histogram <span class="op">=</span> np.zeros(<span class="bu">len</span>(np.arange(<span class="op">-</span><span class="fl">180.5</span>, <span class="fl">181.5</span>, <span class="dv">1</span>)) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.solid_phi_histogram <span class="op">=</span> np.zeros(<span class="bu">len</span>(np.arange(<span class="op">-</span><span class="fl">180.5</span>, <span class="fl">181.5</span>, <span class="dv">1</span>)) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.frequency_dict <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dT <span class="op">=</span> []</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.recon <span class="op">=</span> []</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.TDC_error_time <span class="op">=</span> [[] <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.TDC_alignment_time <span class="op">=</span> [[] <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.thisTDC <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.only_header <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.only_header_values <span class="op">=</span> []  </span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processed_event_values <span class="op">=</span> []</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tdc_event_number <span class="op">=</span> [[] <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.count_entries <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_aligned_events(<span class="va">self</span>, mode <span class="op">=</span> <span class="st">'efficient'</span>, method <span class="op">=</span> <span class="st">'giveup'</span>, chi2_region <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">100</span>], plot_hist <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.processedEvents<span class="op">&lt;</span><span class="va">self</span>.max_process_event:</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.fReader.readBlock():</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Bad Block Read"</span>)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">self</span>.fReader.hasEvents()):</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.fReader.getEvents():</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.events.append(event)</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.temp_events.append(event)</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.processedEvents <span class="op">=</span> <span class="va">self</span>.processedEvents<span class="op">+</span><span class="dv">1</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.processedEvents <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.processedEvents<span class="op">%</span><span class="va">self</span>.interval<span class="op">==</span><span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.processedEvents<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.event_chunk <span class="op">=</span> <span class="va">self</span>.temp_events[<span class="op">-</span><span class="va">self</span>.interval:]</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>                        aligned, realigned <span class="op">=</span> <span class="va">self</span>.doRealign(method <span class="op">=</span> method)</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.check_alignment_status(aligned, realigned) </span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.update_adjustment_window(realigned)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.find_tdc_event_count()</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.only_header_values.append(<span class="va">self</span>.only_header)</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.processed_event_values.append(<span class="va">self</span>.processedEvents)</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="va">self</span>.global_alignment <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># self.readTDCTimeDiffs()</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.populate_hits()</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>                            status, failure <span class="op">=</span> <span class="va">self</span>.check_eta_trigger()</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># if status == False:</span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#     print(f'failure, processed Evenets : {self.processedEvents}, failed event : {failure[0]}')</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#     self.recorded.append(self.etaHits)</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>                            cluster <span class="op">=</span> <span class="va">self</span>.make_cluster()</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># for coincident_event_clustered in cluster:</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#     self.cluster_sizes.append(self.get_cluster_sizes(coincident_event_clustered))</span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># print(len(cluster))</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.reconstruct_and_extrapolate(cluster, chi2_region <span class="op">=</span> chi2_region, plot_hist<span class="op">=</span>plot_hist, angle_extraction <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># self.reconstruct_and_findtof(cluster)</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># filtered_events = filter_events(cluster,1,6)</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># self.extract_angles_phi_eta_timed_DZ_modified(filtered_events)</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># self.temp_events.clear()</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># if mode != 'Full':</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#     self.events.clear()</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># if self.processedEvents % (self.interval * 200) == 0:</span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#         buffer = self.fReader.reload_event_builder()</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#         print(f'event builder reloaded, proof {buffer}')</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="va">self</span>.processedEvents<span class="op">%</span>(<span class="va">self</span>.monitor_factor <span class="op">*</span> <span class="va">self</span>.interval) <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.processedEvents<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.monitor_tdc3_state(recordtimes<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.temp_events.clear()</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> mode <span class="op">!=</span> <span class="st">'Full'</span>:</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>                                <span class="va">self</span>.events.clear()</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.outDict <span class="op">=</span> {<span class="st">'totDiffs'</span>:<span class="va">self</span>.totDiffs,</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'nDiffs'</span>:<span class="va">self</span>.nDiffs,</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'diffHists'</span>:<span class="va">self</span>.diffHists}  </span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_tdc_event_count(<span class="va">self</span>):</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>            tot_length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.event_chunk:</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>                length <span class="op">=</span> <span class="bu">len</span>(event.tdcEvents[tdc].words)</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>                tot_length <span class="op">+=</span> length</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tdc_event_number[tdc].append(tot_length)</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_event_count(<span class="va">self</span>):</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>            met <span class="op">=</span> <span class="va">self</span>.tdc_event_number[tdc]</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>            binsx <span class="op">=</span> [x <span class="op">*</span> <span class="va">self</span>.interval <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(met))]</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>            ax.plot(binsx, met, label<span class="op">=</span><span class="ss">f'TDC</span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="dv">0</span>, <span class="va">self</span>.max_process_event)</span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ax.set_ylim(-1, 100)</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'TDC number of events recorded'</span>)</span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'num of events'</span>)</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Processed Event'</span>)</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_frequency(<span class="va">self</span>):</span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>        list_tuple <span class="op">=</span> <span class="bu">tuple</span>(<span class="va">self</span>.insertion_list)</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.frequency_dict[list_tuple] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_cluster_sizes(<span class="va">self</span>, coincident_event_clustered):</span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>        event_clusters <span class="op">=</span> coincident_event_clustered[<span class="dv">2</span>]</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>        event_cluster_sizes <span class="op">=</span> []</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc <span class="kw">in</span> event_clusters:</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>            rpc_phi_clusters <span class="op">=</span> rpc[<span class="dv">0</span>]</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>            rpc_eta_clusters <span class="op">=</span> rpc[<span class="dv">1</span>]</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>            phi_cluster_sizes <span class="op">=</span> [<span class="bu">len</span>(cluster) <span class="cf">for</span> cluster <span class="kw">in</span> rpc_phi_clusters]</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>            eta_cluster_sizes <span class="op">=</span> [<span class="bu">len</span>(cluster) <span class="cf">for</span> cluster <span class="kw">in</span> rpc_eta_clusters]</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> phi_cluster_sizes:</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>                phi_cluster_sizes.append(<span class="dv">0</span>)</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> eta_cluster_sizes:</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>                eta_cluster_sizes.append(<span class="dv">0</span>)</span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>            event_cluster_sizes.append((phi_cluster_sizes, eta_cluster_sizes))</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> event_cluster_sizes </span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_aligned_events_timing_compensated(<span class="va">self</span>):</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.processedEvents<span class="op">&lt;</span><span class="va">self</span>.max_process_event:</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.fReader.readBlock():</span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Bad Block Read"</span>)</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">self</span>.fReader.hasEvents()):</span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.fReader.getEvents():</span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.events.append(event)</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.temp_events.append(event)</span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.processedEvents <span class="op">=</span> <span class="va">self</span>.processedEvents<span class="op">+</span><span class="dv">1</span></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.processedEvents<span class="op">%</span><span class="va">self</span>.interval<span class="op">==</span><span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.processedEvents<span class="op">!=</span><span class="dv">10500</span>:</span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.event_chunk <span class="op">=</span> <span class="va">self</span>.temp_events[<span class="op">-</span><span class="va">self</span>.interval:]</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>                        aligned, realigned <span class="op">=</span> <span class="va">self</span>.doRealign(method <span class="op">=</span> <span class="st">'giveup'</span>)</span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.check_alignment_status(aligned, realigned)</span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.update_adjustment_window(realigned)</span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="va">self</span>.global_alignment <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">print</span>(<span class="ss">f'global alignmend at </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>processedEvents<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.populate_hits()</span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.apply_systematic_correction()</span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>                            clustered <span class="op">=</span> <span class="va">self</span>.make_cluster()</span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># print(len(clustered))</span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.reconstruct_and_findtof(clustered)</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.temp_events.clear()</span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.events.clear()</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>    <span class="co"># def get_aligned_events_timing_compensated(self):</span></span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     while self.processedEvents &lt; self.max_process_event:</span></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         start_time = time.time()</span></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         if not self.fReader.readBlock():</span></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">#             print("Bad Block Read")</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    <span class="co">#             break</span></span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         read_block_time = time.time() - start_time</span></span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         start_time = time.time()</span></span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         if self.fReader.hasEvents():</span></span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>    <span class="co">#             has_events_time = time.time() - start_time</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    <span class="co">#             start_time = time.time()</span></span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>    <span class="co">#             for event in self.fReader.getEvents():</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                 self.events.append(event)</span></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                 self.temp_events.append(event)</span></span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                 self.processedEvents += 1</span></span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                 if self.processedEvents % self.interval == 0 and self.processedEvents &gt; 0:</span></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     self.event_chunk = self.temp_events[-self.interval:]</span></span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     start_time = time.time()</span></span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     aligned, realigned = self.doRealign(method='giveup')</span></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     realign_time = time.time() - start_time</span></span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     start_time = time.time()</span></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     self.check_alignment_status(aligned, realigned)</span></span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     check_alignment_status_time = time.time() - start_time</span></span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     start_time = time.time()</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     self.update_adjustment_window(realigned)</span></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     update_adjustment_window_time = time.time() - start_time</span></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                     if self.global_alignment:</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.etaHits = [[] for rpc in range(6)]</span></span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.phiHits = [[] for rpc in range(6)]</span></span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         print(f'global alignment at {self.processedEvents}')</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         start_time = time.time()</span></span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.populate_hits()</span></span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         populate_hits_time = time.time() - start_time</span></span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         start_time = time.time()</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.apply_systematic_correction()</span></span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         apply_systematic_correction_time = time.time() - start_time</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         start_time = time.time()</span></span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         clustered = self.make_cluster()</span></span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         make_cluster_time = time.time() - start_time</span></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         start_time = time.time()</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.reconstruct_and_findtof(clustered)</span></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         reconstruct_and_findtof_time = time.time() - start_time</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.temp_events.clear()</span></span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         self.events.clear()</span></span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         print(f'Timings:')</span></span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Read Block Time: {read_block_time:.6f} seconds')</span></span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Has Events Time: {has_events_time:.6f} seconds')</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Realign Time: {realign_time:.6f} seconds')</span></span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Check Alignment Status Time: {check_alignment_status_time:.6f} seconds')</span></span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Update Adjustment Window Time: {update_adjustment_window_time:.6f} seconds')</span></span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Populate Hits Time: {populate_hits_time:.6f} seconds')</span></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         # print(f'Apply Systematic Correction Time: {apply_systematic_correction_time:.6f} seconds')</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         print(f'Make Cluster Time: {make_cluster_time:.6f} seconds')</span></span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                         print(f'Reconstruct and Find TOF Time: {reconstruct_and_findtof_time:.6f} seconds')</span></span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_event(<span class="va">self</span>, event_num):</span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.processedEvents<span class="op">&lt;</span><span class="va">self</span>.max_process_event:</span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.fReader.readBlock():</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Bad Block Read"</span>)</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">self</span>.fReader.hasEvents()):</span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.fReader.getEvents():</span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.events.append(event)</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.temp_events.append(event)</span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.processedEvents <span class="op">=</span> <span class="va">self</span>.processedEvents<span class="op">+</span><span class="dv">1</span></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.processedEvents<span class="op">%</span><span class="va">self</span>.interval<span class="op">==</span><span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.processedEvents<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.event_chunk <span class="op">=</span> <span class="va">self</span>.temp_events[<span class="op">-</span><span class="va">self</span>.interval:]</span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>                        aligned, realigned <span class="op">=</span> <span class="va">self</span>.doRealign(method <span class="op">=</span> <span class="st">'giveup'</span>)</span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.check_alignment_status(aligned, realigned)</span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.update_adjustment_window(realigned)</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> idx, event <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.event_chunk):</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="va">self</span>.processedEvents <span class="op">+</span> idx <span class="op">==</span> event_num:</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>                                <span class="va">self</span>.event_chunk <span class="op">=</span> [event]</span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.temp_events.clear()</span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.events.clear()</span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.outDict = {'totDiffs':self.totDiffs,</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>        <span class="co">#             'nDiffs':self.nDiffs,</span></span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>        <span class="co">#             'diffHists':self.diffHists} </span></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> apply_systematic_correction(<span class="va">self</span>):</span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, etahit <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.etaHits[rpc]):</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.etaHits[rpc][i].time <span class="op">+=</span> <span class="va">self</span>.residEta[rpc][etahit.channel]</span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j , phihit <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.phiHits[rpc]):</span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.phiHits[rpc][j].time <span class="op">+=</span> <span class="va">self</span>.residPhi[rpc][phihit.channel]</span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> readTDCTimeDiffs(<span class="va">self</span>):</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.event_chunk:</span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>            rpcHits <span class="op">=</span> tdcEventToRPCData(event,activeTDCs<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>])</span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rpc <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]:</span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>                minEtaHit <span class="op">=</span> rpcHit(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="va">True</span>, <span class="va">self</span>.processedEvents, rpc)</span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>                minPhiHit <span class="op">=</span> rpcHit(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1000</span>,<span class="va">False</span>, <span class="va">self</span>.processedEvents, rpc)</span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> hit <span class="kw">in</span> rpcHits[rpc]:</span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> hit.time<span class="op">&gt;</span><span class="dv">150</span> <span class="kw">and</span> hit.time<span class="op">&lt;</span><span class="dv">300</span>:</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> hit.eta <span class="kw">and</span> hit.time<span class="op">&lt;</span>minEtaHit.time:</span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>                            minEtaHit <span class="op">=</span> hit</span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> hit.time<span class="op">&lt;</span>minPhiHit.time <span class="kw">and</span> <span class="kw">not</span> hit.eta:</span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>                            minPhiHit <span class="op">=</span> hit</span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> minEtaHit.channel<span class="op">&gt;-</span><span class="fl">0.5</span> <span class="kw">and</span> minPhiHit.channel<span class="op">&gt;-</span><span class="fl">0.5</span>:</span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.totDiffs[rpc][minPhiHit.channel][minEtaHit.channel] <span class="op">=</span> <span class="va">self</span>.totDiffs[rpc][minPhiHit.channel][minEtaHit.channel]<span class="op">+</span>minEtaHit.time<span class="op">-</span>minPhiHit.time</span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.nDiffs[rpc][minPhiHit.channel][minEtaHit.channel] <span class="op">=</span> <span class="va">self</span>.nDiffs[rpc][minPhiHit.channel][minEtaHit.channel]<span class="op">+</span><span class="dv">1</span></span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.diffHists[rpc][minPhiHit.channel][minEtaHit.channel].fill(minEtaHit.time<span class="op">-</span>minPhiHit.time)</span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> make_cluster(<span class="va">self</span>):</span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>        coincident_hits <span class="op">=</span> FindCoincidentHits(<span class="va">self</span>.etaHits, <span class="va">self</span>.phiHits, <span class="va">self</span>.window_size, tof_correction<span class="op">=</span><span class="va">self</span>.tof_correction)</span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>        clustered <span class="op">=</span> cluster(coincident_hits)</span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> clustered</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>    <span class="co"># def make_cluster(self):</span></span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     # Timing the FindCoincidentHits function</span></span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     start_time = time.time()</span></span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     coincident_hits = FindCoincidentHits(self.etaHits, self.phiHits, self.window_size, tof_correction=self.tof_correction)</span></span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     elapsed_time_find_hits = time.time() - start_time</span></span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     # Timing the cluster function</span></span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     start_time = time.time()</span></span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     clustered = cluster(coincident_hits)</span></span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     elapsed_time_cluster = time.time() - start_time</span></span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     # Print or store the elapsed times</span></span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(f"Time taken by FindCoincidentHits: {elapsed_time_find_hits:.6f} seconds")</span></span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     print(f"Time taken by cluster: {elapsed_time_cluster:.6f} seconds")</span></span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return clustered</span></span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_chess_board_reconstruction(<span class="va">self</span>):</span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>        success_events <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>        fail_events <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>        rpcNames <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ph <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> et <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.successful_reconstructed_coords[rpc][ph][et] <span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>                        total_successful <span class="op">=</span> <span class="va">self</span>.successful_reconstructed_coords[rpc][ph][et]</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>                        total_events <span class="op">=</span> <span class="va">self</span>.possible_reconstructions_coords[rpc][ph][et]</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> total_events <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>                            success_events[ph][et] <span class="op">=</span> total_successful <span class="op">/</span> total_events</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>:</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>                            success_events[ph][et] <span class="op">=</span> <span class="dv">0</span>  <span class="co"># No events, efficiency is 0</span></span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># if sum(self.failed_reconstructed_coords[rpc][ph][et].counts())&gt;0:</span></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#     fail_events[ph][et]=sum([thisVal*self.failed_reconstructed_coords[rpc][ph][et].axes.centers[0][idx] for idx, thisVal in enumerate(self.failed_reconstructed_coords[rpc][ph][et])])</span></span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>            etachannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>)]</span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>            phichannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">65</span>)]</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>            etaHist <span class="op">=</span> (success_events,np.array(phichannels),np.array(etachannels))</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>            zrange <span class="op">=</span> [<span class="dv">0</span>,<span class="bu">max</span>(<span class="bu">max</span>(row) <span class="cf">for</span> row <span class="kw">in</span> success_events)]</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>            thisHist <span class="op">=</span> hep.hist2dplot(etaHist,norm<span class="op">=</span>colors.Normalize(zrange[<span class="dv">0</span>],zrange[<span class="dv">1</span>]))</span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>            thisHist.cbar.set_label(<span class="st">'successful reconstructions / Possbile reconstruction'</span>, rotation<span class="op">=</span><span class="dv">270</span>, y<span class="op">=</span><span class="fl">0.3</span>,labelpad<span class="op">=</span><span class="dv">23</span>)</span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>            plt.ylim(<span class="fl">31.5</span>,<span class="op">-</span><span class="fl">0.5</span>)</span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">"Eta Channel"</span>)</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">"Phi Channel"</span>)</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>            ax.set_title(rpcNames[rpc])</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>            x_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">64.5</span>]</span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>            y_points <span class="op">=</span> [<span class="fl">7.5</span>, <span class="fl">15.5</span>, <span class="fl">23.5</span>]</span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> y_point <span class="kw">in</span> y_points:</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>                plt.plot(x_points, [y_point,y_point], <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>            y_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">31.5</span>]</span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>            x_points <span class="op">=</span> [<span class="fl">7.5</span>,<span class="fl">15.5</span>, <span class="fl">23.5</span>, <span class="fl">31.5</span>, <span class="fl">39.5</span>, <span class="fl">47.5</span>, <span class="fl">55.5</span>]</span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x_point <span class="kw">in</span> x_points:</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>                plt.plot([x_point,x_point], y_points, <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fig, ax = plt.subplots(1, figsize=(16, 8), dpi=100)</span></span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>            <span class="co"># etachannels = [x-0.5 for x in range(33)]</span></span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>            <span class="co"># phichannels = [x-0.5 for x in range(65)]</span></span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>            <span class="co"># etaHist = (fail_events,np.array(phichannels),np.array(etachannels))</span></span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>            <span class="co"># zrange = [0,max(max(row) for row in fail_events)]</span></span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>            <span class="co"># thisHist = hep.hist2dplot(etaHist,norm=colors.Normalize(zrange[0],zrange[1]))</span></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>            <span class="co"># thisHist.cbar.set_label('failed reconstructions', rotation=270, y=0.3,labelpad=23)</span></span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.ylim(31.5,-0.5)</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.ylabel("Eta Channel")</span></span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.xlabel("Phi Channel")</span></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ax.set_title(rpcNames[rpc])</span></span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>            <span class="co"># x_points = [-0.5, 64.5]</span></span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>            <span class="co"># y_points = [7.5, 15.5, 23.5]</span></span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>            <span class="co"># for y_point in y_points:</span></span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     plt.plot(x_points, [y_point,y_point], 'k', linestyle='dotted')</span></span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>            <span class="co"># y_points = [-0.5, 31.5]</span></span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>            <span class="co"># x_points = [7.5,15.5, 23.5, 31.5, 39.5, 47.5, 55.5]</span></span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>            <span class="co"># for x_point in x_points:</span></span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     plt.plot([x_point,x_point], y_points, 'k', linestyle='dashed')</span></span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.show()</span></span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_count_entries(<span class="va">self</span>):</span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>                plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>                plt.plot(<span class="va">self</span>.count_entries[rpc], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, label<span class="op">=</span><span class="ss">f'RPC </span><span class="sc">{</span>rpc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>                plt.title(<span class="ss">f'Numver of clusters for RPC </span><span class="sc">{</span>rpc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>                plt.xlabel(<span class="st">'event number'</span>)</span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>                plt.ylabel(<span class="st">'Count of clusters'</span>)</span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>                plt.legend()</span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>                plt.grid(<span class="va">True</span>)</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reconstruct_and_extrapolate(<span class="va">self</span>, dataset, chi2_region <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">100</span>], plot_hist <span class="op">=</span> <span class="va">False</span>, angle_extraction <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure RPC is a list, even if it's a single integer</span></span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.tdc3status[<span class="dv">3</span>] <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>                last_indices <span class="op">=</span> {}</span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the last index of each unique number at the 0th index</span></span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, data <span class="kw">in</span> <span class="bu">enumerate</span>(dataset):</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>                    key <span class="op">=</span> data[<span class="dv">0</span>]</span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>                    last_indices[key] <span class="op">=</span> i</span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, data <span class="kw">in</span> <span class="bu">enumerate</span>(dataset):</span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Only process the data if it is the last occurrence of its kind</span></span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="op">==</span> last_indices[data[<span class="dv">0</span>]]:</span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Extract the nested lists at the 2nd index</span></span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>                        nested_lists <span class="op">=</span> data[<span class="dv">2</span>]</span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> j, outer_list <span class="kw">in</span> <span class="bu">enumerate</span>(nested_lists):</span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>                            count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> inner_list <span class="kw">in</span> outer_list:</span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">for</span> sub_inner_list <span class="kw">in</span> inner_list:</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>                                    count <span class="op">+=</span> <span class="bu">len</span>(sub_inner_list)</span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.count_entries[j].append(count)</span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># E_recon = reconstruct_timed_Chi2_ByRPC(data, 3, rpc)</span></span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># if E_recon:</span></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#     if len(E_recon[2]) &gt;= 5:</span></span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#         if E_recon[4] &gt; chi2_region[0] and E_recon[4] &lt; chi2_region[1]:</span></span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             # self.chi2.append(E_recon[4])</span></span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             # self.event_of_interest.append(E_recon)</span></span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             # Adding this check to see if other 5 RPCs are in reconstructed event.</span></span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             # This is necessary to ensure the reconstructed path is accurate.</span></span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             muon_coords = does_muon_hit_RPC(E_recon[0], E_recon[1], rpc)</span></span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#             if muon_coords:</span></span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                 self.possible_reconstructions[rpc] += 1</span></span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                 self.possible_reconstructions_coords[rpc][int(muon_coords[0] / 2.7625)][int(muon_coords[1] / 2.9844)] += 1</span></span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                 for idx, t in enumerate(self.tol):</span></span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                     check = does_RPC_detect_muon(muon_coords, E_recon[7], t)</span></span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                     if check:</span></span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                         self.successful_reconstructions[rpc][idx] += 1</span></span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                         # if plot_hist:</span></span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                             # self.successful_reconstructed_coords[rpc][int(E_recon[7][0][0][0] / 2.7625)][int(E_recon[7][1][0][0] / 2.9844)].fill(1)</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                         self.successful_reconstructed_coords[rpc][int(muon_coords[0] / 2.7625)][int(muon_coords[1] / 2.9844)] += 1</span></span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                         self.successful_cluster_size.append(self.get_cluster_sizes(data))</span></span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reconstruct_and_findtof(<span class="va">self</span>, dataset, chi2_region <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">100</span>]):</span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, data <span class="kw">in</span> <span class="bu">enumerate</span>(dataset):</span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>                E_recon <span class="op">=</span> reconstruct_timed_Chi2_ByRPC(data, <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> E_recon:</span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">len</span>(E_recon[<span class="dv">2</span>]) <span class="op">&gt;=</span> <span class="dv">6</span>:</span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.dT.append(E_recon[<span class="dv">5</span>])</span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.recon.append(E_recon)</span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>                                            </span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a>                                                </span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>                                                </span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_angles_phi_eta_timed_DZ_modified(<span class="va">self</span>, filtered_events, max_length<span class="op">=</span><span class="va">None</span>, exact_length<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a>        angles_eta <span class="op">=</span> []</span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>        angles_phi <span class="op">=</span> []</span>
<span id="cb3-585"><a href="#cb3-585" aria-hidden="true" tabindex="-1"></a>        delta_times <span class="op">=</span> []</span>
<span id="cb3-586"><a href="#cb3-586" aria-hidden="true" tabindex="-1"></a>        dZ <span class="op">=</span> []</span>
<span id="cb3-587"><a href="#cb3-587" aria-hidden="true" tabindex="-1"></a>        chi2_values <span class="op">=</span> []</span>
<span id="cb3-588"><a href="#cb3-588" aria-hidden="true" tabindex="-1"></a>        solid_angle <span class="op">=</span> []</span>
<span id="cb3-589"><a href="#cb3-589" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-590"><a href="#cb3-590" aria-hidden="true" tabindex="-1"></a>        bin_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-591"><a href="#cb3-591" aria-hidden="true" tabindex="-1"></a>        eta_phi_bin_edges <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">90.5</span>, <span class="fl">91.5</span>, bin_size)</span>
<span id="cb3-592"><a href="#cb3-592" aria-hidden="true" tabindex="-1"></a>        solid_phi_bin_edges <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">180.5</span>, <span class="fl">181.5</span>, bin_size)</span>
<span id="cb3-593"><a href="#cb3-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-594"><a href="#cb3-594" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, filtered_event <span class="kw">in</span> <span class="bu">enumerate</span>(filtered_events):</span>
<span id="cb3-595"><a href="#cb3-595" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> reconstruct_timed_Chi2_modified(filtered_event, <span class="dv">3</span>, max_length<span class="op">=</span>max_length, exact_length<span class="op">=</span>exact_length)</span>
<span id="cb3-596"><a href="#cb3-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-597"><a href="#cb3-597" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-598"><a href="#cb3-598" aria-hidden="true" tabindex="-1"></a>                delta_times.append(result[<span class="dv">5</span>])</span>
<span id="cb3-599"><a href="#cb3-599" aria-hidden="true" tabindex="-1"></a>                chi2_values.append(result[<span class="dv">4</span>])</span>
<span id="cb3-600"><a href="#cb3-600" aria-hidden="true" tabindex="-1"></a>                dZ.append(result[<span class="dv">6</span>])</span>
<span id="cb3-601"><a href="#cb3-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-602"><a href="#cb3-602" aria-hidden="true" tabindex="-1"></a>                v_parr_eta <span class="op">=</span> np.array([<span class="dv">0</span>, result[<span class="dv">1</span>][<span class="dv">1</span>], result[<span class="dv">1</span>][<span class="dv">2</span>]])</span>
<span id="cb3-603"><a href="#cb3-603" aria-hidden="true" tabindex="-1"></a>                theta_eta <span class="op">=</span> np.arccos(np.dot(v_parr_eta, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]) <span class="op">/</span> np.linalg.norm(v_parr_eta))</span>
<span id="cb3-604"><a href="#cb3-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-605"><a href="#cb3-605" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> theta_eta <span class="op">&gt;</span> np.pi <span class="op">/</span> <span class="dv">2</span>:</span>
<span id="cb3-606"><a href="#cb3-606" aria-hidden="true" tabindex="-1"></a>                    theta_eta <span class="op">=</span> np.pi <span class="op">-</span> theta_eta</span>
<span id="cb3-607"><a href="#cb3-607" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v_parr_eta[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-608"><a href="#cb3-608" aria-hidden="true" tabindex="-1"></a>                    theta_eta <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-609"><a href="#cb3-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-610"><a href="#cb3-610" aria-hidden="true" tabindex="-1"></a>                angles_eta.append(theta_eta)</span>
<span id="cb3-611"><a href="#cb3-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-612"><a href="#cb3-612" aria-hidden="true" tabindex="-1"></a>                v_parr_phi <span class="op">=</span> np.array([result[<span class="dv">1</span>][<span class="dv">0</span>], <span class="dv">0</span>, result[<span class="dv">1</span>][<span class="dv">2</span>]])</span>
<span id="cb3-613"><a href="#cb3-613" aria-hidden="true" tabindex="-1"></a>                theta_phi <span class="op">=</span> np.arccos(np.dot(v_parr_phi, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]) <span class="op">/</span> np.linalg.norm(v_parr_phi))</span>
<span id="cb3-614"><a href="#cb3-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-615"><a href="#cb3-615" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> theta_phi <span class="op">&gt;</span> np.pi <span class="op">/</span> <span class="dv">2</span>:</span>
<span id="cb3-616"><a href="#cb3-616" aria-hidden="true" tabindex="-1"></a>                    theta_phi <span class="op">=</span> np.pi <span class="op">-</span> theta_phi</span>
<span id="cb3-617"><a href="#cb3-617" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v_parr_phi[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-618"><a href="#cb3-618" aria-hidden="true" tabindex="-1"></a>                    theta_phi <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-619"><a href="#cb3-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-620"><a href="#cb3-620" aria-hidden="true" tabindex="-1"></a>                angles_phi.append(theta_phi)</span>
<span id="cb3-621"><a href="#cb3-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-622"><a href="#cb3-622" aria-hidden="true" tabindex="-1"></a>                magnitude <span class="op">=</span> np.linalg.norm(result[<span class="dv">1</span>])</span>
<span id="cb3-623"><a href="#cb3-623" aria-hidden="true" tabindex="-1"></a>                theta <span class="op">=</span> np.arccos(result[<span class="dv">1</span>][<span class="dv">2</span>] <span class="op">/</span> <span class="op">-</span>magnitude)  <span class="co"># Polar angle</span></span>
<span id="cb3-624"><a href="#cb3-624" aria-hidden="true" tabindex="-1"></a>                phi <span class="op">=</span> np.arctan2(result[<span class="dv">1</span>][<span class="dv">1</span>], result[<span class="dv">1</span>][<span class="dv">0</span>])  <span class="co"># Azimuthal angle</span></span>
<span id="cb3-625"><a href="#cb3-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-626"><a href="#cb3-626" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Normalize phi to the range [-, ]</span></span>
<span id="cb3-627"><a href="#cb3-627" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> phi <span class="op">&gt;</span> np.pi:</span>
<span id="cb3-628"><a href="#cb3-628" aria-hidden="true" tabindex="-1"></a>                    phi <span class="op">-=</span> <span class="dv">2</span> <span class="op">*</span> np.pi</span>
<span id="cb3-629"><a href="#cb3-629" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> phi <span class="op">&lt;</span> <span class="op">-</span>np.pi:</span>
<span id="cb3-630"><a href="#cb3-630" aria-hidden="true" tabindex="-1"></a>                    phi <span class="op">+=</span> <span class="dv">2</span> <span class="op">*</span> np.pi</span>
<span id="cb3-631"><a href="#cb3-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-632"><a href="#cb3-632" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Convert angles to degrees</span></span>
<span id="cb3-633"><a href="#cb3-633" aria-hidden="true" tabindex="-1"></a>                theta_deg <span class="op">=</span> np.degrees(theta)</span>
<span id="cb3-634"><a href="#cb3-634" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-635"><a href="#cb3-635" aria-hidden="true" tabindex="-1"></a>                phi_deg <span class="op">=</span> np.degrees(phi)</span>
<span id="cb3-636"><a href="#cb3-636" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">-</span><span class="dv">90</span> <span class="op">==</span> phi_deg:</span>
<span id="cb3-637"><a href="#cb3-637" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.recorded.append(result)</span>
<span id="cb3-638"><a href="#cb3-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-639"><a href="#cb3-639" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Append the solid angle (theta, phi) to self.angles_solid</span></span>
<span id="cb3-640"><a href="#cb3-640" aria-hidden="true" tabindex="-1"></a>                solid_angle.append((theta_deg, phi_deg))</span>
<span id="cb3-641"><a href="#cb3-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-642"><a href="#cb3-642" aria-hidden="true" tabindex="-1"></a>        angles_eta_degrees <span class="op">=</span> [x <span class="op">*</span> (<span class="dv">180</span> <span class="op">/</span> np.pi) <span class="cf">for</span> x <span class="kw">in</span> angles_eta]</span>
<span id="cb3-643"><a href="#cb3-643" aria-hidden="true" tabindex="-1"></a>        angles_phi_degrees <span class="op">=</span> [x <span class="op">*</span> (<span class="dv">180</span> <span class="op">/</span> np.pi) <span class="cf">for</span> x <span class="kw">in</span> angles_phi]</span>
<span id="cb3-644"><a href="#cb3-644" aria-hidden="true" tabindex="-1"></a>        angles_solid_theta_degrees <span class="op">=</span> [x <span class="cf">for</span> x, y <span class="kw">in</span> solid_angle]</span>
<span id="cb3-645"><a href="#cb3-645" aria-hidden="true" tabindex="-1"></a>        angles_solid_phi_degrees <span class="op">=</span> [y <span class="cf">for</span> x, y <span class="kw">in</span> solid_angle]</span>
<span id="cb3-646"><a href="#cb3-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-647"><a href="#cb3-647" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eta_histogram <span class="op">+=</span> np.histogram(angles_eta_degrees, bins<span class="op">=</span>eta_phi_bin_edges)[<span class="dv">0</span>]</span>
<span id="cb3-648"><a href="#cb3-648" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.phi_histogram <span class="op">+=</span> np.histogram(angles_phi_degrees, bins<span class="op">=</span>eta_phi_bin_edges)[<span class="dv">0</span>]</span>
<span id="cb3-649"><a href="#cb3-649" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.solid_theta_histogram <span class="op">+=</span> np.histogram(angles_solid_theta_degrees, bins<span class="op">=</span>solid_phi_bin_edges)[<span class="dv">0</span>]</span>
<span id="cb3-650"><a href="#cb3-650" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.solid_phi_histogram <span class="op">+=</span> np.histogram(angles_solid_phi_degrees, bins<span class="op">=</span>solid_phi_bin_edges)[<span class="dv">0</span>]</span>
<span id="cb3-651"><a href="#cb3-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-652"><a href="#cb3-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-653"><a href="#cb3-653" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb3-654"><a href="#cb3-654" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_angle_distribution_absolute(<span class="va">self</span>):</span>
<span id="cb3-655"><a href="#cb3-655" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2, ax3, ax4) <span class="op">=</span> plt.subplots(<span class="dv">4</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">16</span>))</span>
<span id="cb3-656"><a href="#cb3-656" aria-hidden="true" tabindex="-1"></a>        bin_edges <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">90.5</span>, <span class="fl">91.5</span>, <span class="dv">1</span>)</span>
<span id="cb3-657"><a href="#cb3-657" aria-hidden="true" tabindex="-1"></a>        phi_edges <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">180.5</span>, <span class="fl">181.5</span>, <span class="dv">1</span>)</span>
<span id="cb3-658"><a href="#cb3-658" aria-hidden="true" tabindex="-1"></a>        ax1.bar(bin_edges[:<span class="op">-</span><span class="dv">1</span>], <span class="va">self</span>.eta_histogram, width<span class="op">=</span><span class="dv">1</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb3-659"><a href="#cb3-659" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(<span class="st">'eta Angles Histogram'</span>)</span>
<span id="cb3-660"><a href="#cb3-660" aria-hidden="true" tabindex="-1"></a>        ax1.set_xlabel(<span class="st">'eta Angle (degrees)'</span>)</span>
<span id="cb3-661"><a href="#cb3-661" aria-hidden="true" tabindex="-1"></a>        ax1.set_ylabel(<span class="st">'Counts'</span>)</span>
<span id="cb3-662"><a href="#cb3-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-663"><a href="#cb3-663" aria-hidden="true" tabindex="-1"></a>        ax2.bar(bin_edges[:<span class="op">-</span><span class="dv">1</span>], <span class="va">self</span>.phi_histogram, width<span class="op">=</span><span class="dv">1</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb3-664"><a href="#cb3-664" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'phi Angles Histogram'</span>)</span>
<span id="cb3-665"><a href="#cb3-665" aria-hidden="true" tabindex="-1"></a>        ax2.set_xlabel(<span class="st">'phi Angle (degrees)'</span>)</span>
<span id="cb3-666"><a href="#cb3-666" aria-hidden="true" tabindex="-1"></a>        ax2.set_ylabel(<span class="st">'Counts'</span>)</span>
<span id="cb3-667"><a href="#cb3-667" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-668"><a href="#cb3-668" aria-hidden="true" tabindex="-1"></a>        ax3.bar(phi_edges[:<span class="op">-</span><span class="dv">1</span>], <span class="va">self</span>.solid_theta_histogram, width<span class="op">=</span><span class="dv">1</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb3-669"><a href="#cb3-669" aria-hidden="true" tabindex="-1"></a>        ax3.set_title(<span class="st">'solid theta Angles Histogram'</span>)</span>
<span id="cb3-670"><a href="#cb3-670" aria-hidden="true" tabindex="-1"></a>        ax3.set_xlabel(<span class="st">'solid theta Angle (degrees)'</span>)</span>
<span id="cb3-671"><a href="#cb3-671" aria-hidden="true" tabindex="-1"></a>        ax3.set_ylabel(<span class="st">'Counts'</span>)</span>
<span id="cb3-672"><a href="#cb3-672" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-673"><a href="#cb3-673" aria-hidden="true" tabindex="-1"></a>        ax4.bar(phi_edges[:<span class="op">-</span><span class="dv">1</span>], <span class="va">self</span>.solid_phi_histogram, width<span class="op">=</span><span class="dv">1</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'edge'</span>)</span>
<span id="cb3-674"><a href="#cb3-674" aria-hidden="true" tabindex="-1"></a>        ax4.set_title(<span class="st">'solid phi Angles Histogram'</span>)</span>
<span id="cb3-675"><a href="#cb3-675" aria-hidden="true" tabindex="-1"></a>        ax4.set_xlabel(<span class="st">'solid phi Angle (degrees)'</span>)</span>
<span id="cb3-676"><a href="#cb3-676" aria-hidden="true" tabindex="-1"></a>        ax4.set_ylabel(<span class="st">'Counts'</span>)</span>
<span id="cb3-677"><a href="#cb3-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-678"><a href="#cb3-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-679"><a href="#cb3-679" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>                                                    </span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_eta_trigger(<span class="va">self</span>):</span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a>        event_counts <span class="op">=</span> {}</span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc_index, rpc_hits <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.etaHits):</span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>            unique_events_in_rpc <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> hit <span class="kw">in</span> rpc_hits:</span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>                unique_events_in_rpc.add(hit.event_num)</span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> event_num <span class="kw">in</span> unique_events_in_rpc:</span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> event_num <span class="kw">not</span> <span class="kw">in</span> event_counts:</span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>                    event_counts[event_num] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-694"><a href="#cb3-694" aria-hidden="true" tabindex="-1"></a>                event_counts[event_num] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-695"><a href="#cb3-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-696"><a href="#cb3-696" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> event_num, count <span class="kw">in</span> event_counts.items():</span>
<span id="cb3-697"><a href="#cb3-697" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.processedEvents<span class="op">&lt;</span><span class="dv">15000</span>:</span>
<span id="cb3-698"><a href="#cb3-698" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">&gt;=</span> <span class="dv">6</span>:</span>
<span id="cb3-699"><a href="#cb3-699" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.count[<span class="dv">6</span>].append(event_num)</span>
<span id="cb3-700"><a href="#cb3-700" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-701"><a href="#cb3-701" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.count[count].append(event_num)</span>
<span id="cb3-702"><a href="#cb3-702" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="dv">25000</span><span class="op">&lt;</span><span class="va">self</span>.processedEvents<span class="op">&lt;</span><span class="dv">40000</span>:</span>
<span id="cb3-703"><a href="#cb3-703" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">&gt;=</span> <span class="dv">6</span>:</span>
<span id="cb3-704"><a href="#cb3-704" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.count2[<span class="dv">6</span>].append(event_num)</span>
<span id="cb3-705"><a href="#cb3-705" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-706"><a href="#cb3-706" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.count2[count].append(event_num)</span>
<span id="cb3-707"><a href="#cb3-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-708"><a href="#cb3-708" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rpc_index, rpc_hits <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.etaHits):</span>
<span id="cb3-709"><a href="#cb3-709" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">any</span>(hit.event_num <span class="op">==</span> event_num <span class="cf">for</span> hit <span class="kw">in</span> rpc_hits):</span>
<span id="cb3-710"><a href="#cb3-710" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> count <span class="op">&gt;=</span> <span class="dv">6</span>:</span>
<span id="cb3-711"><a href="#cb3-711" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.rpc_involvement[<span class="dv">6</span>][rpc_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-712"><a href="#cb3-712" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-713"><a href="#cb3-713" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.rpc_involvement[count][rpc_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-714"><a href="#cb3-714" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(event_counts)</span></span>
<span id="cb3-715"><a href="#cb3-715" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processedEvents</span>
<span id="cb3-716"><a href="#cb3-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-717"><a href="#cb3-717" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for failed events (count &lt; 4)</span></span>
<span id="cb3-718"><a href="#cb3-718" aria-hidden="true" tabindex="-1"></a>        failed_events <span class="op">=</span> [(event_num, count) <span class="cf">for</span> event_num, count <span class="kw">in</span> event_counts.items() <span class="cf">if</span> count <span class="op">&lt;</span> <span class="dv">4</span>]</span>
<span id="cb3-719"><a href="#cb3-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-720"><a href="#cb3-720" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> failed_events:</span>
<span id="cb3-721"><a href="#cb3-721" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>, failed_events</span>
<span id="cb3-722"><a href="#cb3-722" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-723"><a href="#cb3-723" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span>, <span class="va">None</span></span>
<span id="cb3-724"><a href="#cb3-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-725"><a href="#cb3-725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_rpc_involvement_histogram(<span class="va">self</span>):</span>
<span id="cb3-726"><a href="#cb3-726" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-727"><a href="#cb3-727" aria-hidden="true" tabindex="-1"></a>        bar_width <span class="op">=</span> <span class="fl">0.1</span> </span>
<span id="cb3-728"><a href="#cb3-728" aria-hidden="true" tabindex="-1"></a>        index <span class="op">=</span> <span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb3-729"><a href="#cb3-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-730"><a href="#cb3-730" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, count <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">range</span>(<span class="dv">7</span>)):</span>
<span id="cb3-731"><a href="#cb3-731" aria-hidden="true" tabindex="-1"></a>            total <span class="op">=</span> <span class="bu">sum</span>(<span class="va">self</span>.rpc_involvement[count])</span>
<span id="cb3-732"><a href="#cb3-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-733"><a href="#cb3-733" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-734"><a href="#cb3-734" aria-hidden="true" tabindex="-1"></a>                normalized <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(<span class="va">self</span>.rpc_involvement[count])</span>
<span id="cb3-735"><a href="#cb3-735" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-736"><a href="#cb3-736" aria-hidden="true" tabindex="-1"></a>                normalized <span class="op">=</span> [rpc_count <span class="op">/</span> total <span class="cf">for</span> rpc_count <span class="kw">in</span> <span class="va">self</span>.rpc_involvement[count]]</span>
<span id="cb3-737"><a href="#cb3-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-738"><a href="#cb3-738" aria-hidden="true" tabindex="-1"></a>            plt.bar([x <span class="op">+</span> i <span class="op">*</span> bar_width <span class="cf">for</span> x <span class="kw">in</span> index], normalized, bar_width, label<span class="op">=</span><span class="ss">f'Count </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-739"><a href="#cb3-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-740"><a href="#cb3-740" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'RPC Number'</span>)</span>
<span id="cb3-741"><a href="#cb3-741" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Proportion of Events'</span>)</span>
<span id="cb3-742"><a href="#cb3-742" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Normalized RPC Involvement in Event Counts'</span>)</span>
<span id="cb3-743"><a href="#cb3-743" aria-hidden="true" tabindex="-1"></a>        plt.xticks([x <span class="op">+</span> bar_width <span class="op">*</span> <span class="dv">3</span> <span class="cf">for</span> x <span class="kw">in</span> index], index) </span>
<span id="cb3-744"><a href="#cb3-744" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-745"><a href="#cb3-745" aria-hidden="true" tabindex="-1"></a>        plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb3-746"><a href="#cb3-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-747"><a href="#cb3-747" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Display the plot</span></span>
<span id="cb3-748"><a href="#cb3-748" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-749"><a href="#cb3-749" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-750"><a href="#cb3-750" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb3-751"><a href="#cb3-751" aria-hidden="true" tabindex="-1"></a>                                                </span>
<span id="cb3-752"><a href="#cb3-752" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-753"><a href="#cb3-753" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_efficiency(<span class="va">self</span>, text <span class="op">=</span> <span class="st">'Efficiency vs Tolerance error state realign region qual == 0'</span>):</span>
<span id="cb3-754"><a href="#cb3-754" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-755"><a href="#cb3-755" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-756"><a href="#cb3-756" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.possible_reconstructions[RPC] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-757"><a href="#cb3-757" aria-hidden="true" tabindex="-1"></a>                efficiency <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.successful_reconstructions[RPC]]</span>
<span id="cb3-758"><a href="#cb3-758" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-759"><a href="#cb3-759" aria-hidden="true" tabindex="-1"></a>                efficiency <span class="op">=</span> [x <span class="op">/</span> <span class="va">self</span>.possible_reconstructions[RPC] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.successful_reconstructions[RPC]]</span>
<span id="cb3-760"><a href="#cb3-760" aria-hidden="true" tabindex="-1"></a>            plt.plot(<span class="va">self</span>.tol, efficiency, label<span class="op">=</span><span class="ss">f'RPC </span><span class="sc">{</span>RPC<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-761"><a href="#cb3-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-762"><a href="#cb3-762" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Tolerance'</span>)</span>
<span id="cb3-763"><a href="#cb3-763" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Efficiency'</span>)</span>
<span id="cb3-764"><a href="#cb3-764" aria-hidden="true" tabindex="-1"></a>        plt.title(text)</span>
<span id="cb3-765"><a href="#cb3-765" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-766"><a href="#cb3-766" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-767"><a href="#cb3-767" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-768"><a href="#cb3-768" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="va">self</span>.possible_reconstructions)</span>
<span id="cb3-769"><a href="#cb3-769" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb3-770"><a href="#cb3-770" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> populate_hits(<span class="va">self</span>):</span>
<span id="cb3-771"><a href="#cb3-771" aria-hidden="true" tabindex="-1"></a>        skip_event <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-772"><a href="#cb3-772" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, event <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.event_chunk):</span>
<span id="cb3-773"><a href="#cb3-773" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-774"><a href="#cb3-774" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> event.tdcEvents[tdc].qual <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb3-775"><a href="#cb3-775" aria-hidden="true" tabindex="-1"></a>                    skip_event <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-776"><a href="#cb3-776" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span> </span>
<span id="cb3-777"><a href="#cb3-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-778"><a href="#cb3-778" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> skip_event:</span>
<span id="cb3-779"><a href="#cb3-779" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span> </span>
<span id="cb3-780"><a href="#cb3-780" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-781"><a href="#cb3-781" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> word <span class="kw">in</span> event.tdcEvents[tdc].words:</span>
<span id="cb3-782"><a href="#cb3-782" aria-hidden="true" tabindex="-1"></a>                    rpc, thisHit <span class="op">=</span> tdcChanToRPCHit(word,tdc, <span class="va">self</span>.processedEvents <span class="op">+</span> idx)</span>
<span id="cb3-783"><a href="#cb3-783" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> thisHit.channel <span class="op">==</span> [<span class="dv">0</span>]:</span>
<span id="cb3-784"><a href="#cb3-784" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb3-785"><a href="#cb3-785" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> thisHit.eta:</span>
<span id="cb3-786"><a href="#cb3-786" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.etaHits[rpc].append(thisHit)</span>
<span id="cb3-787"><a href="#cb3-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-788"><a href="#cb3-788" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-789"><a href="#cb3-789" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.phiHits[rpc].append(thisHit)</span>
<span id="cb3-790"><a href="#cb3-790" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-791"><a href="#cb3-791" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_event_count_histogram(<span class="va">self</span>):</span>
<span id="cb3-792"><a href="#cb3-792" aria-hidden="true" tabindex="-1"></a>        event_counts <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">7</span></span>
<span id="cb3-793"><a href="#cb3-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-794"><a href="#cb3-794" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> count <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>):</span>
<span id="cb3-795"><a href="#cb3-795" aria-hidden="true" tabindex="-1"></a>            event_counts[count] <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.count[count])</span>
<span id="cb3-796"><a href="#cb3-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-797"><a href="#cb3-797" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-798"><a href="#cb3-798" aria-hidden="true" tabindex="-1"></a>        plt.bar(<span class="bu">range</span>(<span class="dv">7</span>), event_counts, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb3-799"><a href="#cb3-799" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'trigger Number'</span>)</span>
<span id="cb3-800"><a href="#cb3-800" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Number of Events'</span>)</span>
<span id="cb3-801"><a href="#cb3-801" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Histogram of Event Counts'</span>)</span>
<span id="cb3-802"><a href="#cb3-802" aria-hidden="true" tabindex="-1"></a>        plt.xticks(<span class="bu">range</span>(<span class="dv">7</span>)) </span>
<span id="cb3-803"><a href="#cb3-803" aria-hidden="true" tabindex="-1"></a>        plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb3-804"><a href="#cb3-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-805"><a href="#cb3-805" aria-hidden="true" tabindex="-1"></a>        label_text <span class="op">=</span> <span class="ss">f'Number of events probed: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>max_process_event<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb3-806"><a href="#cb3-806" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">0.95</span>, <span class="fl">0.95</span>, label_text, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'top'</span>, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">12</span>, bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>))</span>
<span id="cb3-807"><a href="#cb3-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-808"><a href="#cb3-808" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-809"><a href="#cb3-809" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb3-810"><a href="#cb3-810" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plotTDCTimeDiffs(<span class="va">self</span>, showplot <span class="op">=</span> <span class="va">True</span>, max_itr <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb3-811"><a href="#cb3-811" aria-hidden="true" tabindex="-1"></a>        badPhi <span class="op">=</span> {<span class="dv">0</span>:[],<span class="dv">1</span>:[],<span class="dv">2</span>:[<span class="dv">31</span>], <span class="dv">3</span>:[<span class="dv">0</span>],<span class="dv">4</span>:[<span class="dv">19</span>], <span class="dv">5</span>:[<span class="dv">31</span>]}</span>
<span id="cb3-812"><a href="#cb3-812" aria-hidden="true" tabindex="-1"></a>        badEta <span class="op">=</span> {<span class="dv">0</span>:[<span class="dv">29</span>,<span class="dv">30</span>,<span class="dv">31</span>],<span class="dv">1</span>:[<span class="dv">16</span>, <span class="dv">20</span>],<span class="dv">2</span>:[],<span class="dv">3</span>:[<span class="dv">20</span>, <span class="dv">31</span>],<span class="dv">4</span>:[], <span class="dv">5</span>:[]}</span>
<span id="cb3-813"><a href="#cb3-813" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residEtaLatest <span class="op">=</span> []</span>
<span id="cb3-814"><a href="#cb3-814" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.residPhiLatest <span class="op">=</span> []</span>
<span id="cb3-815"><a href="#cb3-815" aria-hidden="true" tabindex="-1"></a>        rpcNames <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb3-816"><a href="#cb3-816" aria-hidden="true" tabindex="-1"></a>        evtCount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-817"><a href="#cb3-817" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]:</span>
<span id="cb3-818"><a href="#cb3-818" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="fl">0.15204446322001586</span></span>
<span id="cb3-819"><a href="#cb3-819" aria-hidden="true" tabindex="-1"></a>            offSet <span class="op">=</span> <span class="fl">16.101626655986728</span></span>
<span id="cb3-820"><a href="#cb3-820" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ph <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-821"><a href="#cb3-821" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> et <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-822"><a href="#cb3-822" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">sum</span>(<span class="va">self</span>.outDict[<span class="st">'diffHists'</span>][rpc][ph][et].counts())<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-823"><a href="#cb3-823" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.scDiffs[ph][et]<span class="op">=</span><span class="bu">sum</span>([thisVal<span class="op">*</span><span class="va">self</span>.outDict[<span class="st">'diffHists'</span>][rpc][ph][et].axes.centers[<span class="dv">0</span>][idx] <span class="cf">for</span> idx, thisVal <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.outDict[<span class="st">'diffHists'</span>][rpc][ph][et])])<span class="op">/</span><span class="bu">sum</span>(<span class="va">self</span>.outDict[<span class="st">'diffHists'</span>][rpc][ph][et].counts())</span>
<span id="cb3-824"><a href="#cb3-824" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.normDiffs[ph][et]<span class="op">=</span><span class="va">self</span>.scDiffs[ph][et]<span class="op">+</span>slope<span class="op">*</span>(ph<span class="op">-</span>et)<span class="op">-</span>offSet</span>
<span id="cb3-825"><a href="#cb3-825" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-826"><a href="#cb3-826" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> showplot:</span>
<span id="cb3-827"><a href="#cb3-827" aria-hidden="true" tabindex="-1"></a>                fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-828"><a href="#cb3-828" aria-hidden="true" tabindex="-1"></a>                etachannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>)]</span>
<span id="cb3-829"><a href="#cb3-829" aria-hidden="true" tabindex="-1"></a>                phichannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">65</span>)]</span>
<span id="cb3-830"><a href="#cb3-830" aria-hidden="true" tabindex="-1"></a>                etaHist <span class="op">=</span> (<span class="va">self</span>.scDiffs,np.array(phichannels),np.array(etachannels))</span>
<span id="cb3-831"><a href="#cb3-831" aria-hidden="true" tabindex="-1"></a>                zrange <span class="op">=</span> [<span class="op">-</span><span class="dv">5</span>,<span class="dv">30</span>]</span>
<span id="cb3-832"><a href="#cb3-832" aria-hidden="true" tabindex="-1"></a>                thisHist <span class="op">=</span> hep.hist2dplot(etaHist,norm<span class="op">=</span>colors.Normalize(zrange[<span class="dv">0</span>],zrange[<span class="dv">1</span>]))</span>
<span id="cb3-833"><a href="#cb3-833" aria-hidden="true" tabindex="-1"></a>                thisHist.cbar.set_label(<span class="st">'$\eta$ hit time - $\phi$ hit time, Average (ns)'</span>, rotation<span class="op">=</span><span class="dv">270</span>, y<span class="op">=</span><span class="fl">0.3</span>,labelpad<span class="op">=</span><span class="dv">23</span>)</span>
<span id="cb3-834"><a href="#cb3-834" aria-hidden="true" tabindex="-1"></a>                plt.ylim(<span class="fl">31.5</span>,<span class="op">-</span><span class="fl">0.5</span>)</span>
<span id="cb3-835"><a href="#cb3-835" aria-hidden="true" tabindex="-1"></a>                plt.ylabel(<span class="st">"Eta Channel"</span>)</span>
<span id="cb3-836"><a href="#cb3-836" aria-hidden="true" tabindex="-1"></a>                plt.xlabel(<span class="st">"Phi Channel"</span>)</span>
<span id="cb3-837"><a href="#cb3-837" aria-hidden="true" tabindex="-1"></a>                ax.set_title(rpcNames[rpc])</span>
<span id="cb3-838"><a href="#cb3-838" aria-hidden="true" tabindex="-1"></a>                x_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">64.5</span>]</span>
<span id="cb3-839"><a href="#cb3-839" aria-hidden="true" tabindex="-1"></a>                y_points <span class="op">=</span> [<span class="fl">7.5</span>, <span class="fl">15.5</span>, <span class="fl">23.5</span>]</span>
<span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> y_point <span class="kw">in</span> y_points:</span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a>                    plt.plot(x_points, [y_point,y_point], <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>                y_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">31.5</span>]</span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a>                x_points <span class="op">=</span> [<span class="fl">7.5</span>,<span class="fl">15.5</span>, <span class="fl">23.5</span>, <span class="fl">31.5</span>, <span class="fl">39.5</span>, <span class="fl">47.5</span>, <span class="fl">55.5</span>]</span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> x_point <span class="kw">in</span> x_points:</span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a>                    plt.plot([x_point,x_point], y_points, <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a>                fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a>                normHist <span class="op">=</span> (<span class="va">self</span>.normDiffs,np.array(phichannels),np.array(etachannels))</span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>                zrange <span class="op">=</span> [<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>]</span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>                thisHist <span class="op">=</span> hep.hist2dplot(normHist,norm<span class="op">=</span>colors.Normalize(zrange[<span class="dv">0</span>],zrange[<span class="dv">1</span>]))</span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>                thisHist.cbar.set_label(<span class="st">'$\eta$ hit time - $\phi$ hit time, Average (ns)'</span>, rotation<span class="op">=</span><span class="dv">270</span>, y<span class="op">=</span><span class="fl">0.3</span>,labelpad<span class="op">=</span><span class="dv">23</span>)</span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a>                plt.ylim(<span class="fl">31.5</span>,<span class="op">-</span><span class="fl">0.5</span>)</span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>                plt.ylabel(<span class="st">"Eta Channel"</span>)</span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a>                plt.xlabel(<span class="st">"Phi Channel"</span>)</span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>                x_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">64.5</span>]</span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>                y_points <span class="op">=</span> [<span class="fl">7.5</span>, <span class="fl">15.5</span>, <span class="fl">23.5</span>]</span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> y_point <span class="kw">in</span> y_points:</span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a>                    plt.plot(x_points, [y_point,y_point], <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a>                y_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">31.5</span>]</span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>                x_points <span class="op">=</span> [<span class="fl">7.5</span>,<span class="fl">15.5</span>, <span class="fl">23.5</span>, <span class="fl">31.5</span>, <span class="fl">39.5</span>, <span class="fl">47.5</span>, <span class="fl">55.5</span>]</span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> x_point <span class="kw">in</span> x_points:</span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a>                    plt.plot([x_point,x_point], y_points, <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a>                ax.set_title(rpcNames[rpc]<span class="op">+</span><span class="st">", Propagation Time Corrected"</span>)</span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>            phTimes <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a>            etTimes <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)]</span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>            testSpeed <span class="op">=</span> <span class="fl">0.173</span></span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>            offSet <span class="op">=</span> <span class="fl">13.46</span>     </span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>            itr <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> etchan <span class="kw">not</span> <span class="kw">in</span> badEta[rpc]:</span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>                        phTimes[phchan] <span class="op">+=</span> <span class="va">self</span>.scDiffs[phchan][etchan] <span class="op">+</span> (<span class="op">-</span>etchan <span class="op">*</span> testSpeed <span class="op">+</span> phchan <span class="op">*</span> testSpeed <span class="op">-</span> offSet)</span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>                phTimes[phchan] <span class="op">/=</span> (<span class="fl">32.</span> <span class="op">-</span> <span class="bu">len</span>(badEta[rpc]))</span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a>            itr <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> phchan <span class="kw">not</span> <span class="kw">in</span> badPhi[rpc]:</span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>                        etTimes[etchan] <span class="op">+=</span> (<span class="va">self</span>.scDiffs[phchan][etchan] <span class="op">+</span> (<span class="op">-</span>etchan <span class="op">*</span> testSpeed <span class="op">+</span> phchan <span class="op">*</span> testSpeed <span class="op">-</span> offSet) <span class="op">-</span> phTimes[phchan]) <span class="op">/</span> (<span class="fl">64.</span> <span class="op">-</span> <span class="bu">len</span>(badPhi[rpc]))</span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a>            itr <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> itr <span class="op">&lt;=</span> max_itr:</span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> etchan <span class="kw">not</span> <span class="kw">in</span> badEta[rpc]:</span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>                            phTimes[phchan] <span class="op">+=</span> (<span class="va">self</span>.scDiffs[phchan][etchan] <span class="op">+</span> (<span class="op">-</span>etchan <span class="op">*</span> testSpeed <span class="op">+</span> phchan <span class="op">*</span> testSpeed <span class="op">-</span> offSet) <span class="op">+</span> etTimes[etchan]) <span class="op">/</span> (<span class="fl">32.</span> <span class="op">-</span> <span class="bu">len</span>(badEta[rpc]))</span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> phchan <span class="kw">not</span> <span class="kw">in</span> badPhi[rpc]:</span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a>                            etTimes[etchan] <span class="op">+=</span> (<span class="va">self</span>.scDiffs[phchan][etchan] <span class="op">+</span> (<span class="op">-</span>etchan <span class="op">*</span> testSpeed <span class="op">+</span> phchan <span class="op">*</span> testSpeed <span class="op">-</span> offSet) <span class="op">-</span> phTimes[phchan]) <span class="op">/</span> (<span class="fl">64.</span> <span class="op">-</span> <span class="bu">len</span>(badPhi[rpc]))</span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>                itr <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.residEtaLatest.append([time <span class="cf">for</span> time <span class="kw">in</span> etTimes])</span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.residPhiLatest.append([time <span class="cf">for</span> time <span class="kw">in</span> phTimes]) </span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plotchi2(<span class="va">self</span>):</span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a>        ax.hist(<span class="va">self</span>.chi2, bins<span class="op">=</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Chi2 Values'</span>)</span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Chi2 distribution'</span>)</span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Number of events'</span>)</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Chi2 values'</span>)</span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plottdcresidual(<span class="va">self</span>):</span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a>        rpcNames <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>        phichannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">65</span>)]</span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, rpc <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]):</span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>            plotPhiResids <span class="op">=</span> <span class="va">self</span>.residPhiLatest[idx].copy()</span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>            plotPhiResids.append(plotPhiResids[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>            plt.step(phichannels,plotPhiResids,linewidth<span class="op">=</span><span class="dv">3</span>,label<span class="op">=</span>rpcNames[rpc],where<span class="op">=</span><span class="st">'post'</span>)</span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>        yrange <span class="op">=</span> ax.get_ylim()</span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ax.text(40, 0.8*yrange[1], "Slope: "+str(round(popt[0],3))+" ns/channel, Offset: "+str(round(popt[1],2))+" ns", fontsize=14,</span></span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>        <span class="co">#               verticalalignment='top')</span></span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'$\phi$ Channel'</span>)</span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Time Residual (ns)'</span>)</span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ax.set_ylim([-6,6])</span></span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">63.5</span>])</span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a>        etchannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>)]</span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, rpc <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]):</span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a>            plotEtaResids <span class="op">=</span> <span class="va">self</span>.residEtaLatest[idx].copy()</span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>            plotEtaResids.append(plotEtaResids[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>            plt.step(etchannels,plotEtaResids,linewidth<span class="op">=</span><span class="dv">3</span>,label<span class="op">=</span>rpcNames[rpc],where<span class="op">=</span><span class="st">'post'</span>)</span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a>        yrange <span class="op">=</span> ax.get_ylim()</span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ax.text(40, 0.8*yrange[1], "Slope: "+str(round(popt[0],3))+" ns/channel, Offset: "+str(round(popt[1],2))+" ns", fontsize=14,</span></span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>        <span class="co">#               verticalalignment='top')</span></span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'$\eta$ Channel'</span>)</span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Time Residual (ns)'</span>)</span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ax.set_ylim([-6,6])</span></span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">31.5</span>])</span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>        plt.show()               </span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>                                            </span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_global_alignment_metric(<span class="va">self</span>):</span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.order):</span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>            met <span class="op">=</span> <span class="va">self</span>.globally_aligned_mets[idx]</span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a>            i, j <span class="op">=</span> item</span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>            binsx <span class="op">=</span> [x<span class="op">*</span><span class="va">self</span>.interval <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(met))]</span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a>            ax.plot(binsx,met,label<span class="op">=</span><span class="ss">f'TDC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> and TDC</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">, offset 0'</span>)</span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="dv">0</span>,<span class="va">self</span>.max_process_event)</span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ax.set_ylim(0,40)</span></span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Alignment graph'</span>)</span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Average $\sqrt{d\eta^2+d\phi^2}$'</span>)</span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'processed Event'</span>)</span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>        plt.show()                      </span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a>                                                     </span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> monitor_tdc3_state(<span class="va">self</span>, recordtimes<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-960"><a href="#cb3-960" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-961"><a href="#cb3-961" aria-hidden="true" tabindex="-1"></a>            poor_time_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-962"><a href="#cb3-962" aria-hidden="true" tabindex="-1"></a>            good_time_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-963"><a href="#cb3-963" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> event <span class="kw">in</span> <span class="va">self</span>.temp_events[<span class="op">-</span>(<span class="va">self</span>.monitor_factor <span class="op">*</span> <span class="va">self</span>.interval):]:</span>
<span id="cb3-964"><a href="#cb3-964" aria-hidden="true" tabindex="-1"></a>                words <span class="op">=</span> event.tdcEvents[tdc].words</span>
<span id="cb3-965"><a href="#cb3-965" aria-hidden="true" tabindex="-1"></a>                times_words <span class="op">=</span> [(word <span class="op">&amp;</span> <span class="bn">0xfffff</span>, word) <span class="cf">for</span> word <span class="kw">in</span> words <span class="cf">if</span> (word <span class="op">&gt;&gt;</span> <span class="dv">24</span>) <span class="op">&amp;</span> <span class="bn">0x7f</span> <span class="kw">not</span> <span class="kw">in</span> []]</span>
<span id="cb3-966"><a href="#cb3-966" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> times_words:</span>
<span id="cb3-967"><a href="#cb3-967" aria-hidden="true" tabindex="-1"></a>                    min_time, min_word <span class="op">=</span> <span class="bu">min</span>(times_words, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">0</span>])</span>
<span id="cb3-968"><a href="#cb3-968" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> recordtimes:</span>
<span id="cb3-969"><a href="#cb3-969" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.TDC_error_time[tdc].append([(min_time, min_word), <span class="va">self</span>.processedEvents])</span>
<span id="cb3-970"><a href="#cb3-970" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-971"><a href="#cb3-971" aria-hidden="true" tabindex="-1"></a>                        poor_time_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-972"><a href="#cb3-972" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> <span class="dv">200</span> <span class="op">&lt;</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-973"><a href="#cb3-973" aria-hidden="true" tabindex="-1"></a>                        good_time_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-974"><a href="#cb3-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-975"><a href="#cb3-975" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_time_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-976"><a href="#cb3-976" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tdc_mets[tdc].append(<span class="dv">1</span>)</span>
<span id="cb3-977"><a href="#cb3-977" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.lasttdc3Status[tdc]:</span>
<span id="cb3-978"><a href="#cb3-978" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'tdc</span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> error state through no good time'</span>)</span>
<span id="cb3-979"><a href="#cb3-979" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.lasttdc3Status[tdc] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-980"><a href="#cb3-980" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-981"><a href="#cb3-981" aria-hidden="true" tabindex="-1"></a>                ratio <span class="op">=</span> poor_time_count <span class="op">/</span> good_time_count</span>
<span id="cb3-982"><a href="#cb3-982" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tdc_mets[tdc].append(ratio)</span>
<span id="cb3-983"><a href="#cb3-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-984"><a href="#cb3-984" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ratio <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb3-985"><a href="#cb3-985" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.tdc3status[tdc] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-986"><a href="#cb3-986" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="va">self</span>.lasttdc3Status[tdc]:</span>
<span id="cb3-987"><a href="#cb3-987" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f'tdc</span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> enters error state through metric'</span>)</span>
<span id="cb3-988"><a href="#cb3-988" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.lasttdc3Status[tdc] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-989"><a href="#cb3-989" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-990"><a href="#cb3-990" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.tdc3status[tdc] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-991"><a href="#cb3-991" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.lasttdc3Status[tdc]:</span>
<span id="cb3-992"><a href="#cb3-992" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f'tdc</span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> enters nominal state through metric'</span>)</span>
<span id="cb3-993"><a href="#cb3-993" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.lasttdc3Status[tdc] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-994"><a href="#cb3-994" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">buffer</span> <span class="op">=</span> <span class="va">self</span>.fReader.reload_event_builder()</span>
<span id="cb3-995"><a href="#cb3-995" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f'event builder reloaded, proof </span><span class="sc">{</span><span class="bu">buffer</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-996"><a href="#cb3-996" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-997"><a href="#cb3-997" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_error_times(<span class="va">self</span>):</span>
<span id="cb3-998"><a href="#cb3-998" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-999"><a href="#cb3-999" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true" tabindex="-1"></a>        bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1251</span>, <span class="dv">50</span>)) <span class="op">+</span> [<span class="bu">float</span>(<span class="st">'inf'</span>)]  </span>
<span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true" tabindex="-1"></a>        text_offset <span class="op">=</span> <span class="fl">0.1</span>  </span>
<span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true" tabindex="-1"></a>            min_times <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.TDC_error_time[tdc]]</span>
<span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true" tabindex="-1"></a>            counts, bin_edges <span class="op">=</span> np.histogram(min_times, bins<span class="op">=</span>bins)</span>
<span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true" tabindex="-1"></a>            bin_centers <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges[<span class="dv">1</span>:] <span class="op">+</span> bin_edges[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true" tabindex="-1"></a>            bin_centers[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers, counts, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true" tabindex="-1"></a>            overflow_count <span class="op">=</span> counts[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count == </span><span class="sc">{</span>overflow_count<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true" tabindex="-1"></a>        plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'min_time'</span>)</span>
<span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Histograms of min_time for all TDCs'</span>)</span>
<span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="dv">0</span>, <span class="dv">1300</span>)</span>
<span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_error_times_separate_ranges(<span class="va">self</span>):</span>
<span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true" tabindex="-1"></a>        bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1251</span>, <span class="dv">50</span>)) <span class="op">+</span> [<span class="bu">float</span>(<span class="st">'inf'</span>)]</span>
<span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true" tabindex="-1"></a>        text_offset <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true" tabindex="-1"></a>            min_times_0_15000 <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry, proecss <span class="kw">in</span> <span class="va">self</span>.TDC_error_time[tdc] <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> proecss <span class="op">&lt;</span> <span class="dv">15000</span>]</span>
<span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true" tabindex="-1"></a>            min_times_25000_40000 <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry, process <span class="kw">in</span> <span class="va">self</span>.TDC_error_time[tdc] <span class="cf">if</span> <span class="dv">25000</span> <span class="op">&lt;=</span> process <span class="op">&lt;</span> <span class="dv">40000</span>]</span>
<span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true" tabindex="-1"></a>            counts_0_15000, bin_edges_0_15000 <span class="op">=</span> np.histogram(min_times_0_15000, bins<span class="op">=</span>bins)</span>
<span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true" tabindex="-1"></a>            counts_25000_40000, bin_edges_25000_40000 <span class="op">=</span> np.histogram(min_times_25000_40000, bins<span class="op">=</span>bins)</span>
<span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true" tabindex="-1"></a>            bin_centers_0_15000 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges_0_15000[<span class="dv">1</span>:] <span class="op">+</span> bin_edges_0_15000[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true" tabindex="-1"></a>            bin_centers_25000_40000 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges_25000_40000[<span class="dv">1</span>:] <span class="op">+</span> bin_edges_25000_40000[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true" tabindex="-1"></a>            bin_centers_0_15000[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true" tabindex="-1"></a>            bin_centers_25000_40000[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers_0_15000, counts_0_15000, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (0-15000)'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers_25000_40000, counts_25000_40000, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (25000-40000)'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true" tabindex="-1"></a>            overflow_count_0_15000 <span class="op">=</span> counts_0_15000[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true" tabindex="-1"></a>            overflow_count_25000_40000 <span class="op">=</span> counts_25000_40000[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count_0_15000 <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count (0-15000) == </span><span class="sc">{</span>overflow_count_0_15000<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count_25000_40000 <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count (25000-40000) == </span><span class="sc">{</span>overflow_count_25000_40000<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true" tabindex="-1"></a>            plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'min_time'</span>)</span>
<span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Histograms of min_time for TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true" tabindex="-1"></a>            plt.xlim(<span class="dv">0</span>, <span class="dv">1300</span>)</span>
<span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_error_channels(<span class="va">self</span>, tdcs_to_plot<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdcs_to_plot <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true" tabindex="-1"></a>            tdcs_to_plot <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>)  <span class="co"># Default to plotting all TDCs</span></span>
<span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true" tabindex="-1"></a>        good_channels_dict <span class="op">=</span> {tdc: [] <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot}</span>
<span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true" tabindex="-1"></a>        bad_channels_dict <span class="op">=</span> {tdc: [] <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot}</span>
<span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> min_time, min_word <span class="kw">in</span> <span class="va">self</span>.TDC_error_time[tdc]:</span>
<span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true" tabindex="-1"></a>                channel <span class="op">=</span> (min_word <span class="op">&gt;&gt;</span> <span class="dv">24</span>) <span class="op">&amp;</span> <span class="bn">0x7f</span></span>
<span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true" tabindex="-1"></a>                    bad_channels_dict[tdc].append(channel)</span>
<span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true" tabindex="-1"></a>                    good_channels_dict[tdc].append(channel)</span>
<span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">12</span>))</span>
<span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict[tdc]:</span>
<span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict[tdc], bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1094"><a href="#cb3-1094" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.yscale('log')</span></span>
<span id="cb3-1095"><a href="#cb3-1095" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1096"><a href="#cb3-1096" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1097"><a href="#cb3-1097" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Good Times Channels Histogram for Selected TDCs'</span>)</span>
<span id="cb3-1098"><a href="#cb3-1098" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-1099"><a href="#cb3-1099" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1100"><a href="#cb3-1100" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1101"><a href="#cb3-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1102"><a href="#cb3-1102" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">12</span>))</span>
<span id="cb3-1103"><a href="#cb3-1103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1104"><a href="#cb3-1104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bad_channels_dict[tdc]:</span>
<span id="cb3-1105"><a href="#cb3-1105" aria-hidden="true" tabindex="-1"></a>                plt.hist(bad_channels_dict[tdc], bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1106"><a href="#cb3-1106" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1107"><a href="#cb3-1107" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.yscale('log')</span></span>
<span id="cb3-1108"><a href="#cb3-1108" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1109"><a href="#cb3-1109" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1110"><a href="#cb3-1110" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Bad Times Channels Histogram for Selected TDCs'</span>)</span>
<span id="cb3-1111"><a href="#cb3-1111" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-1112"><a href="#cb3-1112" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1113"><a href="#cb3-1113" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1114"><a href="#cb3-1114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1115"><a href="#cb3-1115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1116"><a href="#cb3-1116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1117"><a href="#cb3-1117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1118"><a href="#cb3-1118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_error_channels_separate_ranges(<span class="va">self</span>, tdcs_to_plot<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-1119"><a href="#cb3-1119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdcs_to_plot <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1120"><a href="#cb3-1120" aria-hidden="true" tabindex="-1"></a>            tdcs_to_plot <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>)  <span class="co"># Default to plotting all TDCs</span></span>
<span id="cb3-1121"><a href="#cb3-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1122"><a href="#cb3-1122" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1123"><a href="#cb3-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1124"><a href="#cb3-1124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1125"><a href="#cb3-1125" aria-hidden="true" tabindex="-1"></a>            good_channels_dict_0_15000 <span class="op">=</span> []</span>
<span id="cb3-1126"><a href="#cb3-1126" aria-hidden="true" tabindex="-1"></a>            bad_channels_dict_0_15000 <span class="op">=</span> []</span>
<span id="cb3-1127"><a href="#cb3-1127" aria-hidden="true" tabindex="-1"></a>            good_channels_dict_25000_40000 <span class="op">=</span> []</span>
<span id="cb3-1128"><a href="#cb3-1128" aria-hidden="true" tabindex="-1"></a>            bad_channels_dict_25000_40000 <span class="op">=</span> []</span>
<span id="cb3-1129"><a href="#cb3-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1130"><a href="#cb3-1130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (min_time, min_word), process <span class="kw">in</span> <span class="va">self</span>.TDC_error_time[tdc]:</span>
<span id="cb3-1131"><a href="#cb3-1131" aria-hidden="true" tabindex="-1"></a>                channel <span class="op">=</span> (min_word <span class="op">&gt;&gt;</span> <span class="dv">24</span>) <span class="op">&amp;</span> <span class="bn">0x7f</span></span>
<span id="cb3-1132"><a href="#cb3-1132" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> process <span class="op">&lt;</span> <span class="dv">15000</span>:</span>
<span id="cb3-1133"><a href="#cb3-1133" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1134"><a href="#cb3-1134" aria-hidden="true" tabindex="-1"></a>                        bad_channels_dict_0_15000.append(channel)</span>
<span id="cb3-1135"><a href="#cb3-1135" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1136"><a href="#cb3-1136" aria-hidden="true" tabindex="-1"></a>                        good_channels_dict_0_15000.append(channel)</span>
<span id="cb3-1137"><a href="#cb3-1137" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="dv">25000</span> <span class="op">&lt;=</span> process <span class="op">&lt;</span> <span class="dv">40000</span>:</span>
<span id="cb3-1138"><a href="#cb3-1138" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1139"><a href="#cb3-1139" aria-hidden="true" tabindex="-1"></a>                        bad_channels_dict_25000_40000.append(channel)</span>
<span id="cb3-1140"><a href="#cb3-1140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1141"><a href="#cb3-1141" aria-hidden="true" tabindex="-1"></a>                        good_channels_dict_25000_40000.append(channel)</span>
<span id="cb3-1142"><a href="#cb3-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1143"><a href="#cb3-1143" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">12</span>))</span>
<span id="cb3-1144"><a href="#cb3-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1145"><a href="#cb3-1145" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plotting good channels</span></span>
<span id="cb3-1146"><a href="#cb3-1146" aria-hidden="true" tabindex="-1"></a>            plt.subplot(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-1147"><a href="#cb3-1147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict_0_15000:</span>
<span id="cb3-1148"><a href="#cb3-1148" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict_0_15000, bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1149"><a href="#cb3-1149" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (0-15000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1150"><a href="#cb3-1150" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict_25000_40000:</span>
<span id="cb3-1151"><a href="#cb3-1151" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict_25000_40000, bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1152"><a href="#cb3-1152" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (25000-40000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1153"><a href="#cb3-1153" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1154"><a href="#cb3-1154" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1155"><a href="#cb3-1155" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Good Times Channels Histogram for TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1156"><a href="#cb3-1156" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb3-1157"><a href="#cb3-1157" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1158"><a href="#cb3-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1159"><a href="#cb3-1159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plotting bad channels</span></span>
<span id="cb3-1160"><a href="#cb3-1160" aria-hidden="true" tabindex="-1"></a>            plt.subplot(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb3-1161"><a href="#cb3-1161" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bad_channels_dict_0_15000:</span>
<span id="cb3-1162"><a href="#cb3-1162" aria-hidden="true" tabindex="-1"></a>                plt.hist(bad_channels_dict_0_15000, bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1163"><a href="#cb3-1163" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (0-15000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1164"><a href="#cb3-1164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> bad_channels_dict_25000_40000:</span>
<span id="cb3-1165"><a href="#cb3-1165" aria-hidden="true" tabindex="-1"></a>                plt.hist(bad_channels_dict_25000_40000, bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1166"><a href="#cb3-1166" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (25000-40000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1167"><a href="#cb3-1167" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1168"><a href="#cb3-1168" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1169"><a href="#cb3-1169" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Bad Times Channels Histogram for TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1170"><a href="#cb3-1170" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb3-1171"><a href="#cb3-1171" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1172"><a href="#cb3-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1173"><a href="#cb3-1173" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb3-1174"><a href="#cb3-1174" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb3-1175"><a href="#cb3-1175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1176"><a href="#cb3-1176" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_state_metric(<span class="va">self</span>):</span>
<span id="cb3-1177"><a href="#cb3-1177" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1178"><a href="#cb3-1178" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-1179"><a href="#cb3-1179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1180"><a href="#cb3-1180" aria-hidden="true" tabindex="-1"></a>            met <span class="op">=</span> <span class="va">self</span>.tdc_mets[tdc]</span>
<span id="cb3-1181"><a href="#cb3-1181" aria-hidden="true" tabindex="-1"></a>            binsx <span class="op">=</span> [x<span class="op">*</span><span class="va">self</span>.interval<span class="op">*</span><span class="va">self</span>.monitor_factor <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(met))]</span>
<span id="cb3-1182"><a href="#cb3-1182" aria-hidden="true" tabindex="-1"></a>            ax.plot(binsx,met, label <span class="op">=</span> <span class="ss">f'tdc </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, color <span class="op">=</span> colors[tdc])</span>
<span id="cb3-1183"><a href="#cb3-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1184"><a href="#cb3-1184" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="dv">0</span>,<span class="va">self</span>.max_process_event)</span>
<span id="cb3-1185"><a href="#cb3-1185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ax.set_ylim(0,1)</span></span>
<span id="cb3-1186"><a href="#cb3-1186" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb3-1187"><a href="#cb3-1187" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'TDC monitoring metric'</span>)</span>
<span id="cb3-1188"><a href="#cb3-1188" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'bad time behavior / nominal time behavior'</span>)</span>
<span id="cb3-1189"><a href="#cb3-1189" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'processed Event'</span>)</span>
<span id="cb3-1190"><a href="#cb3-1190" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1191"><a href="#cb3-1191" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1192"><a href="#cb3-1192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_alignment_metric(<span class="va">self</span>, plot_range<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">0</span>]):</span>
<span id="cb3-1193"><a href="#cb3-1193" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-1194"><a href="#cb3-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1195"><a href="#cb3-1195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.order):</span>
<span id="cb3-1196"><a href="#cb3-1196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> plot_range <span class="op">==</span> [<span class="dv">0</span>, <span class="dv">0</span>]:</span>
<span id="cb3-1197"><a href="#cb3-1197" aria-hidden="true" tabindex="-1"></a>                met <span class="op">=</span> <span class="va">self</span>.mets[idx]</span>
<span id="cb3-1198"><a href="#cb3-1198" aria-hidden="true" tabindex="-1"></a>                i, j <span class="op">=</span> item</span>
<span id="cb3-1199"><a href="#cb3-1199" aria-hidden="true" tabindex="-1"></a>                binsx <span class="op">=</span> [x <span class="op">*</span> <span class="va">self</span>.interval <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(met))]</span>
<span id="cb3-1200"><a href="#cb3-1200" aria-hidden="true" tabindex="-1"></a>                ax.plot(binsx, met, label<span class="op">=</span><span class="ss">f'TDC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> and TDC</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">, offset 0'</span>)</span>
<span id="cb3-1201"><a href="#cb3-1201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1202"><a href="#cb3-1202" aria-hidden="true" tabindex="-1"></a>                start_idx <span class="op">=</span> <span class="bu">int</span>(plot_range[<span class="dv">0</span>] <span class="op">/</span> <span class="va">self</span>.interval)</span>
<span id="cb3-1203"><a href="#cb3-1203" aria-hidden="true" tabindex="-1"></a>                end_idx <span class="op">=</span> <span class="bu">int</span>(plot_range[<span class="dv">1</span>] <span class="op">/</span> <span class="va">self</span>.interval)</span>
<span id="cb3-1204"><a href="#cb3-1204" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> start_idx <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> end_idx <span class="op">&gt;</span> <span class="bu">len</span>(<span class="va">self</span>.mets[idx]):</span>
<span id="cb3-1205"><a href="#cb3-1205" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Invalid range for idx </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">: start </span><span class="sc">{</span>start_idx<span class="sc">}</span><span class="ss">, end </span><span class="sc">{</span>end_idx<span class="sc">}</span><span class="ss">, length </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.mets[idx])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-1206"><a href="#cb3-1206" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb3-1207"><a href="#cb3-1207" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-1208"><a href="#cb3-1208" aria-hidden="true" tabindex="-1"></a>                met <span class="op">=</span> <span class="va">self</span>.mets[idx][start_idx:end_idx]</span>
<span id="cb3-1209"><a href="#cb3-1209" aria-hidden="true" tabindex="-1"></a>                i, j <span class="op">=</span> item</span>
<span id="cb3-1210"><a href="#cb3-1210" aria-hidden="true" tabindex="-1"></a>                binsx <span class="op">=</span> [plot_range[<span class="dv">0</span>] <span class="op">+</span> x <span class="op">*</span> <span class="va">self</span>.interval <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(met))]</span>
<span id="cb3-1211"><a href="#cb3-1211" aria-hidden="true" tabindex="-1"></a>                ax.plot(binsx, met, label<span class="op">=</span><span class="ss">f'TDC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> and TDC</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">, offset 0'</span>)</span>
<span id="cb3-1212"><a href="#cb3-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1213"><a href="#cb3-1213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> plot_range <span class="op">==</span> [<span class="dv">0</span>, <span class="dv">0</span>]:</span>
<span id="cb3-1214"><a href="#cb3-1214" aria-hidden="true" tabindex="-1"></a>            ax.set_xlim(<span class="dv">0</span>, <span class="va">self</span>.max_process_event)</span>
<span id="cb3-1215"><a href="#cb3-1215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1216"><a href="#cb3-1216" aria-hidden="true" tabindex="-1"></a>            ax.set_xlim(plot_range[<span class="dv">0</span>], plot_range[<span class="dv">1</span>])</span>
<span id="cb3-1217"><a href="#cb3-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1218"><a href="#cb3-1218" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span><span class="dv">1</span>, <span class="dv">40</span>)</span>
<span id="cb3-1219"><a href="#cb3-1219" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb3-1220"><a href="#cb3-1220" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Alignment graph'</span>)</span>
<span id="cb3-1221"><a href="#cb3-1221" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Average $\sqrt{d\eta^2+d\phi^2}$'</span>)</span>
<span id="cb3-1222"><a href="#cb3-1222" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Processed Event'</span>)</span>
<span id="cb3-1223"><a href="#cb3-1223" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1224"><a href="#cb3-1224" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb3-1225"><a href="#cb3-1225" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_alignment_status(<span class="va">self</span>, aligned, realigned):</span>
<span id="cb3-1226"><a href="#cb3-1226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> aligned <span class="kw">and</span> <span class="kw">not</span> realigned:</span>
<span id="cb3-1227"><a href="#cb3-1227" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lastWasBad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1228"><a href="#cb3-1228" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.global_alignment <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1229"><a href="#cb3-1229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="kw">not</span> aligned <span class="kw">and</span> realigned:</span>
<span id="cb3-1230"><a href="#cb3-1230" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lastWasBad <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1231"><a href="#cb3-1231" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.global_alignment <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1232"><a href="#cb3-1232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> aligned <span class="kw">and</span> <span class="kw">not</span> realigned:</span>
<span id="cb3-1233"><a href="#cb3-1233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.lastWasBad <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1234"><a href="#cb3-1234" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.global_alignment <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1235"><a href="#cb3-1235" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1236"><a href="#cb3-1236" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'alignment error, realigned events already aligned, proicessed event </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>processedEvents<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1237"><a href="#cb3-1237" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-1238"><a href="#cb3-1238" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_adjustment_window(<span class="va">self</span>, realigned):</span>
<span id="cb3-1239"><a href="#cb3-1239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.lastWasBad <span class="kw">and</span> <span class="kw">not</span> realigned:</span>
<span id="cb3-1240"><a href="#cb3-1240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.adjustment <span class="op">&lt;</span> <span class="dv">35</span>:</span>
<span id="cb3-1241"><a href="#cb3-1241" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.adjustment <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-1242"><a href="#cb3-1242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1243"><a href="#cb3-1243" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.adjustment <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1244"><a href="#cb3-1244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1245"><a href="#cb3-1245" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.offsetlist <span class="op">=</span> [p <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, (<span class="dv">4</span> <span class="op">+</span> <span class="va">self</span>.adjustment)) <span class="cf">for</span> p <span class="kw">in</span> (o, <span class="op">-</span>o)]</span>
<span id="cb3-1246"><a href="#cb3-1246" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-1247"><a href="#cb3-1247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calcAvgAlign(<span class="va">self</span>,offSet<span class="op">=</span><span class="dv">0</span>, i <span class="op">=</span> <span class="dv">1</span>, j <span class="op">=</span> <span class="dv">2</span>, k <span class="op">=</span> <span class="dv">0</span>, l <span class="op">=</span> <span class="dv">2</span>, tdc1 <span class="op">=</span><span class="dv">0</span>, tdc0 <span class="op">=</span> <span class="dv">1</span>, processedEvents <span class="op">=</span> <span class="dv">0</span>, skipChans <span class="op">=</span> []):</span>
<span id="cb3-1248"><a href="#cb3-1248" aria-hidden="true" tabindex="-1"></a>        mets <span class="op">=</span> []</span>
<span id="cb3-1249"><a href="#cb3-1249" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, event <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.event_chunk):</span>
<span id="cb3-1250"><a href="#cb3-1250" aria-hidden="true" tabindex="-1"></a>            etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1251"><a href="#cb3-1251" aria-hidden="true" tabindex="-1"></a>            phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1252"><a href="#cb3-1252" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (idx<span class="op">+</span><span class="bu">abs</span>(offSet))<span class="op">&lt;</span><span class="bu">len</span>(<span class="va">self</span>.event_chunk):</span>
<span id="cb3-1253"><a href="#cb3-1253" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> offSet<span class="op">&lt;=</span><span class="dv">0</span>:</span>
<span id="cb3-1254"><a href="#cb3-1254" aria-hidden="true" tabindex="-1"></a>                    oneIdx <span class="op">=</span> idx<span class="op">+</span><span class="bu">abs</span>(offSet)</span>
<span id="cb3-1255"><a href="#cb3-1255" aria-hidden="true" tabindex="-1"></a>                    twoIdx <span class="op">=</span> idx</span>
<span id="cb3-1256"><a href="#cb3-1256" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1257"><a href="#cb3-1257" aria-hidden="true" tabindex="-1"></a>                    oneIdx <span class="op">=</span> idx</span>
<span id="cb3-1258"><a href="#cb3-1258" aria-hidden="true" tabindex="-1"></a>                    twoIdx <span class="op">=</span> idx<span class="op">+</span>offSet</span>
<span id="cb3-1259"><a href="#cb3-1259" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb3-1260"><a href="#cb3-1260" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> word <span class="kw">in</span> <span class="va">self</span>.event_chunk[oneIdx].tdcEvents[tdc1].words:</span>
<span id="cb3-1261"><a href="#cb3-1261" aria-hidden="true" tabindex="-1"></a>                    rpc, thisHit <span class="op">=</span> tdcChanToRPCHit(word,tdc1, processedEvents <span class="op">+</span> idx)</span>
<span id="cb3-1262"><a href="#cb3-1262" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> thisHit.eta:</span>
<span id="cb3-1263"><a href="#cb3-1263" aria-hidden="true" tabindex="-1"></a>                        etaHits[rpc].append(thisHit)</span>
<span id="cb3-1264"><a href="#cb3-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1265"><a href="#cb3-1265" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-1266"><a href="#cb3-1266" aria-hidden="true" tabindex="-1"></a>                        phiHits[rpc].append(thisHit)</span>
<span id="cb3-1267"><a href="#cb3-1267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> word <span class="kw">in</span> <span class="va">self</span>.event_chunk[twoIdx].tdcEvents[tdc0].words:</span>
<span id="cb3-1268"><a href="#cb3-1268" aria-hidden="true" tabindex="-1"></a>                    rpc, thisHit <span class="op">=</span> tdcChanToRPCHit(word,tdc0, processedEvents <span class="op">+</span> idx)</span>
<span id="cb3-1269"><a href="#cb3-1269" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> thisHit.eta:</span>
<span id="cb3-1270"><a href="#cb3-1270" aria-hidden="true" tabindex="-1"></a>                        etaHits[rpc].append(thisHit)</span>
<span id="cb3-1271"><a href="#cb3-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1272"><a href="#cb3-1272" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-1273"><a href="#cb3-1273" aria-hidden="true" tabindex="-1"></a>                        phiHits[rpc].append(thisHit) </span>
<span id="cb3-1274"><a href="#cb3-1274" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>:  </span>
<span id="cb3-1275"><a href="#cb3-1275" aria-hidden="true" tabindex="-1"></a>                    etOff <span class="op">=</span> <span class="va">self</span>.testAlign(etaHits[i],etaHits[j], skipChans <span class="op">=</span> skipChans, eta <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb3-1276"><a href="#cb3-1276" aria-hidden="true" tabindex="-1"></a>                    phOff <span class="op">=</span> <span class="va">self</span>.testAlign(phiHits[k],phiHits[l], skipChans <span class="op">=</span> skipChans, eta <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-1277"><a href="#cb3-1277" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> etOff<span class="op">&gt;=</span><span class="dv">0</span> <span class="kw">and</span> phOff<span class="op">&gt;=</span><span class="dv">0</span>:</span>
<span id="cb3-1278"><a href="#cb3-1278" aria-hidden="true" tabindex="-1"></a>                        mets.append(math.sqrt(etOff<span class="op">*</span>etOff<span class="op">+</span>phOff<span class="op">*</span>phOff))</span>
<span id="cb3-1279"><a href="#cb3-1279" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1280"><a href="#cb3-1280" aria-hidden="true" tabindex="-1"></a>                    phOff <span class="op">=</span> <span class="va">self</span>.testAlign(phiHits[k],phiHits[l], skipChans <span class="op">=</span> skipChans, eta <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-1281"><a href="#cb3-1281" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> phOff<span class="op">&gt;=</span><span class="dv">0</span>:</span>
<span id="cb3-1282"><a href="#cb3-1282" aria-hidden="true" tabindex="-1"></a>                        mets.append(math.sqrt(phOff<span class="op">*</span>phOff))</span>
<span id="cb3-1283"><a href="#cb3-1283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(mets)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb3-1284"><a href="#cb3-1284" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">sum</span>(mets)<span class="op">/</span><span class="bu">len</span>(mets)</span>
<span id="cb3-1285"><a href="#cb3-1285" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1286"><a href="#cb3-1286" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.only_header <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-1287"><a href="#cb3-1287" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1288"><a href="#cb3-1288" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-1289"><a href="#cb3-1289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> doRealign(<span class="va">self</span>, skipChans<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">31</span>, <span class="dv">32</span>], method <span class="op">=</span> <span class="st">'giveup'</span>):</span>
<span id="cb3-1290"><a href="#cb3-1290" aria-hidden="true" tabindex="-1"></a>        aligned <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1291"><a href="#cb3-1291" aria-hidden="true" tabindex="-1"></a>        realigned <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1292"><a href="#cb3-1292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.order):</span>
<span id="cb3-1293"><a href="#cb3-1293" aria-hidden="true" tabindex="-1"></a>            i, j <span class="op">=</span> item</span>
<span id="cb3-1294"><a href="#cb3-1294" aria-hidden="true" tabindex="-1"></a>            x, y, l, m <span class="op">=</span> find_tdc_alignment_metric(i, j)</span>
<span id="cb3-1295"><a href="#cb3-1295" aria-hidden="true" tabindex="-1"></a>            alignMet<span class="op">=</span> <span class="va">self</span>.calcAvgAlign(offSet<span class="op">=</span><span class="dv">0</span>, i<span class="op">=</span>x, j<span class="op">=</span>y, k<span class="op">=</span>l, l<span class="op">=</span>m, tdc1<span class="op">=</span>i, tdc0<span class="op">=</span>j, processedEvents<span class="op">=</span><span class="va">self</span>.processedEvents, skipChans<span class="op">=</span>skipChans)</span>
<span id="cb3-1296"><a href="#cb3-1296" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.mets[idx].append(alignMet)</span>
<span id="cb3-1297"><a href="#cb3-1297" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> alignMet <span class="op">&gt;</span> <span class="dv">15</span>:</span>
<span id="cb3-1298"><a href="#cb3-1298" aria-hidden="true" tabindex="-1"></a>                aligned <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1299"><a href="#cb3-1299" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">any</span>(status <span class="op">==</span> <span class="va">False</span> <span class="cf">for</span> status <span class="kw">in</span> <span class="va">self</span>.tdc3status) <span class="kw">and</span> method <span class="op">==</span> <span class="st">'giveup'</span>:</span>
<span id="cb3-1300"><a href="#cb3-1300" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb3-1301"><a href="#cb3-1301" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> testOffset <span class="kw">in</span> <span class="va">self</span>.offsetlist:</span>
<span id="cb3-1302"><a href="#cb3-1302" aria-hidden="true" tabindex="-1"></a>                    testAlignMet <span class="op">=</span> <span class="va">self</span>.calcAvgAlign(offSet<span class="op">=</span>testOffset, i<span class="op">=</span>x, j<span class="op">=</span>y, k<span class="op">=</span>l, l<span class="op">=</span>m, tdc1<span class="op">=</span>i, tdc0<span class="op">=</span>j, processedEvents<span class="op">=</span><span class="va">self</span>.processedEvents, skipChans<span class="op">=</span>skipChans)</span>
<span id="cb3-1303"><a href="#cb3-1303" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> testAlignMet <span class="op">&lt;</span> <span class="dv">15</span>:</span>
<span id="cb3-1304"><a href="#cb3-1304" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.updates[idx] <span class="op">+=</span> (testOffset)</span>
<span id="cb3-1305"><a href="#cb3-1305" aria-hidden="true" tabindex="-1"></a>                        realigned <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1306"><a href="#cb3-1306" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb3-1307"><a href="#cb3-1307" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.global_alignment <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-1308"><a href="#cb3-1308" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.globally_aligned_mets[idx].append(alignMet)</span>
<span id="cb3-1309"><a href="#cb3-1309" aria-hidden="true" tabindex="-1"></a>                <span class="co"># self.globally_aligned_events.extend(self.event_chunk)</span></span>
<span id="cb3-1310"><a href="#cb3-1310" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ConstructEventInsertionList()</span>
<span id="cb3-1311"><a href="#cb3-1311" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(x <span class="op">==</span> <span class="dv">0</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.insertion_list):</span>
<span id="cb3-1312"><a href="#cb3-1312" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.InsertFakeEvents()</span>
<span id="cb3-1313"><a href="#cb3-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1314"><a href="#cb3-1314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> aligned, realigned</span>
<span id="cb3-1315"><a href="#cb3-1315" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1316"><a href="#cb3-1316" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ConstructEventInsertionList(<span class="va">self</span>):</span>
<span id="cb3-1317"><a href="#cb3-1317" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, update <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.updates):</span>
<span id="cb3-1318"><a href="#cb3-1318" aria-hidden="true" tabindex="-1"></a>            i, j <span class="op">=</span> <span class="va">self</span>.order[idx]</span>
<span id="cb3-1319"><a href="#cb3-1319" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.insertion_list[j] <span class="op">+=</span> (<span class="va">self</span>.insertion_list[i] <span class="op">-</span> update)</span>
<span id="cb3-1320"><a href="#cb3-1320" aria-hidden="true" tabindex="-1"></a>        min_value <span class="op">=</span> <span class="bu">min</span>(<span class="va">self</span>.insertion_list)</span>
<span id="cb3-1321"><a href="#cb3-1321" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> min_value <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1322"><a href="#cb3-1322" aria-hidden="true" tabindex="-1"></a>            addition <span class="op">=</span> <span class="bu">abs</span>(min_value)</span>
<span id="cb3-1323"><a href="#cb3-1323" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1324"><a href="#cb3-1324" aria-hidden="true" tabindex="-1"></a>            addition <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1325"><a href="#cb3-1325" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.insertion_list <span class="op">=</span> [x <span class="op">+</span> addition <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.insertion_list]</span>
<span id="cb3-1326"><a href="#cb3-1326" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1327"><a href="#cb3-1327" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> InsertFakeEvents(<span class="va">self</span>):</span>
<span id="cb3-1328"><a href="#cb3-1328" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc, insertion <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.insertion_list):</span>
<span id="cb3-1329"><a href="#cb3-1329" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> fakeEvent <span class="kw">in</span> <span class="bu">range</span>(insertion):</span>
<span id="cb3-1330"><a href="#cb3-1330" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.fReader.evtBuilder.insertFakeEvent(tdc <span class="op">=</span> tdc)</span>
<span id="cb3-1331"><a href="#cb3-1331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.debug_statement <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-1332"><a href="#cb3-1332" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'New alignment, Event number </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>processedEvents<span class="sc">}</span><span class="ss">, insertions </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>insertion_list<span class="sc">}</span><span class="ss">, updates </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>updates<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1333"><a href="#cb3-1333" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-1334"><a href="#cb3-1334" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-1335"><a href="#cb3-1335" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1336"><a href="#cb3-1336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.record_inserted_events:</span>
<span id="cb3-1337"><a href="#cb3-1337" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.event_hist <span class="op">=</span> [x <span class="op">+</span> y <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(<span class="va">self</span>.event_hist, <span class="va">self</span>.insertion_list)]</span>
<span id="cb3-1338"><a href="#cb3-1338" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.update_frequency()</span>
<span id="cb3-1339"><a href="#cb3-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1340"><a href="#cb3-1340" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.insertion_list <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb3-1341"><a href="#cb3-1341" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.updates <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.order))]</span>
<span id="cb3-1342"><a href="#cb3-1342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1343"><a href="#cb3-1343" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> curve_fit_tof(<span class="va">self</span>):</span>
<span id="cb3-1344"><a href="#cb3-1344" aria-hidden="true" tabindex="-1"></a>        excludedEta <span class="op">=</span> [<span class="dv">31</span>]</span>
<span id="cb3-1345"><a href="#cb3-1345" aria-hidden="true" tabindex="-1"></a>        excludedPhi <span class="op">=</span> [<span class="dv">19</span>]</span>
<span id="cb3-1346"><a href="#cb3-1346" aria-hidden="true" tabindex="-1"></a>        fitPhChan <span class="op">=</span> [<span class="fl">0.5</span><span class="op">+</span>chan <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb3-1347"><a href="#cb3-1347" aria-hidden="true" tabindex="-1"></a>        fitEtChan <span class="op">=</span> [<span class="fl">0.5</span><span class="op">+</span>chan <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)]</span>
<span id="cb3-1348"><a href="#cb3-1348" aria-hidden="true" tabindex="-1"></a>        fitDiffs <span class="op">=</span> [row[:] <span class="cf">for</span> row <span class="kw">in</span> <span class="va">self</span>.scDiffs]</span>
<span id="cb3-1349"><a href="#cb3-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1350"><a href="#cb3-1350" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb3-1351"><a href="#cb3-1351" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb3-1352"><a href="#cb3-1352" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> phchan <span class="kw">in</span> excludedPhi:</span>
<span id="cb3-1353"><a href="#cb3-1353" aria-hidden="true" tabindex="-1"></a>                    fitDiffs[phchan][etchan] <span class="op">=</span> <span class="va">self</span>.scDiffs[phchan<span class="op">+</span><span class="dv">1</span>][etchan]</span>
<span id="cb3-1354"><a href="#cb3-1354" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> etchan <span class="kw">in</span> excludedEta:</span>
<span id="cb3-1355"><a href="#cb3-1355" aria-hidden="true" tabindex="-1"></a>                    fitDiffs[phchan].pop(etchan)</span>
<span id="cb3-1356"><a href="#cb3-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1357"><a href="#cb3-1357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> etChan <span class="kw">in</span> excludedEta:</span>
<span id="cb3-1358"><a href="#cb3-1358" aria-hidden="true" tabindex="-1"></a>            fitEtChan.pop(etChan)</span>
<span id="cb3-1359"><a href="#cb3-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1360"><a href="#cb3-1360" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> plane(xy,a,b):</span>
<span id="cb3-1361"><a href="#cb3-1361" aria-hidden="true" tabindex="-1"></a>            x, y <span class="op">=</span> xy</span>
<span id="cb3-1362"><a href="#cb3-1362" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (a<span class="op">*</span>(x<span class="op">-</span>y)<span class="op">+</span>b).ravel()</span>
<span id="cb3-1363"><a href="#cb3-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1364"><a href="#cb3-1364" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> np.meshgrid(fitEtChan, fitPhChan)</span>
<span id="cb3-1365"><a href="#cb3-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1366"><a href="#cb3-1366" aria-hidden="true" tabindex="-1"></a>        popt,pcov <span class="op">=</span> curve_fit(plane,(x,y),np.array(fitDiffs).ravel(),p0<span class="op">=</span>[<span class="fl">0.175</span>,<span class="dv">13</span>])</span>
<span id="cb3-1367"><a href="#cb3-1367" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(popt[<span class="dv">0</span>],popt[<span class="dv">1</span>])</span>
<span id="cb3-1368"><a href="#cb3-1368" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.popt <span class="op">=</span> popt</span>
<span id="cb3-1369"><a href="#cb3-1369" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb3-1370"><a href="#cb3-1370" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> testAlign(<span class="va">self</span>, rpc1Hits, rpc2Hits, skipChans <span class="op">=</span> [], eta <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb3-1371"><a href="#cb3-1371" aria-hidden="true" tabindex="-1"></a>        minTimes <span class="op">=</span> [<span class="dv">300</span>,<span class="dv">300</span>]</span>
<span id="cb3-1372"><a href="#cb3-1372" aria-hidden="true" tabindex="-1"></a>        minChans <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1373"><a href="#cb3-1373" aria-hidden="true" tabindex="-1"></a>        minRPC <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1374"><a href="#cb3-1374" aria-hidden="true" tabindex="-1"></a>        minWord <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1375"><a href="#cb3-1375" aria-hidden="true" tabindex="-1"></a>        tdc <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1376"><a href="#cb3-1376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(rpc1Hits)<span class="op">&lt;</span><span class="dv">1</span> <span class="kw">or</span> <span class="bu">len</span>(rpc2Hits)<span class="op">&lt;</span><span class="dv">1</span>:</span>
<span id="cb3-1377"><a href="#cb3-1377" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1378"><a href="#cb3-1378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> hit <span class="kw">in</span> rpc1Hits:</span>
<span id="cb3-1379"><a href="#cb3-1379" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hit.time<span class="op">&lt;</span>minTimes[<span class="dv">0</span>] <span class="kw">and</span> hit.channel <span class="kw">not</span> <span class="kw">in</span> skipChans:</span>
<span id="cb3-1380"><a href="#cb3-1380" aria-hidden="true" tabindex="-1"></a>                minTimes[<span class="dv">0</span>]<span class="op">=</span>hit.time</span>
<span id="cb3-1381"><a href="#cb3-1381" aria-hidden="true" tabindex="-1"></a>                minChans[<span class="dv">0</span>]<span class="op">=</span>hit.channel</span>
<span id="cb3-1382"><a href="#cb3-1382" aria-hidden="true" tabindex="-1"></a>                minRPC[<span class="dv">0</span>] <span class="op">=</span> hit.rpc</span>
<span id="cb3-1383"><a href="#cb3-1383" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> hit <span class="kw">in</span> rpc2Hits:</span>
<span id="cb3-1384"><a href="#cb3-1384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hit.time<span class="op">&lt;</span>minTimes[<span class="dv">1</span>] <span class="kw">and</span> hit.channel <span class="kw">not</span> <span class="kw">in</span> skipChans:</span>
<span id="cb3-1385"><a href="#cb3-1385" aria-hidden="true" tabindex="-1"></a>                minTimes[<span class="dv">1</span>]<span class="op">=</span>hit.time</span>
<span id="cb3-1386"><a href="#cb3-1386" aria-hidden="true" tabindex="-1"></a>                minChans[<span class="dv">1</span>]<span class="op">=</span>hit.channel</span>
<span id="cb3-1387"><a href="#cb3-1387" aria-hidden="true" tabindex="-1"></a>                minRPC[<span class="dv">1</span>] <span class="op">=</span> hit.rpc</span>
<span id="cb3-1388"><a href="#cb3-1388" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> minChans:</span>
<span id="cb3-1389"><a href="#cb3-1389" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1390"><a href="#cb3-1390" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1391"><a href="#cb3-1391" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> rpcHitToTdcChan(minRPC[<span class="dv">0</span>], minChans[<span class="dv">0</span>], eta)</span>
<span id="cb3-1392"><a href="#cb3-1392" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> rpcHitToTdcChan(minRPC[<span class="dv">1</span>], minChans[<span class="dv">1</span>], eta)</span>
<span id="cb3-1393"><a href="#cb3-1393" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1394"><a href="#cb3-1394" aria-hidden="true" tabindex="-1"></a>        tdc[<span class="dv">0</span>], minWord[<span class="dv">0</span>] <span class="op">=</span> a</span>
<span id="cb3-1395"><a href="#cb3-1395" aria-hidden="true" tabindex="-1"></a>        tdc[<span class="dv">1</span>], minWord[<span class="dv">1</span>] <span class="op">=</span> b</span>
<span id="cb3-1396"><a href="#cb3-1396" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-1397"><a href="#cb3-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1398"><a href="#cb3-1398" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.TDC_alignment_time[tdc[<span class="dv">0</span>]].append((minTimes[<span class="dv">0</span>], a, <span class="va">self</span>.processedEvents))</span>
<span id="cb3-1399"><a href="#cb3-1399" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.TDC_alignment_time[tdc[<span class="dv">1</span>]].append((minTimes[<span class="dv">1</span>], b, <span class="va">self</span>.processedEvents))</span>
<span id="cb3-1400"><a href="#cb3-1400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">abs</span>(minChans[<span class="dv">1</span>]<span class="op">-</span>minChans[<span class="dv">0</span>])   </span>
<span id="cb3-1401"><a href="#cb3-1401" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1402"><a href="#cb3-1402" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1403"><a href="#cb3-1403" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1404"><a href="#cb3-1404" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1405"><a href="#cb3-1405" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_alignment_times(<span class="va">self</span>):</span>
<span id="cb3-1406"><a href="#cb3-1406" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-1407"><a href="#cb3-1407" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1408"><a href="#cb3-1408" aria-hidden="true" tabindex="-1"></a>        bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1251</span>, <span class="dv">50</span>)) <span class="op">+</span> [<span class="bu">float</span>(<span class="st">'inf'</span>)]  </span>
<span id="cb3-1409"><a href="#cb3-1409" aria-hidden="true" tabindex="-1"></a>        text_offset <span class="op">=</span> <span class="fl">0.1</span>  </span>
<span id="cb3-1410"><a href="#cb3-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1411"><a href="#cb3-1411" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1412"><a href="#cb3-1412" aria-hidden="true" tabindex="-1"></a>            min_times <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.TDC_alignment_time[tdc]]</span>
<span id="cb3-1413"><a href="#cb3-1413" aria-hidden="true" tabindex="-1"></a>            counts, bin_edges <span class="op">=</span> np.histogram(min_times, bins<span class="op">=</span>bins)</span>
<span id="cb3-1414"><a href="#cb3-1414" aria-hidden="true" tabindex="-1"></a>            bin_centers <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges[<span class="dv">1</span>:] <span class="op">+</span> bin_edges[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1415"><a href="#cb3-1415" aria-hidden="true" tabindex="-1"></a>            bin_centers[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1416"><a href="#cb3-1416" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers, counts, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1417"><a href="#cb3-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1418"><a href="#cb3-1418" aria-hidden="true" tabindex="-1"></a>            overflow_count <span class="op">=</span> counts[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1419"><a href="#cb3-1419" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1420"><a href="#cb3-1420" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count == </span><span class="sc">{</span>overflow_count<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1421"><a href="#cb3-1421" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1422"><a href="#cb3-1422" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1423"><a href="#cb3-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1424"><a href="#cb3-1424" aria-hidden="true" tabindex="-1"></a>        plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb3-1425"><a href="#cb3-1425" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'alignment time'</span>)</span>
<span id="cb3-1426"><a href="#cb3-1426" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1427"><a href="#cb3-1427" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Histograms of alignment time for all TDCs'</span>)</span>
<span id="cb3-1428"><a href="#cb3-1428" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="dv">0</span>, <span class="dv">1300</span>)</span>
<span id="cb3-1429"><a href="#cb3-1429" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-1430"><a href="#cb3-1430" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1431"><a href="#cb3-1431" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1432"><a href="#cb3-1432" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1433"><a href="#cb3-1433" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1434"><a href="#cb3-1434" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1435"><a href="#cb3-1435" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_alignment_channels(<span class="va">self</span>, tdcs_to_plot<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-1436"><a href="#cb3-1436" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdcs_to_plot <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1437"><a href="#cb3-1437" aria-hidden="true" tabindex="-1"></a>            tdcs_to_plot <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>)  <span class="co"># Default to plotting all TDCs</span></span>
<span id="cb3-1438"><a href="#cb3-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1439"><a href="#cb3-1439" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1440"><a href="#cb3-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1441"><a href="#cb3-1441" aria-hidden="true" tabindex="-1"></a>        good_channels_dict <span class="op">=</span> {tdc: [] <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot}</span>
<span id="cb3-1442"><a href="#cb3-1442" aria-hidden="true" tabindex="-1"></a>        bad_channels_dict <span class="op">=</span> {tdc: [] <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot}</span>
<span id="cb3-1443"><a href="#cb3-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1444"><a href="#cb3-1444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1445"><a href="#cb3-1445" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> min_time, min_word, processed_events <span class="kw">in</span> <span class="va">self</span>.TDC_alignment_time[tdc]:</span>
<span id="cb3-1446"><a href="#cb3-1446" aria-hidden="true" tabindex="-1"></a>                channel <span class="op">=</span> min_word[<span class="dv">1</span>]</span>
<span id="cb3-1447"><a href="#cb3-1447" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1448"><a href="#cb3-1448" aria-hidden="true" tabindex="-1"></a>                    bad_channels_dict[tdc].append(channel)</span>
<span id="cb3-1449"><a href="#cb3-1449" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1450"><a href="#cb3-1450" aria-hidden="true" tabindex="-1"></a>                    good_channels_dict[tdc].append(channel)</span>
<span id="cb3-1451"><a href="#cb3-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1452"><a href="#cb3-1452" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">12</span>))</span>
<span id="cb3-1453"><a href="#cb3-1453" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1454"><a href="#cb3-1454" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict[tdc]:</span>
<span id="cb3-1455"><a href="#cb3-1455" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict[tdc], bins<span class="op">=</span><span class="dv">128</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1456"><a href="#cb3-1456" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1457"><a href="#cb3-1457" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.yscale('log')</span></span>
<span id="cb3-1458"><a href="#cb3-1458" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1459"><a href="#cb3-1459" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1460"><a href="#cb3-1460" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Channels used for alignment'</span>)</span>
<span id="cb3-1461"><a href="#cb3-1461" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb3-1462"><a href="#cb3-1462" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1463"><a href="#cb3-1463" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb3-1464"><a href="#cb3-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1465"><a href="#cb3-1465" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.figure(figsize=(24, 12))</span></span>
<span id="cb3-1466"><a href="#cb3-1466" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for tdc in tdcs_to_plot:</span></span>
<span id="cb3-1467"><a href="#cb3-1467" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     if bad_channels_dict[tdc]:</span></span>
<span id="cb3-1468"><a href="#cb3-1468" aria-hidden="true" tabindex="-1"></a>        <span class="co">#         plt.hist(bad_channels_dict[tdc], bins=128, alpha=0.7, edgecolor=colors[tdc],</span></span>
<span id="cb3-1469"><a href="#cb3-1469" aria-hidden="true" tabindex="-1"></a>        <span class="co">#                 label=f'TDC {tdc}', histtype='step', linewidth=2, color=colors[tdc])</span></span>
<span id="cb3-1470"><a href="#cb3-1470" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # plt.yscale('log')</span></span>
<span id="cb3-1471"><a href="#cb3-1471" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.xlabel('Channel')</span></span>
<span id="cb3-1472"><a href="#cb3-1472" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.ylabel('Events')</span></span>
<span id="cb3-1473"><a href="#cb3-1473" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.title('Channels used for alignment')</span></span>
<span id="cb3-1474"><a href="#cb3-1474" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.legend()</span></span>
<span id="cb3-1475"><a href="#cb3-1475" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.grid(True)</span></span>
<span id="cb3-1476"><a href="#cb3-1476" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plt.show()</span></span>
<span id="cb3-1477"><a href="#cb3-1477" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1478"><a href="#cb3-1478" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1479"><a href="#cb3-1479" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1480"><a href="#cb3-1480" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1481"><a href="#cb3-1481" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_alignment_channels_separate_ranges(<span class="va">self</span>, tdcs_to_plot<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-1482"><a href="#cb3-1482" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdcs_to_plot <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1483"><a href="#cb3-1483" aria-hidden="true" tabindex="-1"></a>            tdcs_to_plot <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>)  <span class="co"># Default to plotting all TDCs</span></span>
<span id="cb3-1484"><a href="#cb3-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1485"><a href="#cb3-1485" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1486"><a href="#cb3-1486" aria-hidden="true" tabindex="-1"></a>        bins <span class="op">=</span> [i <span class="op">-</span> <span class="fl">0.5</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">129</span>)]  <span class="co"># Creating bin edges to center bins on integer values</span></span>
<span id="cb3-1487"><a href="#cb3-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1488"><a href="#cb3-1488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> tdcs_to_plot:</span>
<span id="cb3-1489"><a href="#cb3-1489" aria-hidden="true" tabindex="-1"></a>            good_channels_dict_0_15000 <span class="op">=</span> []</span>
<span id="cb3-1490"><a href="#cb3-1490" aria-hidden="true" tabindex="-1"></a>            bad_channels_dict_0_15000 <span class="op">=</span> []</span>
<span id="cb3-1491"><a href="#cb3-1491" aria-hidden="true" tabindex="-1"></a>            good_channels_dict_25000_40000 <span class="op">=</span> []</span>
<span id="cb3-1492"><a href="#cb3-1492" aria-hidden="true" tabindex="-1"></a>            bad_channels_dict_25000_40000 <span class="op">=</span> []</span>
<span id="cb3-1493"><a href="#cb3-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1494"><a href="#cb3-1494" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> min_time, min_word, processed_events <span class="kw">in</span> <span class="va">self</span>.TDC_alignment_time[tdc]:</span>
<span id="cb3-1495"><a href="#cb3-1495" aria-hidden="true" tabindex="-1"></a>                channel <span class="op">=</span> min_word[<span class="dv">1</span>]</span>
<span id="cb3-1496"><a href="#cb3-1496" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> processed_events <span class="op">&lt;</span> <span class="dv">15000</span>:</span>
<span id="cb3-1497"><a href="#cb3-1497" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1498"><a href="#cb3-1498" aria-hidden="true" tabindex="-1"></a>                        bad_channels_dict_0_15000.append(channel)</span>
<span id="cb3-1499"><a href="#cb3-1499" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1500"><a href="#cb3-1500" aria-hidden="true" tabindex="-1"></a>                        good_channels_dict_0_15000.append(channel)</span>
<span id="cb3-1501"><a href="#cb3-1501" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="dv">25000</span> <span class="op">&lt;=</span> processed_events <span class="op">&lt;</span> <span class="dv">40000</span>:</span>
<span id="cb3-1502"><a href="#cb3-1502" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_time <span class="op">&gt;</span> <span class="dv">300</span>:</span>
<span id="cb3-1503"><a href="#cb3-1503" aria-hidden="true" tabindex="-1"></a>                        bad_channels_dict_25000_40000.append(channel)</span>
<span id="cb3-1504"><a href="#cb3-1504" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_time <span class="op">&lt;=</span> <span class="dv">300</span>:</span>
<span id="cb3-1505"><a href="#cb3-1505" aria-hidden="true" tabindex="-1"></a>                        good_channels_dict_25000_40000.append(channel)</span>
<span id="cb3-1506"><a href="#cb3-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1507"><a href="#cb3-1507" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">12</span>))</span>
<span id="cb3-1508"><a href="#cb3-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1509"><a href="#cb3-1509" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plotting good channels</span></span>
<span id="cb3-1510"><a href="#cb3-1510" aria-hidden="true" tabindex="-1"></a>            plt.subplot(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-1511"><a href="#cb3-1511" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict_0_15000:</span>
<span id="cb3-1512"><a href="#cb3-1512" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict_0_15000, bins<span class="op">=</span>bins, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1513"><a href="#cb3-1513" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (0-15000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1514"><a href="#cb3-1514" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> good_channels_dict_25000_40000:</span>
<span id="cb3-1515"><a href="#cb3-1515" aria-hidden="true" tabindex="-1"></a>                plt.hist(good_channels_dict_25000_40000, bins<span class="op">=</span>bins, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span>colors[tdc],</span>
<span id="cb3-1516"><a href="#cb3-1516" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (25000-40000)'</span>, histtype<span class="op">=</span><span class="st">'step'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1517"><a href="#cb3-1517" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Channel'</span>)</span>
<span id="cb3-1518"><a href="#cb3-1518" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1519"><a href="#cb3-1519" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Alignment Channels Histogram for TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1520"><a href="#cb3-1520" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb3-1521"><a href="#cb3-1521" aria-hidden="true" tabindex="-1"></a>            plt.xlim(<span class="dv">0</span>, <span class="dv">128</span>)</span>
<span id="cb3-1522"><a href="#cb3-1522" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1523"><a href="#cb3-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1524"><a href="#cb3-1524" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb3-1525"><a href="#cb3-1525" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb3-1526"><a href="#cb3-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1527"><a href="#cb3-1527" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plotting bad channels</span></span>
<span id="cb3-1528"><a href="#cb3-1528" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.subplot(2, 1, 2)</span></span>
<span id="cb3-1529"><a href="#cb3-1529" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if bad_channels_dict_0_15000:</span></span>
<span id="cb3-1530"><a href="#cb3-1530" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     plt.hist(bad_channels_dict_0_15000, bins=128, alpha=0.7, edgecolor=colors[tdc],</span></span>
<span id="cb3-1531"><a href="#cb3-1531" aria-hidden="true" tabindex="-1"></a>            <span class="co">#             label=f'TDC {tdc} (0-15000)', histtype='step', linewidth=2, color=colors[tdc])</span></span>
<span id="cb3-1532"><a href="#cb3-1532" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if bad_channels_dict_25000_40000:</span></span>
<span id="cb3-1533"><a href="#cb3-1533" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     plt.hist(bad_channels_dict_25000_40000, bins=128, alpha=0.7, edgecolor=colors[tdc],</span></span>
<span id="cb3-1534"><a href="#cb3-1534" aria-hidden="true" tabindex="-1"></a>            <span class="co">#             label=f'TDC {tdc} (25000-40000)', histtype='step', linewidth=2, linestyle='--', color=colors[tdc])</span></span>
<span id="cb3-1535"><a href="#cb3-1535" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.xlabel('Channel')</span></span>
<span id="cb3-1536"><a href="#cb3-1536" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.ylabel('Events')</span></span>
<span id="cb3-1537"><a href="#cb3-1537" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.title(f'Bad Times Channels Histogram for TDC {tdc}')</span></span>
<span id="cb3-1538"><a href="#cb3-1538" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.legend()</span></span>
<span id="cb3-1539"><a href="#cb3-1539" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.grid(True)</span></span>
<span id="cb3-1540"><a href="#cb3-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1541"><a href="#cb3-1541" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.tight_layout()</span></span>
<span id="cb3-1542"><a href="#cb3-1542" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.show()</span></span>
<span id="cb3-1543"><a href="#cb3-1543" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1544"><a href="#cb3-1544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_tdc_alignment_times_separate_ranges(<span class="va">self</span>):</span>
<span id="cb3-1545"><a href="#cb3-1545" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-1546"><a href="#cb3-1546" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'purple'</span>, <span class="st">'orange'</span>]</span>
<span id="cb3-1547"><a href="#cb3-1547" aria-hidden="true" tabindex="-1"></a>        bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">1251</span>, <span class="dv">50</span>)) <span class="op">+</span> [<span class="bu">float</span>(<span class="st">'inf'</span>)]</span>
<span id="cb3-1548"><a href="#cb3-1548" aria-hidden="true" tabindex="-1"></a>        text_offset <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb3-1549"><a href="#cb3-1549" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1550"><a href="#cb3-1550" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tdc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1551"><a href="#cb3-1551" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb3-1552"><a href="#cb3-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1553"><a href="#cb3-1553" aria-hidden="true" tabindex="-1"></a>            min_times_0_15000 <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.TDC_alignment_time[tdc] <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> entry[<span class="dv">2</span>] <span class="op">&lt;</span> <span class="dv">15000</span>]</span>
<span id="cb3-1554"><a href="#cb3-1554" aria-hidden="true" tabindex="-1"></a>            min_times_25000_40000 <span class="op">=</span> [entry[<span class="dv">0</span>] <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.TDC_alignment_time[tdc] <span class="cf">if</span> <span class="dv">25000</span> <span class="op">&lt;=</span> entry[<span class="dv">2</span>] <span class="op">&lt;</span> <span class="dv">40000</span>]</span>
<span id="cb3-1555"><a href="#cb3-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1556"><a href="#cb3-1556" aria-hidden="true" tabindex="-1"></a>            counts_0_15000, bin_edges_0_15000 <span class="op">=</span> np.histogram(min_times_0_15000, bins<span class="op">=</span>bins)</span>
<span id="cb3-1557"><a href="#cb3-1557" aria-hidden="true" tabindex="-1"></a>            counts_25000_40000, bin_edges_25000_40000 <span class="op">=</span> np.histogram(min_times_25000_40000, bins<span class="op">=</span>bins)</span>
<span id="cb3-1558"><a href="#cb3-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1559"><a href="#cb3-1559" aria-hidden="true" tabindex="-1"></a>            bin_centers_0_15000 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges_0_15000[<span class="dv">1</span>:] <span class="op">+</span> bin_edges_0_15000[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1560"><a href="#cb3-1560" aria-hidden="true" tabindex="-1"></a>            bin_centers_25000_40000 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (bin_edges_25000_40000[<span class="dv">1</span>:] <span class="op">+</span> bin_edges_25000_40000[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-1561"><a href="#cb3-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1562"><a href="#cb3-1562" aria-hidden="true" tabindex="-1"></a>            bin_centers_0_15000[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1563"><a href="#cb3-1563" aria-hidden="true" tabindex="-1"></a>            bin_centers_25000_40000[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1251</span></span>
<span id="cb3-1564"><a href="#cb3-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1565"><a href="#cb3-1565" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers_0_15000, counts_0_15000, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (0-15000)'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1566"><a href="#cb3-1566" aria-hidden="true" tabindex="-1"></a>            plt.plot(bin_centers_25000_40000, counts_25000_40000, label<span class="op">=</span><span class="ss">f'TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss"> (25000-40000)'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span>colors[tdc])</span>
<span id="cb3-1567"><a href="#cb3-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1568"><a href="#cb3-1568" aria-hidden="true" tabindex="-1"></a>            overflow_count_0_15000 <span class="op">=</span> counts_0_15000[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1569"><a href="#cb3-1569" aria-hidden="true" tabindex="-1"></a>            overflow_count_25000_40000 <span class="op">=</span> counts_25000_40000[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-1570"><a href="#cb3-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1571"><a href="#cb3-1571" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count_0_15000 <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1572"><a href="#cb3-1572" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count (0-15000) == </span><span class="sc">{</span>overflow_count_0_15000<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1573"><a href="#cb3-1573" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1574"><a href="#cb3-1574" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1575"><a href="#cb3-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1576"><a href="#cb3-1576" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overflow_count_25000_40000 <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-1577"><a href="#cb3-1577" aria-hidden="true" tabindex="-1"></a>                plt.text(<span class="dv">1200</span>, <span class="dv">100</span> <span class="op">*</span> text_offset, <span class="ss">f'overflow count (25000-40000) == </span><span class="sc">{</span>overflow_count_25000_40000<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb3-1578"><a href="#cb3-1578" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span>colors[tdc], bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-1579"><a href="#cb3-1579" aria-hidden="true" tabindex="-1"></a>                text_offset <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb3-1580"><a href="#cb3-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1581"><a href="#cb3-1581" aria-hidden="true" tabindex="-1"></a>            plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb3-1582"><a href="#cb3-1582" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'min_time'</span>)</span>
<span id="cb3-1583"><a href="#cb3-1583" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Events'</span>)</span>
<span id="cb3-1584"><a href="#cb3-1584" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Histograms of min_time for TDC </span><span class="sc">{</span>tdc<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-1585"><a href="#cb3-1585" aria-hidden="true" tabindex="-1"></a>            plt.xlim(<span class="dv">0</span>, <span class="dv">1300</span>)</span>
<span id="cb3-1586"><a href="#cb3-1586" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb3-1587"><a href="#cb3-1587" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb3-1588"><a href="#cb3-1588" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb3-1589"><a href="#cb3-1589" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1590"><a href="#cb3-1590" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1591"><a href="#cb3-1591" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rpcHitToTdcChan(rpc, rpcChan, eta):</span>
<span id="cb3-1592"><a href="#cb3-1592" aria-hidden="true" tabindex="-1"></a>    tdc <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1593"><a href="#cb3-1593" aria-hidden="true" tabindex="-1"></a>    tdcChannel <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1594"><a href="#cb3-1594" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1595"><a href="#cb3-1595" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rpc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-1596"><a href="#cb3-1596" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1597"><a href="#cb3-1597" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1598"><a href="#cb3-1598" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1599"><a href="#cb3-1599" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan</span>
<span id="cb3-1600"><a href="#cb3-1600" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1601"><a href="#cb3-1601" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1602"><a href="#cb3-1602" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1603"><a href="#cb3-1603" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1604"><a href="#cb3-1604" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1605"><a href="#cb3-1605" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb3-1606"><a href="#cb3-1606" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1607"><a href="#cb3-1607" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1608"><a href="#cb3-1608" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rpc <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb3-1609"><a href="#cb3-1609" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1610"><a href="#cb3-1610" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1611"><a href="#cb3-1611" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1612"><a href="#cb3-1612" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">96</span></span>
<span id="cb3-1613"><a href="#cb3-1613" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1614"><a href="#cb3-1614" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1615"><a href="#cb3-1615" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1616"><a href="#cb3-1616" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1617"><a href="#cb3-1617" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1618"><a href="#cb3-1618" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan</span>
<span id="cb3-1619"><a href="#cb3-1619" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1620"><a href="#cb3-1620" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1621"><a href="#cb3-1621" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rpc <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb3-1622"><a href="#cb3-1622" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1623"><a href="#cb3-1623" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1624"><a href="#cb3-1624" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1625"><a href="#cb3-1625" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">64</span></span>
<span id="cb3-1626"><a href="#cb3-1626" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1627"><a href="#cb3-1627" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1628"><a href="#cb3-1628" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1629"><a href="#cb3-1629" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1630"><a href="#cb3-1630" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1631"><a href="#cb3-1631" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb3-1632"><a href="#cb3-1632" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> rpcChan <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1633"><a href="#cb3-1633" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1634"><a href="#cb3-1634" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">96</span></span>
<span id="cb3-1635"><a href="#cb3-1635" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1636"><a href="#cb3-1636" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1637"><a href="#cb3-1637" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rpc <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-1638"><a href="#cb3-1638" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1639"><a href="#cb3-1639" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1640"><a href="#cb3-1640" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1641"><a href="#cb3-1641" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb3-1642"><a href="#cb3-1642" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1643"><a href="#cb3-1643" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1644"><a href="#cb3-1644" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1645"><a href="#cb3-1645" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1646"><a href="#cb3-1646" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1647"><a href="#cb3-1647" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">64</span></span>
<span id="cb3-1648"><a href="#cb3-1648" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1649"><a href="#cb3-1649" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1650"><a href="#cb3-1650" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rpc <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-1651"><a href="#cb3-1651" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1652"><a href="#cb3-1652" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1653"><a href="#cb3-1653" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb3-1654"><a href="#cb3-1654" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan</span>
<span id="cb3-1655"><a href="#cb3-1655" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1656"><a href="#cb3-1656" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1657"><a href="#cb3-1657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1658"><a href="#cb3-1658" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1659"><a href="#cb3-1659" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb3-1660"><a href="#cb3-1660" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb3-1661"><a href="#cb3-1661" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1662"><a href="#cb3-1662" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1663"><a href="#cb3-1663" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> rpc <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb3-1664"><a href="#cb3-1664" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eta:</span>
<span id="cb3-1665"><a href="#cb3-1665" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rpcChan <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1666"><a href="#cb3-1666" aria-hidden="true" tabindex="-1"></a>                tdc <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb3-1667"><a href="#cb3-1667" aria-hidden="true" tabindex="-1"></a>                tdcChannel <span class="op">=</span> rpcChan <span class="op">+</span> <span class="dv">96</span></span>
<span id="cb3-1668"><a href="#cb3-1668" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1669"><a href="#cb3-1669" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Invalid rpcChan for this combination</span></span>
<span id="cb3-1670"><a href="#cb3-1670" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1671"><a href="#cb3-1671" aria-hidden="true" tabindex="-1"></a>            tdc <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb3-1672"><a href="#cb3-1672" aria-hidden="true" tabindex="-1"></a>            tdcChannel <span class="op">=</span> rpcChan</span>
<span id="cb3-1673"><a href="#cb3-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1674"><a href="#cb3-1674" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> tdcChannel <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb3-1675"><a href="#cb3-1675" aria-hidden="true" tabindex="-1"></a>        <span class="co"># word = (tdcChannel &lt;&lt; 24) &amp; 0x7f000000</span></span>
<span id="cb3-1676"><a href="#cb3-1676" aria-hidden="true" tabindex="-1"></a>        <span class="co"># word |= rpcChan &amp; 0xfffff</span></span>
<span id="cb3-1677"><a href="#cb3-1677" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tdc, tdcChannel</span>
<span id="cb3-1678"><a href="#cb3-1678" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-1679"><a href="#cb3-1679" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="va">None</span></span>
<span id="cb3-1680"><a href="#cb3-1680" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1681"><a href="#cb3-1681" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb3-1682"><a href="#cb3-1682" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tdcChanToRPCHit(word, tdc, event_num):</span>
<span id="cb3-1683"><a href="#cb3-1683" aria-hidden="true" tabindex="-1"></a>        tdcChannel <span class="op">=</span> (word <span class="op">&gt;&gt;</span> <span class="dv">24</span>) <span class="op">&amp;</span> <span class="bn">0x7f</span></span>
<span id="cb3-1684"><a href="#cb3-1684" aria-hidden="true" tabindex="-1"></a>        tdcHitTime <span class="op">=</span> word <span class="op">&amp;</span> <span class="bn">0xfffff</span></span>
<span id="cb3-1685"><a href="#cb3-1685" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1686"><a href="#cb3-1686" aria-hidden="true" tabindex="-1"></a>        rpcChan <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-1687"><a href="#cb3-1687" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-1688"><a href="#cb3-1688" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tdcChannel <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1689"><a href="#cb3-1689" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel</span>
<span id="cb3-1690"><a href="#cb3-1690" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1691"><a href="#cb3-1691" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1692"><a href="#cb3-1692" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> tdcChannel <span class="op">&lt;</span> <span class="dv">96</span>:</span>
<span id="cb3-1693"><a href="#cb3-1693" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">32</span></span>
<span id="cb3-1694"><a href="#cb3-1694" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1695"><a href="#cb3-1695" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1696"><a href="#cb3-1696" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1697"><a href="#cb3-1697" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">96</span></span>
<span id="cb3-1698"><a href="#cb3-1698" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1699"><a href="#cb3-1699" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1700"><a href="#cb3-1700" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> tdc <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb3-1701"><a href="#cb3-1701" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tdcChannel <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1702"><a href="#cb3-1702" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel</span>
<span id="cb3-1703"><a href="#cb3-1703" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1704"><a href="#cb3-1704" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1705"><a href="#cb3-1705" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> tdcChannel <span class="op">&lt;</span> <span class="dv">96</span>:</span>
<span id="cb3-1706"><a href="#cb3-1706" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">64</span></span>
<span id="cb3-1707"><a href="#cb3-1707" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1708"><a href="#cb3-1708" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1709"><a href="#cb3-1709" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1710"><a href="#cb3-1710" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">96</span></span>
<span id="cb3-1711"><a href="#cb3-1711" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1712"><a href="#cb3-1712" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1713"><a href="#cb3-1713" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> tdc <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb3-1714"><a href="#cb3-1714" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tdcChannel <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1715"><a href="#cb3-1715" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">+</span> <span class="dv">32</span></span>
<span id="cb3-1716"><a href="#cb3-1716" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1717"><a href="#cb3-1717" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-1718"><a href="#cb3-1718" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> tdcChannel <span class="op">&lt;</span> <span class="dv">64</span>:</span>
<span id="cb3-1719"><a href="#cb3-1719" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">32</span></span>
<span id="cb3-1720"><a href="#cb3-1720" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1721"><a href="#cb3-1721" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb3-1722"><a href="#cb3-1722" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> tdcChannel <span class="op">&lt;</span> <span class="dv">128</span>:</span>
<span id="cb3-1723"><a href="#cb3-1723" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">64</span></span>
<span id="cb3-1724"><a href="#cb3-1724" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1725"><a href="#cb3-1725" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb3-1726"><a href="#cb3-1726" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> tdc <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-1727"><a href="#cb3-1727" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tdcChannel <span class="op">&lt;</span> <span class="dv">32</span>:</span>
<span id="cb3-1728"><a href="#cb3-1728" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel</span>
<span id="cb3-1729"><a href="#cb3-1729" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1730"><a href="#cb3-1730" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb3-1731"><a href="#cb3-1731" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> tdcChannel <span class="op">&lt;</span> <span class="dv">96</span>:</span>
<span id="cb3-1732"><a href="#cb3-1732" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">32</span></span>
<span id="cb3-1733"><a href="#cb3-1733" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1734"><a href="#cb3-1734" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb3-1735"><a href="#cb3-1735" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1736"><a href="#cb3-1736" aria-hidden="true" tabindex="-1"></a>                rpcChan <span class="op">=</span> tdcChannel <span class="op">-</span> <span class="dv">96</span></span>
<span id="cb3-1737"><a href="#cb3-1737" aria-hidden="true" tabindex="-1"></a>                eta <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1738"><a href="#cb3-1738" aria-hidden="true" tabindex="-1"></a>                rpc <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-1739"><a href="#cb3-1739" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> tdc <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-1740"><a href="#cb3-1740" aria-hidden="true" tabindex="-1"></a>            rpcChan <span class="op">=</span> tdcChannel</span>
<span id="cb3-1741"><a href="#cb3-1741" aria-hidden="true" tabindex="-1"></a>            eta <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1742"><a href="#cb3-1742" aria-hidden="true" tabindex="-1"></a>            rpc <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-1743"><a href="#cb3-1743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rpc, rpcHit(rpcChan, tdcHitTime <span class="op">*</span> <span class="fl">0.8</span>, eta, event_num, rpc)</span>
<span id="cb3-1744"><a href="#cb3-1744" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Unpack_event(eventList, processedEvents):</span>
<span id="cb3-1745"><a href="#cb3-1745" aria-hidden="true" tabindex="-1"></a>    allEtaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1746"><a href="#cb3-1746" aria-hidden="true" tabindex="-1"></a>    allPhiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1747"><a href="#cb3-1747" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event_num, event <span class="kw">in</span> <span class="bu">enumerate</span>(eventList):</span>
<span id="cb3-1748"><a href="#cb3-1748" aria-hidden="true" tabindex="-1"></a>        etaHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1749"><a href="#cb3-1749" aria-hidden="true" tabindex="-1"></a>        phiHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-1750"><a href="#cb3-1750" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb3-1751"><a href="#cb3-1751" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> word <span class="kw">in</span> event.tdcEvents[i].words:</span>
<span id="cb3-1752"><a href="#cb3-1752" aria-hidden="true" tabindex="-1"></a>                rpc, thisHit <span class="op">=</span> tdcChanToRPCHit(word, i, processedEvents <span class="op">-</span> <span class="bu">len</span>(eventList) <span class="op">+</span> event_num <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-1753"><a href="#cb3-1753" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> thisHit.eta:</span>
<span id="cb3-1754"><a href="#cb3-1754" aria-hidden="true" tabindex="-1"></a>                    etaHits[thisHit.rpc].append(thisHit)</span>
<span id="cb3-1755"><a href="#cb3-1755" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1756"><a href="#cb3-1756" aria-hidden="true" tabindex="-1"></a>                    phiHits[thisHit.rpc].append(thisHit)</span>
<span id="cb3-1757"><a href="#cb3-1757" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-1758"><a href="#cb3-1758" aria-hidden="true" tabindex="-1"></a>            allEtaHits[rpc].extend(etaHits[rpc])</span>
<span id="cb3-1759"><a href="#cb3-1759" aria-hidden="true" tabindex="-1"></a>            allPhiHits[rpc].extend(phiHits[rpc])</span>
<span id="cb3-1760"><a href="#cb3-1760" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> allEtaHits, allPhiHits</span>
<span id="cb3-1761"><a href="#cb3-1761" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> FindCoincidentHits(etaHits, phiHits, time_window, tof_correction <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb3-1762"><a href="#cb3-1762" aria-hidden="true" tabindex="-1"></a>    <span class="co"># global interest</span></span>
<span id="cb3-1763"><a href="#cb3-1763" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interest = []</span></span>
<span id="cb3-1764"><a href="#cb3-1764" aria-hidden="true" tabindex="-1"></a>    channels <span class="op">=</span> []</span>
<span id="cb3-1765"><a href="#cb3-1765" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1766"><a href="#cb3-1766" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine etaHits and phiHits from all RPCs</span></span>
<span id="cb3-1767"><a href="#cb3-1767" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-1768"><a href="#cb3-1768" aria-hidden="true" tabindex="-1"></a>        channels <span class="op">+=</span> [hit <span class="cf">for</span> hit <span class="kw">in</span> etaHits[RPC] <span class="cf">if</span> <span class="dv">150</span> <span class="op">&lt;=</span> hit.time <span class="op">&lt;=</span> <span class="dv">300</span> <span class="kw">and</span> hit.channel <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb3-1769"><a href="#cb3-1769" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1770"><a href="#cb3-1770" aria-hidden="true" tabindex="-1"></a>        channels <span class="op">+=</span> [hit <span class="cf">for</span> hit <span class="kw">in</span> phiHits[RPC] <span class="cf">if</span> <span class="dv">150</span> <span class="op">&lt;=</span> hit.time <span class="op">&lt;=</span> <span class="dv">300</span> <span class="kw">and</span> hit.channel <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb3-1771"><a href="#cb3-1771" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort events by event number and then by time within each event</span></span>
<span id="cb3-1772"><a href="#cb3-1772" aria-hidden="true" tabindex="-1"></a>    event_sorted <span class="op">=</span> <span class="bu">sorted</span>(channels, key<span class="op">=</span><span class="kw">lambda</span> rpcHit: (rpcHit.event_num, rpcHit.time))</span>
<span id="cb3-1773"><a href="#cb3-1773" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1774"><a href="#cb3-1774" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by event number</span></span>
<span id="cb3-1775"><a href="#cb3-1775" aria-hidden="true" tabindex="-1"></a>    grouped_and_sorted <span class="op">=</span> {key: <span class="bu">list</span>(group) </span>
<span id="cb3-1776"><a href="#cb3-1776" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> key, group <span class="kw">in</span> groupby(event_sorted, <span class="kw">lambda</span> rpcHit: rpcHit.event_num)}</span>
<span id="cb3-1777"><a href="#cb3-1777" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1778"><a href="#cb3-1778" aria-hidden="true" tabindex="-1"></a>    coincident_hits <span class="op">=</span> []</span>
<span id="cb3-1779"><a href="#cb3-1779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1780"><a href="#cb3-1780" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event_num, hits <span class="kw">in</span> grouped_and_sorted.items():</span>
<span id="cb3-1781"><a href="#cb3-1781" aria-hidden="true" tabindex="-1"></a>        temp_hits <span class="op">=</span> []</span>
<span id="cb3-1782"><a href="#cb3-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1783"><a href="#cb3-1783" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(hits) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb3-1784"><a href="#cb3-1784" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tof_correction:</span>
<span id="cb3-1785"><a href="#cb3-1785" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> hits[i].eta <span class="kw">and</span> <span class="kw">not</span> hits[i<span class="op">+</span><span class="dv">1</span>].eta:</span>
<span id="cb3-1786"><a href="#cb3-1786" aria-hidden="true" tabindex="-1"></a>                    correction <span class="op">=</span> find_tof_time(hits[i], hits[i<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb3-1787"><a href="#cb3-1787" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="kw">not</span> hits[i] <span class="kw">and</span> hits[i<span class="op">+</span><span class="dv">1</span>].eta:</span>
<span id="cb3-1788"><a href="#cb3-1788" aria-hidden="true" tabindex="-1"></a>                    correction <span class="op">=</span> find_tof_time(hits[i<span class="op">+</span><span class="dv">1</span>], hits[i])</span>
<span id="cb3-1789"><a href="#cb3-1789" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1790"><a href="#cb3-1790" aria-hidden="true" tabindex="-1"></a>                    correction <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1791"><a href="#cb3-1791" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-1792"><a href="#cb3-1792" aria-hidden="true" tabindex="-1"></a>                correction <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1793"><a href="#cb3-1793" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-1794"><a href="#cb3-1794" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(hits[i<span class="op">+</span><span class="dv">1</span>].time <span class="op">-</span> hits[i].time <span class="op">-</span> correction) <span class="op">&lt;=</span> time_window:</span>
<span id="cb3-1795"><a href="#cb3-1795" aria-hidden="true" tabindex="-1"></a>                temp_hits.append(hits[i])</span>
<span id="cb3-1796"><a href="#cb3-1796" aria-hidden="true" tabindex="-1"></a>                temp_hits.append(hits[i<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb3-1797"><a href="#cb3-1797" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-1798"><a href="#cb3-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1799"><a href="#cb3-1799" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> temp_hits:</span>
<span id="cb3-1800"><a href="#cb3-1800" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Remove duplicates and sort by time</span></span>
<span id="cb3-1801"><a href="#cb3-1801" aria-hidden="true" tabindex="-1"></a>                unique_hits <span class="op">=</span> { (hit.channel, hit.time, hit.eta, hit.event_num, hit.rpc): hit <span class="cf">for</span> hit <span class="kw">in</span> temp_hits }.values()</span>
<span id="cb3-1802"><a href="#cb3-1802" aria-hidden="true" tabindex="-1"></a>                eta_hits <span class="op">=</span> [hit <span class="cf">for</span> hit <span class="kw">in</span> unique_hits <span class="cf">if</span> hit.eta]</span>
<span id="cb3-1803"><a href="#cb3-1803" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> eta_hits:</span>
<span id="cb3-1804"><a href="#cb3-1804" aria-hidden="true" tabindex="-1"></a>                    time_bin <span class="op">=</span> <span class="bu">min</span>(hit.time <span class="cf">for</span> hit <span class="kw">in</span> eta_hits)</span>
<span id="cb3-1805"><a href="#cb3-1805" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1806"><a href="#cb3-1806" aria-hidden="true" tabindex="-1"></a>                    time_bin <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-1807"><a href="#cb3-1807" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-1808"><a href="#cb3-1808" aria-hidden="true" tabindex="-1"></a>                coincident_hits.append([</span>
<span id="cb3-1809"><a href="#cb3-1809" aria-hidden="true" tabindex="-1"></a>                    event_num,</span>
<span id="cb3-1810"><a href="#cb3-1810" aria-hidden="true" tabindex="-1"></a>                    time_bin,</span>
<span id="cb3-1811"><a href="#cb3-1811" aria-hidden="true" tabindex="-1"></a>                    [[hit.rpc, hit.channel, hit.time, hit.eta] <span class="cf">for</span> hit <span class="kw">in</span> unique_hits]</span>
<span id="cb3-1812"><a href="#cb3-1812" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb3-1813"><a href="#cb3-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1814"><a href="#cb3-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1815"><a href="#cb3-1815" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coincident_hits</span>
<span id="cb3-1816"><a href="#cb3-1816" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cluster(coincident_hits):</span>
<span id="cb3-1817"><a href="#cb3-1817" aria-hidden="true" tabindex="-1"></a>    coincident_hits_clustered <span class="op">=</span> []</span>
<span id="cb3-1818"><a href="#cb3-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1819"><a href="#cb3-1819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> coincidence_event <span class="kw">in</span> coincident_hits:</span>
<span id="cb3-1820"><a href="#cb3-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1821"><a href="#cb3-1821" aria-hidden="true" tabindex="-1"></a>        coincident_event_clustered <span class="op">=</span> [coincidence_event[<span class="dv">0</span>], coincidence_event[<span class="dv">1</span>], []]</span>
<span id="cb3-1822"><a href="#cb3-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1823"><a href="#cb3-1823" aria-hidden="true" tabindex="-1"></a>        hit_locations <span class="op">=</span> coincidence_event[<span class="dv">2</span>]</span>
<span id="cb3-1824"><a href="#cb3-1824" aria-hidden="true" tabindex="-1"></a>        phi_locations <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> hit_locations <span class="cf">if</span> x[<span class="dv">3</span>] <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb3-1825"><a href="#cb3-1825" aria-hidden="true" tabindex="-1"></a>        eta_locations <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> hit_locations <span class="cf">if</span> x[<span class="dv">3</span>] <span class="op">==</span> <span class="va">True</span>]</span>
<span id="cb3-1826"><a href="#cb3-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1827"><a href="#cb3-1827" aria-hidden="true" tabindex="-1"></a>        phi_locations <span class="op">=</span> <span class="bu">sorted</span>(phi_locations, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb3-1828"><a href="#cb3-1828" aria-hidden="true" tabindex="-1"></a>        eta_locations <span class="op">=</span> <span class="bu">sorted</span>(eta_locations, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb3-1829"><a href="#cb3-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1830"><a href="#cb3-1830" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-1831"><a href="#cb3-1831" aria-hidden="true" tabindex="-1"></a>            rpc_phi_clusters <span class="op">=</span> []</span>
<span id="cb3-1832"><a href="#cb3-1832" aria-hidden="true" tabindex="-1"></a>            rpc_eta_clusters <span class="op">=</span> []</span>
<span id="cb3-1833"><a href="#cb3-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1834"><a href="#cb3-1834" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1835"><a href="#cb3-1835" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> index, hit <span class="kw">in</span> <span class="bu">enumerate</span>([x <span class="cf">for</span> x <span class="kw">in</span> phi_locations <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> RPC]):</span>
<span id="cb3-1836"><a href="#cb3-1836" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> index <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-1837"><a href="#cb3-1837" aria-hidden="true" tabindex="-1"></a>                    previous_element <span class="op">=</span> hit[<span class="dv">1</span>]</span>
<span id="cb3-1838"><a href="#cb3-1838" aria-hidden="true" tabindex="-1"></a>                    rpc_phi_clusters.append([hit])</span>
<span id="cb3-1839"><a href="#cb3-1839" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1840"><a href="#cb3-1840" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">abs</span>(hit[<span class="dv">1</span>] <span class="op">-</span> previous_element) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb3-1841"><a href="#cb3-1841" aria-hidden="true" tabindex="-1"></a>                        rpc_phi_clusters.append([hit])</span>
<span id="cb3-1842"><a href="#cb3-1842" aria-hidden="true" tabindex="-1"></a>                        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-1843"><a href="#cb3-1843" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-1844"><a href="#cb3-1844" aria-hidden="true" tabindex="-1"></a>                        rpc_phi_clusters[i].append(hit)</span>
<span id="cb3-1845"><a href="#cb3-1845" aria-hidden="true" tabindex="-1"></a>                    previous_element <span class="op">=</span> hit[<span class="dv">1</span>]</span>
<span id="cb3-1846"><a href="#cb3-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1847"><a href="#cb3-1847" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1848"><a href="#cb3-1848" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> index, hit <span class="kw">in</span> <span class="bu">enumerate</span>([x <span class="cf">for</span> x <span class="kw">in</span> eta_locations <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> RPC]):</span>
<span id="cb3-1849"><a href="#cb3-1849" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> index <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-1850"><a href="#cb3-1850" aria-hidden="true" tabindex="-1"></a>                    previous_element <span class="op">=</span> hit[<span class="dv">1</span>]</span>
<span id="cb3-1851"><a href="#cb3-1851" aria-hidden="true" tabindex="-1"></a>                    rpc_eta_clusters.append([hit])</span>
<span id="cb3-1852"><a href="#cb3-1852" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-1853"><a href="#cb3-1853" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">abs</span>(hit[<span class="dv">1</span>] <span class="op">-</span> previous_element) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb3-1854"><a href="#cb3-1854" aria-hidden="true" tabindex="-1"></a>                        rpc_eta_clusters.append([hit])</span>
<span id="cb3-1855"><a href="#cb3-1855" aria-hidden="true" tabindex="-1"></a>                        j <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-1856"><a href="#cb3-1856" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-1857"><a href="#cb3-1857" aria-hidden="true" tabindex="-1"></a>                        rpc_eta_clusters[j].append(hit)</span>
<span id="cb3-1858"><a href="#cb3-1858" aria-hidden="true" tabindex="-1"></a>                    previous_element <span class="op">=</span> hit[<span class="dv">1</span>]</span>
<span id="cb3-1859"><a href="#cb3-1859" aria-hidden="true" tabindex="-1"></a>            rpc_combined <span class="op">=</span> [rpc_phi_clusters, rpc_eta_clusters]</span>
<span id="cb3-1860"><a href="#cb3-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1861"><a href="#cb3-1861" aria-hidden="true" tabindex="-1"></a>            coincident_event_clustered[<span class="dv">2</span>].append(rpc_combined)</span>
<span id="cb3-1862"><a href="#cb3-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1863"><a href="#cb3-1863" aria-hidden="true" tabindex="-1"></a>        coincident_hits_clustered.append(coincident_event_clustered)</span>
<span id="cb3-1864"><a href="#cb3-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1865"><a href="#cb3-1865" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coincident_hits_clustered</span>
<span id="cb3-1866"><a href="#cb3-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1867"><a href="#cb3-1867" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_tof_time(eta, phi):</span>
<span id="cb3-1868"><a href="#cb3-1868" aria-hidden="true" tabindex="-1"></a>    slope <span class="op">=</span> <span class="fl">0.05426554612593516</span></span>
<span id="cb3-1869"><a href="#cb3-1869" aria-hidden="true" tabindex="-1"></a>    offSet <span class="op">=</span> <span class="fl">15.8797407836404</span></span>
<span id="cb3-1870"><a href="#cb3-1870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">len</span>(<span class="bu">set</span>([eta.eta, phi.eta])) <span class="op">==</span> <span class="dv">1</span>):</span>
<span id="cb3-1871"><a href="#cb3-1871" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb3-1872"><a href="#cb3-1872" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-1873"><a href="#cb3-1873" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> slope<span class="op">*</span>(phi.channel<span class="op">-</span>eta.channel)<span class="op">-</span>offSet</span>
<span id="cb3-1874"><a href="#cb3-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1875"><a href="#cb3-1875" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_event_attributes(event,min_chamber_number,min_RPC_number):</span>
<span id="cb3-1876"><a href="#cb3-1876" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Used in filter_events() function to decide whether or not to save an event as described by the user's inputs.</span></span>
<span id="cb3-1877"><a href="#cb3-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1878"><a href="#cb3-1878" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x',TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-1879"><a href="#cb3-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1880"><a href="#cb3-1880" aria-hidden="true" tabindex="-1"></a>    RPC_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1881"><a href="#cb3-1881" aria-hidden="true" tabindex="-1"></a>    chamber_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-1882"><a href="#cb3-1882" aria-hidden="true" tabindex="-1"></a>    condition_1 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1883"><a href="#cb3-1883" aria-hidden="true" tabindex="-1"></a>    condition_2 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1884"><a href="#cb3-1884" aria-hidden="true" tabindex="-1"></a>    condition_3 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-1885"><a href="#cb3-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1886"><a href="#cb3-1886" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-1887"><a href="#cb3-1887" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> RPC<span class="op">&lt;</span><span class="dv">3</span>:</span>
<span id="cb3-1888"><a href="#cb3-1888" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Checking triplet layer.</span></span>
<span id="cb3-1889"><a href="#cb3-1889" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> event[<span class="dv">2</span>][RPC][<span class="dv">0</span>] <span class="kw">and</span> event[<span class="dv">2</span>][RPC][<span class="dv">1</span>]:</span>
<span id="cb3-1890"><a href="#cb3-1890" aria-hidden="true" tabindex="-1"></a>                <span class="co">#Reqiure       phi^              and               eta^       strips to go off</span></span>
<span id="cb3-1891"><a href="#cb3-1891" aria-hidden="true" tabindex="-1"></a>                RPC_counter<span class="op">+=</span><span class="dv">1</span> </span>
<span id="cb3-1892"><a href="#cb3-1892" aria-hidden="true" tabindex="-1"></a>                <span class="co">#If RPC has two eta and phi strips going off then consider it "hit"</span></span>
<span id="cb3-1893"><a href="#cb3-1893" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> condition_1:</span>
<span id="cb3-1894"><a href="#cb3-1894" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#Count triplet chamber being hit.</span></span>
<span id="cb3-1895"><a href="#cb3-1895" aria-hidden="true" tabindex="-1"></a>                    chamber_counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-1896"><a href="#cb3-1896" aria-hidden="true" tabindex="-1"></a>                    condition_1 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1897"><a href="#cb3-1897" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> RPC <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-1898"><a href="#cb3-1898" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Singlet layer</span></span>
<span id="cb3-1899"><a href="#cb3-1899" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> event[<span class="dv">2</span>][RPC][<span class="dv">0</span>] <span class="kw">and</span> event[<span class="dv">2</span>][RPC][<span class="dv">1</span>]:</span>
<span id="cb3-1900"><a href="#cb3-1900" aria-hidden="true" tabindex="-1"></a>                RPC_counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-1901"><a href="#cb3-1901" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> condition_2:</span>
<span id="cb3-1902"><a href="#cb3-1902" aria-hidden="true" tabindex="-1"></a>                    chamber_counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-1903"><a href="#cb3-1903" aria-hidden="true" tabindex="-1"></a>                    condition_2 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1904"><a href="#cb3-1904" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-1905"><a href="#cb3-1905" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Doublet layer</span></span>
<span id="cb3-1906"><a href="#cb3-1906" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> event[<span class="dv">2</span>][RPC][<span class="dv">0</span>] <span class="kw">and</span> event[<span class="dv">2</span>][RPC][<span class="dv">1</span>]:</span>
<span id="cb3-1907"><a href="#cb3-1907" aria-hidden="true" tabindex="-1"></a>                RPC_counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-1908"><a href="#cb3-1908" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> condition_3:</span>
<span id="cb3-1909"><a href="#cb3-1909" aria-hidden="true" tabindex="-1"></a>                    chamber_counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-1910"><a href="#cb3-1910" aria-hidden="true" tabindex="-1"></a>                    condition_3 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-1911"><a href="#cb3-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1912"><a href="#cb3-1912" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RPC_counter <span class="op">&gt;=</span> min_RPC_number <span class="kw">and</span> chamber_counter <span class="op">&gt;=</span> min_chamber_number</span>
<span id="cb3-1913"><a href="#cb3-1913" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_events(events,min_chamber_number,min_RPC_number):</span>
<span id="cb3-1914"><a href="#cb3-1914" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Initiliase array of filtered events</span></span>
<span id="cb3-1915"><a href="#cb3-1915" aria-hidden="true" tabindex="-1"></a>    filtered_events <span class="op">=</span> []</span>
<span id="cb3-1916"><a href="#cb3-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1917"><a href="#cb3-1917" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event <span class="kw">in</span> events:</span>
<span id="cb3-1918"><a href="#cb3-1918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> check_event_attributes(event,min_chamber_number,min_RPC_number):</span>
<span id="cb3-1919"><a href="#cb3-1919" aria-hidden="true" tabindex="-1"></a>            filtered_events.append(event)</span>
<span id="cb3-1920"><a href="#cb3-1920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1921"><a href="#cb3-1921" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Number of events in filter = {len(filtered_events)}")</span></span>
<span id="cb3-1922"><a href="#cb3-1922" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1923"><a href="#cb3-1923" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filtered_events</span>
<span id="cb3-1924"><a href="#cb3-1924" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_hit_coords_combo_Chi2(coords, RPC_heights, max_length<span class="op">=</span><span class="va">None</span>, exact_length<span class="op">=</span><span class="va">False</span>, combinations<span class="op">=</span><span class="va">None</span>, hit_coords<span class="op">=</span><span class="va">None</span>, depth<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb3-1925"><a href="#cb3-1925" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> combinations <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1926"><a href="#cb3-1926" aria-hidden="true" tabindex="-1"></a>        combinations <span class="op">=</span> []</span>
<span id="cb3-1927"><a href="#cb3-1927" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hit_coords <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1928"><a href="#cb3-1928" aria-hidden="true" tabindex="-1"></a>        hit_coords <span class="op">=</span> []</span>
<span id="cb3-1929"><a href="#cb3-1929" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_length <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-1930"><a href="#cb3-1930" aria-hidden="true" tabindex="-1"></a>        max_length <span class="op">=</span> <span class="bu">len</span>(coords)</span>
<span id="cb3-1931"><a href="#cb3-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1932"><a href="#cb3-1932" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base case: If we've reached the end of the coords or the length condition is met</span></span>
<span id="cb3-1933"><a href="#cb3-1933" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> depth <span class="op">==</span> <span class="bu">len</span>(coords) <span class="kw">or</span> <span class="bu">len</span>(hit_coords) <span class="op">==</span> max_length:</span>
<span id="cb3-1934"><a href="#cb3-1934" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> exact_length <span class="kw">or</span> <span class="bu">len</span>(hit_coords) <span class="op">==</span> max_length:</span>
<span id="cb3-1935"><a href="#cb3-1935" aria-hidden="true" tabindex="-1"></a>            combinations.append(hit_coords.copy())</span>
<span id="cb3-1936"><a href="#cb3-1936" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> combinations</span>
<span id="cb3-1937"><a href="#cb3-1937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1938"><a href="#cb3-1938" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract x and y values for the current depth</span></span>
<span id="cb3-1939"><a href="#cb3-1939" aria-hidden="true" tabindex="-1"></a>    x_values <span class="op">=</span> coords[depth][<span class="dv">0</span>]</span>
<span id="cb3-1940"><a href="#cb3-1940" aria-hidden="true" tabindex="-1"></a>    y_values <span class="op">=</span> coords[depth][<span class="dv">1</span>]</span>
<span id="cb3-1941"><a href="#cb3-1941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1942"><a href="#cb3-1942" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If there are no x or y values at this depth, move to the next depth</span></span>
<span id="cb3-1943"><a href="#cb3-1943" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> x_values <span class="kw">or</span> <span class="kw">not</span> y_values:</span>
<span id="cb3-1944"><a href="#cb3-1944" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generate_hit_coords_combo_Chi2(coords, RPC_heights, max_length, exact_length, combinations, hit_coords, depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-1945"><a href="#cb3-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1946"><a href="#cb3-1946" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate over all combinations of x and y values</span></span>
<span id="cb3-1947"><a href="#cb3-1947" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> x_values:</span>
<span id="cb3-1948"><a href="#cb3-1948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y <span class="kw">in</span> y_values:</span>
<span id="cb3-1949"><a href="#cb3-1949" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> y <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">isinstance</span>(x[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>)) <span class="kw">and</span> <span class="bu">isinstance</span>(y[<span class="dv">0</span>], (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb3-1950"><a href="#cb3-1950" aria-hidden="true" tabindex="-1"></a>                hit_coords.append([x, y, RPC_heights[depth]])</span>
<span id="cb3-1951"><a href="#cb3-1951" aria-hidden="true" tabindex="-1"></a>                generate_hit_coords_combo_Chi2(coords, RPC_heights, max_length, exact_length, combinations, hit_coords, depth <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-1952"><a href="#cb3-1952" aria-hidden="true" tabindex="-1"></a>                hit_coords.pop()</span>
<span id="cb3-1953"><a href="#cb3-1953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1954"><a href="#cb3-1954" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combinations</span>
<span id="cb3-1955"><a href="#cb3-1955" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_DT_DZ_Chi2(coords, rpc_indices <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>]]):</span>
<span id="cb3-1956"><a href="#cb3-1956" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-1957"><a href="#cb3-1957" aria-hidden="true" tabindex="-1"></a><span class="co">    Extracts the time difference (dT) and height difference (dZ) between specified pairs of RPCs,</span></span>
<span id="cb3-1958"><a href="#cb3-1958" aria-hidden="true" tabindex="-1"></a><span class="co">    correcting for signal propagation speed along the x0 axis.</span></span>
<span id="cb3-1959"><a href="#cb3-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1960"><a href="#cb3-1960" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb3-1961"><a href="#cb3-1961" aria-hidden="true" tabindex="-1"></a><span class="co">    coords (list): A list of coordinates with time information for each RPC.</span></span>
<span id="cb3-1962"><a href="#cb3-1962" aria-hidden="true" tabindex="-1"></a><span class="co">                   Format: [[[x0, var, time], [y0, var], z0], [[x1, var, time], [y1, var], z1], ...]</span></span>
<span id="cb3-1963"><a href="#cb3-1963" aria-hidden="true" tabindex="-1"></a><span class="co">    rpc_indices (list of lists): A list of pairs of indices specifying the RPCs to compare (e.g., [[0, 1], [0, 2]]).</span></span>
<span id="cb3-1964"><a href="#cb3-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1965"><a href="#cb3-1965" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-1966"><a href="#cb3-1966" aria-hidden="true" tabindex="-1"></a><span class="co">    tuple: Two lists containing dT and dZ for each pair of RPC indices.</span></span>
<span id="cb3-1967"><a href="#cb3-1967" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-1968"><a href="#cb3-1968" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1969"><a href="#cb3-1969" aria-hidden="true" tabindex="-1"></a>    dT_all <span class="op">=</span> []</span>
<span id="cb3-1970"><a href="#cb3-1970" aria-hidden="true" tabindex="-1"></a>    dZ_all <span class="op">=</span> []</span>
<span id="cb3-1971"><a href="#cb3-1971" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1972"><a href="#cb3-1972" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Signal propagation speed correction factor</span></span>
<span id="cb3-1973"><a href="#cb3-1973" aria-hidden="true" tabindex="-1"></a>    speed_factor <span class="op">=</span> <span class="fl">0.15204446322001586</span></span>
<span id="cb3-1974"><a href="#cb3-1974" aria-hidden="true" tabindex="-1"></a>    distance_per_phi_channel <span class="op">=</span> <span class="fl">2.7625</span> <span class="co">#cm</span></span>
<span id="cb3-1975"><a href="#cb3-1975" aria-hidden="true" tabindex="-1"></a>    distance_per_eta_channel <span class="op">=</span> <span class="fl">2.9844</span> <span class="co">#cm</span></span>
<span id="cb3-1976"><a href="#cb3-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1977"><a href="#cb3-1977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1978"><a href="#cb3-1978" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Correct times for each RPC based on signal propagation speed</span></span>
<span id="cb3-1979"><a href="#cb3-1979" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> []</span>
<span id="cb3-1980"><a href="#cb3-1980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, coord <span class="kw">in</span> <span class="bu">enumerate</span>(coords):</span>
<span id="cb3-1981"><a href="#cb3-1981" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(coord[<span class="dv">0</span>][<span class="dv">2</span>], (<span class="bu">float</span>, <span class="bu">int</span>)):</span>
<span id="cb3-1982"><a href="#cb3-1982" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(coord[1][0])</span></span>
<span id="cb3-1983"><a href="#cb3-1983" aria-hidden="true" tabindex="-1"></a>            corrected_time <span class="op">=</span> coord[<span class="dv">0</span>][<span class="dv">2</span>] <span class="op">-</span> ((coord[<span class="dv">1</span>][<span class="dv">0</span>] <span class="op">/</span> distance_per_eta_channel) <span class="op">*</span> speed_factor)</span>
<span id="cb3-1984"><a href="#cb3-1984" aria-hidden="true" tabindex="-1"></a>            <span class="co"># corrected_time = 0</span></span>
<span id="cb3-1985"><a href="#cb3-1985" aria-hidden="true" tabindex="-1"></a>            <span class="co"># corrected_time = coord[0][2]</span></span>
<span id="cb3-1986"><a href="#cb3-1986" aria-hidden="true" tabindex="-1"></a>            times.append((i, corrected_time))</span>
<span id="cb3-1987"><a href="#cb3-1987" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-1988"><a href="#cb3-1988" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define heights of middle point of each RPC in cm.</span></span>
<span id="cb3-1989"><a href="#cb3-1989" aria-hidden="true" tabindex="-1"></a>    RPC_heights <span class="op">=</span> [<span class="fl">0.6</span>, <span class="fl">1.8</span>, <span class="fl">3.0</span>, <span class="fl">61.8</span>, <span class="fl">121.8</span>, <span class="dv">123</span>]</span>
<span id="cb3-1990"><a href="#cb3-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1991"><a href="#cb3-1991" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> indices <span class="kw">in</span> rpc_indices:</span>
<span id="cb3-1992"><a href="#cb3-1992" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(times) <span class="op">&gt;</span> <span class="bu">max</span>(indices):</span>
<span id="cb3-1993"><a href="#cb3-1993" aria-hidden="true" tabindex="-1"></a>            t_first_rpc <span class="op">=</span> times[indices[<span class="dv">0</span>]][<span class="dv">1</span>]</span>
<span id="cb3-1994"><a href="#cb3-1994" aria-hidden="true" tabindex="-1"></a>            t_last_rpc <span class="op">=</span> times[indices[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb3-1995"><a href="#cb3-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1996"><a href="#cb3-1996" aria-hidden="true" tabindex="-1"></a>            dT <span class="op">=</span> t_last_rpc <span class="op">-</span> t_first_rpc</span>
<span id="cb3-1997"><a href="#cb3-1997" aria-hidden="true" tabindex="-1"></a>            dZ <span class="op">=</span> RPC_heights[indices[<span class="dv">1</span>]] <span class="op">-</span> RPC_heights[indices[<span class="dv">0</span>]]</span>
<span id="cb3-1998"><a href="#cb3-1998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-1999"><a href="#cb3-1999" aria-hidden="true" tabindex="-1"></a>            dT_all.append(dT)</span>
<span id="cb3-2000"><a href="#cb3-2000" aria-hidden="true" tabindex="-1"></a>            dZ_all.append(dZ)</span>
<span id="cb3-2001"><a href="#cb3-2001" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2002"><a href="#cb3-2002" aria-hidden="true" tabindex="-1"></a>            dT_all.append(<span class="va">None</span>)</span>
<span id="cb3-2003"><a href="#cb3-2003" aria-hidden="true" tabindex="-1"></a>            dZ_all.append(<span class="va">None</span>)</span>
<span id="cb3-2004"><a href="#cb3-2004" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2005"><a href="#cb3-2005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dT_all, dZ_all</span>
<span id="cb3-2006"><a href="#cb3-2006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2007"><a href="#cb3-2007" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_event_chi2(coordinates_with_error, rpc_indicies <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>], [<span class="dv">4</span>,<span class="dv">5</span>]]):</span>
<span id="cb3-2008"><a href="#cb3-2008" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Coordinates = [[[x0,var,time],[y0,var],z0],[[x1,var,time],[y1,var],z1],...,[[x5,var,time],[y5,var],z5]]</span></span>
<span id="cb3-2009"><a href="#cb3-2009" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Z coordinate given by height of relevant RPC.</span></span>
<span id="cb3-2010"><a href="#cb3-2010" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Using SVD</span></span>
<span id="cb3-2011"><a href="#cb3-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2012"><a href="#cb3-2012" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate dT for event, in ns</span></span>
<span id="cb3-2013"><a href="#cb3-2013" aria-hidden="true" tabindex="-1"></a>    dT, dZ <span class="op">=</span> extract_DT_DZ_Chi2(coordinates_with_error, rpc_indices <span class="op">=</span> rpc_indicies)</span>
<span id="cb3-2014"><a href="#cb3-2014" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2015"><a href="#cb3-2015" aria-hidden="true" tabindex="-1"></a>    coordinates <span class="op">=</span> []</span>
<span id="cb3-2016"><a href="#cb3-2016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2017"><a href="#cb3-2017" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> coords <span class="kw">in</span> coordinates_with_error:</span>
<span id="cb3-2018"><a href="#cb3-2018" aria-hidden="true" tabindex="-1"></a>        coordinates.append([coords[<span class="dv">0</span>][<span class="dv">0</span>],coords[<span class="dv">1</span>][<span class="dv">0</span>],coords[<span class="dv">2</span>]])</span>
<span id="cb3-2019"><a href="#cb3-2019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2020"><a href="#cb3-2020" aria-hidden="true" tabindex="-1"></a>    centroid <span class="op">=</span> np.mean(coordinates, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-2021"><a href="#cb3-2021" aria-hidden="true" tabindex="-1"></a>    subtracted <span class="op">=</span> coordinates<span class="op">-</span>centroid</span>
<span id="cb3-2022"><a href="#cb3-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2023"><a href="#cb3-2023" aria-hidden="true" tabindex="-1"></a>    <span class="co"># performing SVD</span></span>
<span id="cb3-2024"><a href="#cb3-2024" aria-hidden="true" tabindex="-1"></a>    _, _, V <span class="op">=</span> np.linalg.svd(subtracted)</span>
<span id="cb3-2025"><a href="#cb3-2025" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2026"><a href="#cb3-2026" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find the direction vector (which is the right singular vector corresponding to the largest singular value)</span></span>
<span id="cb3-2027"><a href="#cb3-2027" aria-hidden="true" tabindex="-1"></a>    direction <span class="op">=</span> V[<span class="dv">0</span>, :]</span>
<span id="cb3-2028"><a href="#cb3-2028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2029"><a href="#cb3-2029" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A line is defined by the average and its direction</span></span>
<span id="cb3-2030"><a href="#cb3-2030" aria-hidden="true" tabindex="-1"></a>    p0 <span class="op">=</span> centroid</span>
<span id="cb3-2031"><a href="#cb3-2031" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> direction</span>
<span id="cb3-2032"><a href="#cb3-2032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2033"><a href="#cb3-2033" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Work out Chi2. Minimise this to find best fit (from possible combos)</span></span>
<span id="cb3-2034"><a href="#cb3-2034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2035"><a href="#cb3-2035" aria-hidden="true" tabindex="-1"></a>    Chi2 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2036"><a href="#cb3-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2037"><a href="#cb3-2037" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb3-2038"><a href="#cb3-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2039"><a href="#cb3-2039" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> point <span class="kw">in</span> coordinates_with_error:</span>
<span id="cb3-2040"><a href="#cb3-2040" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2041"><a href="#cb3-2041" aria-hidden="true" tabindex="-1"></a>        i<span class="op">+=</span><span class="dv">2</span></span>
<span id="cb3-2042"><a href="#cb3-2042" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2043"><a href="#cb3-2043" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> point[<span class="dv">2</span>]</span>
<span id="cb3-2044"><a href="#cb3-2044" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> point[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb3-2045"><a href="#cb3-2045" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> point[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb3-2046"><a href="#cb3-2046" aria-hidden="true" tabindex="-1"></a>        x_var <span class="op">=</span> point[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb3-2047"><a href="#cb3-2047" aria-hidden="true" tabindex="-1"></a>        y_var <span class="op">=</span> point[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb3-2048"><a href="#cb3-2048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2049"><a href="#cb3-2049" aria-hidden="true" tabindex="-1"></a>        z_0 <span class="op">=</span> centroid[<span class="dv">2</span>]</span>
<span id="cb3-2050"><a href="#cb3-2050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2051"><a href="#cb3-2051" aria-hidden="true" tabindex="-1"></a>        <span class="co"># t = (z-z_0)/d_z</span></span>
<span id="cb3-2052"><a href="#cb3-2052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2053"><a href="#cb3-2053" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> (z<span class="op">-</span>z_0)<span class="op">/</span>d[<span class="dv">2</span>]</span>
<span id="cb3-2054"><a href="#cb3-2054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2055"><a href="#cb3-2055" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find expected (x,y) coordinates at that height.</span></span>
<span id="cb3-2056"><a href="#cb3-2056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2057"><a href="#cb3-2057" aria-hidden="true" tabindex="-1"></a>        x_traj <span class="op">=</span> centroid[<span class="dv">0</span>] <span class="op">+</span> t<span class="op">*</span>d[<span class="dv">0</span>]</span>
<span id="cb3-2058"><a href="#cb3-2058" aria-hidden="true" tabindex="-1"></a>        y_traj <span class="op">=</span> centroid[<span class="dv">1</span>] <span class="op">+</span> t<span class="op">*</span>d[<span class="dv">1</span>]</span>
<span id="cb3-2059"><a href="#cb3-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2060"><a href="#cb3-2060" aria-hidden="true" tabindex="-1"></a>        Chi2_x <span class="op">=</span> (x<span class="op">-</span>x_traj)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> x_var</span>
<span id="cb3-2061"><a href="#cb3-2061" aria-hidden="true" tabindex="-1"></a>        Chi2_y <span class="op">=</span> (y<span class="op">-</span>y_traj)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> y_var</span>
<span id="cb3-2062"><a href="#cb3-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2063"><a href="#cb3-2063" aria-hidden="true" tabindex="-1"></a>        Chi2<span class="op">+=</span> Chi2_x</span>
<span id="cb3-2064"><a href="#cb3-2064" aria-hidden="true" tabindex="-1"></a>        Chi2<span class="op">+=</span> Chi2_y</span>
<span id="cb3-2065"><a href="#cb3-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2066"><a href="#cb3-2066" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i is number of fitted points. There are 4 fitted paramters, 2 for each x and y. </span></span>
<span id="cb3-2067"><a href="#cb3-2067" aria-hidden="true" tabindex="-1"></a>    doF <span class="op">=</span> i <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb3-2068"><a href="#cb3-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2069"><a href="#cb3-2069" aria-hidden="true" tabindex="-1"></a>    Chi2 <span class="op">=</span> Chi2<span class="op">/</span> doF</span>
<span id="cb3-2070"><a href="#cb3-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2071"><a href="#cb3-2071" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p0, d, Chi2, coordinates, dT, dZ</span>
<span id="cb3-2072"><a href="#cb3-2072" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_coords_timed_Chi2(event,max_cluster_size):</span>
<span id="cb3-2073"><a href="#cb3-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2074"><a href="#cb3-2074" aria-hidden="true" tabindex="-1"></a>    <span class="co">#This function converts spatially clusters in RPCs into x and y coordinates (z given by RPC number)</span></span>
<span id="cb3-2075"><a href="#cb3-2075" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x',TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-2076"><a href="#cb3-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2077"><a href="#cb3-2077" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Extract x and y coords of cluster in event</span></span>
<span id="cb3-2078"><a href="#cb3-2078" aria-hidden="true" tabindex="-1"></a>    distance_per_phi_channel <span class="op">=</span> <span class="fl">2.7625</span> <span class="co">#cm</span></span>
<span id="cb3-2079"><a href="#cb3-2079" aria-hidden="true" tabindex="-1"></a>    distance_per_eta_channel <span class="op">=</span> <span class="fl">2.9844</span> <span class="co">#cm</span></span>
<span id="cb3-2080"><a href="#cb3-2080" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2081"><a href="#cb3-2081" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> []</span>
<span id="cb3-2082"><a href="#cb3-2082" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-2083"><a href="#cb3-2083" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2084"><a href="#cb3-2084" aria-hidden="true" tabindex="-1"></a>        x_clusters <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> event[<span class="dv">2</span>][RPC][<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(x)<span class="op">&lt;=</span>max_cluster_size] <span class="co">#phi direction</span></span>
<span id="cb3-2085"><a href="#cb3-2085" aria-hidden="true" tabindex="-1"></a>        y_clusters <span class="op">=</span> [y <span class="cf">for</span> y <span class="kw">in</span> event[<span class="dv">2</span>][RPC][<span class="dv">1</span>] <span class="cf">if</span> <span class="bu">len</span>(y)<span class="op">&lt;=</span>max_cluster_size] <span class="co">#eta direction</span></span>
<span id="cb3-2086"><a href="#cb3-2086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2087"><a href="#cb3-2087" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Finding size of largest cluster, consider coordinates bad if largest cluster is larger than 6.</span></span>
<span id="cb3-2088"><a href="#cb3-2088" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x_clusters_lengths = [len(x) for x in event[2][RPC][0]]</span></span>
<span id="cb3-2089"><a href="#cb3-2089" aria-hidden="true" tabindex="-1"></a>        <span class="co"># y_clusters_lengths = [len(y) for y in event[2][RPC][1]]</span></span>
<span id="cb3-2090"><a href="#cb3-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2091"><a href="#cb3-2091" aria-hidden="true" tabindex="-1"></a>        <span class="co"># max_length = max(max(x_clusters_lengths, default=0), max(y_clusters_lengths, default=0))</span></span>
<span id="cb3-2092"><a href="#cb3-2092" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2093"><a href="#cb3-2093" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if max_length &gt; 3:</span></span>
<span id="cb3-2094"><a href="#cb3-2094" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     return None</span></span>
<span id="cb3-2095"><a href="#cb3-2095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2096"><a href="#cb3-2096" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> []</span>
<span id="cb3-2097"><a href="#cb3-2097" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> []</span>
<span id="cb3-2098"><a href="#cb3-2098" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2099"><a href="#cb3-2099" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x_cluster <span class="kw">in</span> x_clusters:</span>
<span id="cb3-2100"><a href="#cb3-2100" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract phi channels and times from the cluster</span></span>
<span id="cb3-2101"><a href="#cb3-2101" aria-hidden="true" tabindex="-1"></a>            phi_channels <span class="op">=</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> x_cluster]</span>
<span id="cb3-2102"><a href="#cb3-2102" aria-hidden="true" tabindex="-1"></a>            phi_times <span class="op">=</span> [t[<span class="dv">2</span>] <span class="cf">for</span> t <span class="kw">in</span> x_cluster]</span>
<span id="cb3-2103"><a href="#cb3-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2104"><a href="#cb3-2104" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert the channel number into a measurement along the RPC</span></span>
<span id="cb3-2105"><a href="#cb3-2105" aria-hidden="true" tabindex="-1"></a>            x_values <span class="op">=</span> [(phi_channel <span class="op">+</span> <span class="fl">0.5</span>) <span class="op">*</span> distance_per_phi_channel <span class="cf">for</span> phi_channel <span class="kw">in</span> phi_channels]</span>
<span id="cb3-2106"><a href="#cb3-2106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2107"><a href="#cb3-2107" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Variance in x coord</span></span>
<span id="cb3-2108"><a href="#cb3-2108" aria-hidden="true" tabindex="-1"></a>            x_var <span class="op">=</span> (<span class="dv">1</span> <span class="op">*</span> distance_per_phi_channel) <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">12</span></span>
<span id="cb3-2109"><a href="#cb3-2109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2110"><a href="#cb3-2110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find the index of the minimum time</span></span>
<span id="cb3-2111"><a href="#cb3-2111" aria-hidden="true" tabindex="-1"></a>            min_time_index <span class="op">=</span> phi_times.index(<span class="bu">min</span>(phi_times))</span>
<span id="cb3-2112"><a href="#cb3-2112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2113"><a href="#cb3-2113" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Append the x value corresponding to the minimum time</span></span>
<span id="cb3-2114"><a href="#cb3-2114" aria-hidden="true" tabindex="-1"></a>            x_coords.append([x_values[min_time_index], x_var, <span class="bu">min</span>(phi_times)])</span>
<span id="cb3-2115"><a href="#cb3-2115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2116"><a href="#cb3-2116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y_cluster <span class="kw">in</span> y_clusters:</span>
<span id="cb3-2117"><a href="#cb3-2117" aria-hidden="true" tabindex="-1"></a>            <span class="co">#y_cluster = [[RPC,CHANNEL,TIME,'eta'],...]</span></span>
<span id="cb3-2118"><a href="#cb3-2118" aria-hidden="true" tabindex="-1"></a>            eta_channels_corrected <span class="op">=</span> [<span class="dv">31</span><span class="op">-</span>y[<span class="dv">1</span>] <span class="cf">for</span> y <span class="kw">in</span> y_cluster] <span class="co">#corrected for labelling from 0 to 31.</span></span>
<span id="cb3-2119"><a href="#cb3-2119" aria-hidden="true" tabindex="-1"></a>            eta_times <span class="op">=</span> [t[<span class="dv">2</span>] <span class="cf">for</span> t <span class="kw">in</span> y_cluster]</span>
<span id="cb3-2120"><a href="#cb3-2120" aria-hidden="true" tabindex="-1"></a>            y_values <span class="op">=</span> [(channel_num<span class="op">+</span><span class="fl">0.5</span>)<span class="op">*</span>distance_per_eta_channel <span class="cf">for</span> channel_num <span class="kw">in</span> eta_channels_corrected]</span>
<span id="cb3-2121"><a href="#cb3-2121" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2122"><a href="#cb3-2122" aria-hidden="true" tabindex="-1"></a>            y_var <span class="op">=</span> (<span class="dv">1</span><span class="op">*</span>distance_per_eta_channel)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span><span class="dv">12</span></span>
<span id="cb3-2123"><a href="#cb3-2123" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2124"><a href="#cb3-2124" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find the index of the minimum time</span></span>
<span id="cb3-2125"><a href="#cb3-2125" aria-hidden="true" tabindex="-1"></a>            min_time_index <span class="op">=</span> eta_times.index(<span class="bu">min</span>(eta_times))</span>
<span id="cb3-2126"><a href="#cb3-2126" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2127"><a href="#cb3-2127" aria-hidden="true" tabindex="-1"></a>            y_coords.append([y_values[min_time_index],y_var,<span class="bu">min</span>(eta_times)])</span>
<span id="cb3-2128"><a href="#cb3-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2129"><a href="#cb3-2129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x_coords <span class="kw">and</span> y_coords:</span>
<span id="cb3-2130"><a href="#cb3-2130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2131"><a href="#cb3-2131" aria-hidden="true" tabindex="-1"></a>            coords.append([x_coords, y_coords])</span>
<span id="cb3-2132"><a href="#cb3-2132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2133"><a href="#cb3-2133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2134"><a href="#cb3-2134" aria-hidden="true" tabindex="-1"></a>            coords.append([[],[],<span class="st">"N"</span>])</span>
<span id="cb3-2135"><a href="#cb3-2135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2136"><a href="#cb3-2136" aria-hidden="true" tabindex="-1"></a>    <span class="co">#[x_coords] = [[x,err_x,x_time],...]</span></span>
<span id="cb3-2137"><a href="#cb3-2137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2138"><a href="#cb3-2138" aria-hidden="true" tabindex="-1"></a>    <span class="co">#RPC_coords = [x_coords,y_coords]</span></span>
<span id="cb3-2139"><a href="#cb3-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2140"><a href="#cb3-2140" aria-hidden="true" tabindex="-1"></a>    <span class="co">#coords = [[RPC1_coords],[RPC2_coords],[RPC3_coords],...]</span></span>
<span id="cb3-2141"><a href="#cb3-2141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coords</span>
<span id="cb3-2142"><a href="#cb3-2142" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reconstruct_timed_Chi2_ByRPC(event,max_cluster_size, RPC_excluded, rpc_indicies <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>], [<span class="dv">4</span>,<span class="dv">5</span>]]):</span>
<span id="cb3-2143"><a href="#cb3-2143" aria-hidden="true" tabindex="-1"></a>    <span class="co">#timed tag indicates that timing information from RPC is used to determine direction of vertical transversal of "particle" in the event.</span></span>
<span id="cb3-2144"><a href="#cb3-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2145"><a href="#cb3-2145" aria-hidden="true" tabindex="-1"></a>    max_Chi2 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-2146"><a href="#cb3-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2147"><a href="#cb3-2147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x',TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-2148"><a href="#cb3-2148" aria-hidden="true" tabindex="-1"></a>    RPC_heights <span class="op">=</span> [<span class="fl">0.6</span>,<span class="fl">1.8</span>,<span class="fl">3.0</span>,<span class="fl">61.8</span>,<span class="fl">121.8</span>,<span class="dv">123</span>] <span class="co">#Heights of middle point of each RPC, measured from the bottom of the Triplet Low RPC. Units are cm.</span></span>
<span id="cb3-2149"><a href="#cb3-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2150"><a href="#cb3-2150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2151"><a href="#cb3-2151" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Extract x and y coords of cluster in event</span></span>
<span id="cb3-2152"><a href="#cb3-2152" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> extract_coords_timed_Chi2(event,max_cluster_size)</span>
<span id="cb3-2153"><a href="#cb3-2153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2154"><a href="#cb3-2154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for i in range(6):</span></span>
<span id="cb3-2155"><a href="#cb3-2155" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     if len(coords[i]) &gt; 10:</span></span>
<span id="cb3-2156"><a href="#cb3-2156" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         print(coords[i])</span></span>
<span id="cb3-2157"><a href="#cb3-2157" aria-hidden="true" tabindex="-1"></a>    test_coords <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-2158"><a href="#cb3-2158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2159"><a href="#cb3-2159" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out coords of RPC under test </span></span>
<span id="cb3-2160"><a href="#cb3-2160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> RPC_excluded <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb3-2161"><a href="#cb3-2161" aria-hidden="true" tabindex="-1"></a>        test_coords <span class="op">=</span> coords[RPC_excluded]</span>
<span id="cb3-2162"><a href="#cb3-2162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2163"><a href="#cb3-2163" aria-hidden="true" tabindex="-1"></a>        coords[RPC_excluded] <span class="op">=</span> [[],[],<span class="st">"N"</span>] </span>
<span id="cb3-2164"><a href="#cb3-2164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2165"><a href="#cb3-2165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if RPC_excluded[1] &lt; 6:</span></span>
<span id="cb3-2166"><a href="#cb3-2166" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     coords[RPC_excluded[1]] = [[],[],"N"] </span></span>
<span id="cb3-2167"><a href="#cb3-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2168"><a href="#cb3-2168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the number of empty RPCs</span></span>
<span id="cb3-2169"><a href="#cb3-2169" aria-hidden="true" tabindex="-1"></a>    empty_RPC_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> item <span class="kw">in</span> coords <span class="cf">if</span> item <span class="op">==</span> [[], [],<span class="st">'N'</span>])</span>
<span id="cb3-2170"><a href="#cb3-2170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2171"><a href="#cb3-2171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If less than 3 elements of coords are occupied, exit the function</span></span>
<span id="cb3-2172"><a href="#cb3-2172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> empty_RPC_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2173"><a href="#cb3-2173" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Failed to reconstruct, not enough coords")</span></span>
<span id="cb3-2174"><a href="#cb3-2174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Exit the function</span></span>
<span id="cb3-2175"><a href="#cb3-2175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2176"><a href="#cb3-2176" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cross_chamberness = 0</span></span>
<span id="cb3-2177"><a href="#cb3-2177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2178"><a href="#cb3-2178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if coords[0] != [[], [], 'N'] or coords[1] != [[], [], 'N'] or coords[2] != [[], [], 'N']:</span></span>
<span id="cb3-2179"><a href="#cb3-2179" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     cross_chamberness += 1</span></span>
<span id="cb3-2180"><a href="#cb3-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2181"><a href="#cb3-2181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if coords[3] != [[], [], 'N']:</span></span>
<span id="cb3-2182"><a href="#cb3-2182" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     cross_chamberness += 1</span></span>
<span id="cb3-2183"><a href="#cb3-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2184"><a href="#cb3-2184" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if coords[4] != [[], [], 'N'] or coords[5] != [[], [], 'N']:</span></span>
<span id="cb3-2185"><a href="#cb3-2185" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     cross_chamberness += 1</span></span>
<span id="cb3-2186"><a href="#cb3-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2187"><a href="#cb3-2187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if cross_chamberness &lt; 2:</span></span>
<span id="cb3-2188"><a href="#cb3-2188" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     #print("Failed to reconstruct, too few chambers")</span></span>
<span id="cb3-2189"><a href="#cb3-2189" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return None</span></span>
<span id="cb3-2190"><a href="#cb3-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2191"><a href="#cb3-2191" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ITERATING OVER EVERY POSSIBLE COMBINATION OF x,y,z over all 3 RPCs (limited to one x,y per RPC).</span></span>
<span id="cb3-2192"><a href="#cb3-2192" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Doesn't look particularly nice, but there are not many coordinates to loop over usually....</span></span>
<span id="cb3-2193"><a href="#cb3-2193" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(np.sum(len(coords[i]) for i in range(6)))</span></span>
<span id="cb3-2194"><a href="#cb3-2194" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if np.sum(len(coords[i]) for i in range(6)) &gt; 20:</span></span>
<span id="cb3-2195"><a href="#cb3-2195" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return None</span></span>
<span id="cb3-2196"><a href="#cb3-2196" aria-hidden="true" tabindex="-1"></a>    combinations <span class="op">=</span> generate_hit_coords_combo_Chi2(coords,RPC_heights)</span>
<span id="cb3-2197"><a href="#cb3-2197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2198"><a href="#cb3-2198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(combinations) <span class="op">&gt;</span> <span class="dv">30</span>:</span>
<span id="cb3-2199"><a href="#cb3-2199" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f'event_num = {event[0]}')</span></span>
<span id="cb3-2200"><a href="#cb3-2200" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2201"><a href="#cb3-2201" aria-hidden="true" tabindex="-1"></a>        <span class="co"># result = [np.sum([len(coords[i][j]) for i in range(6) for j in range(2)])]</span></span>
<span id="cb3-2202"><a href="#cb3-2202" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f'number of clusters : {result}')</span></span>
<span id="cb3-2203"><a href="#cb3-2203" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f'number of combinations {len(combinations)}')</span></span>
<span id="cb3-2204"><a href="#cb3-2204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2205"><a href="#cb3-2205" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f'Lenth of combo {len(combinations)}')</span></span>
<span id="cb3-2206"><a href="#cb3-2206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2207"><a href="#cb3-2207" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Now for each combo in combinations, attempt to reconstruct a path. See which one gives the best trajectory.</span></span>
<span id="cb3-2208"><a href="#cb3-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2209"><a href="#cb3-2209" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If success, print parameters of fitting function.</span></span>
<span id="cb3-2210"><a href="#cb3-2210" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If fail, print reconstruction failed.</span></span>
<span id="cb3-2211"><a href="#cb3-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2212"><a href="#cb3-2212" aria-hidden="true" tabindex="-1"></a>    Chi2_current <span class="op">=</span> np.inf</span>
<span id="cb3-2213"><a href="#cb3-2213" aria-hidden="true" tabindex="-1"></a>    optimised_coords <span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2214"><a href="#cb3-2214" aria-hidden="true" tabindex="-1"></a>    optimised_d<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2215"><a href="#cb3-2215" aria-hidden="true" tabindex="-1"></a>    optimised_centroid<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2216"><a href="#cb3-2216" aria-hidden="true" tabindex="-1"></a>    dT <span class="op">=</span> [np.inf]</span>
<span id="cb3-2217"><a href="#cb3-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2218"><a href="#cb3-2218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ind,combo <span class="kw">in</span> <span class="bu">enumerate</span>(combinations):</span>
<span id="cb3-2219"><a href="#cb3-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2220"><a href="#cb3-2220" aria-hidden="true" tabindex="-1"></a>        centroid, d, Chi2, coordinates, delta_T, delta_Z<span class="op">=</span> fit_event_chi2(combo, rpc_indicies <span class="op">=</span> rpc_indicies)</span>
<span id="cb3-2221"><a href="#cb3-2221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2 <span class="op">&lt;</span> Chi2_current:</span>
<span id="cb3-2222"><a href="#cb3-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2223"><a href="#cb3-2223" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If new fit is better than old then replace old fit properties.</span></span>
<span id="cb3-2224"><a href="#cb3-2224" aria-hidden="true" tabindex="-1"></a>            dZ <span class="op">=</span> delta_Z </span>
<span id="cb3-2225"><a href="#cb3-2225" aria-hidden="true" tabindex="-1"></a>            dT <span class="op">=</span> delta_T</span>
<span id="cb3-2226"><a href="#cb3-2226" aria-hidden="true" tabindex="-1"></a>            Chi2_current <span class="op">=</span> Chi2</span>
<span id="cb3-2227"><a href="#cb3-2227" aria-hidden="true" tabindex="-1"></a>            optimised_centroid <span class="op">=</span> centroid</span>
<span id="cb3-2228"><a href="#cb3-2228" aria-hidden="true" tabindex="-1"></a>            optimised_d <span class="op">=</span> d</span>
<span id="cb3-2229"><a href="#cb3-2229" aria-hidden="true" tabindex="-1"></a>            optimised_coords <span class="op">=</span> coordinates</span>
<span id="cb3-2230"><a href="#cb3-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2231"><a href="#cb3-2231" aria-hidden="true" tabindex="-1"></a>    <span class="co">#if dT&gt;0 this implies the particles hit the higher RPC after the lower one, so the particle is travelling upwards here.</span></span>
<span id="cb3-2232"><a href="#cb3-2232" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Vice-versa for dT &lt; 0.</span></span>
<span id="cb3-2233"><a href="#cb3-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2234"><a href="#cb3-2234" aria-hidden="true" tabindex="-1"></a>    <span class="co">#dT = 0 case?</span></span>
<span id="cb3-2235"><a href="#cb3-2235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2236"><a href="#cb3-2236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dT[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> np.inf:</span>
<span id="cb3-2237"><a href="#cb3-2237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2238"><a href="#cb3-2238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dT[<span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2239"><a href="#cb3-2239" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> optimised_d[<span class="dv">2</span>] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2240"><a href="#cb3-2240" aria-hidden="true" tabindex="-1"></a>                optimised_d <span class="op">=</span> np.multiply(optimised_d,<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2241"><a href="#cb3-2241" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2242"><a href="#cb3-2242" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> optimised_d[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2243"><a href="#cb3-2243" aria-hidden="true" tabindex="-1"></a>                optimised_d <span class="op">=</span> np.multiply(optimised_d,<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2244"><a href="#cb3-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2245"><a href="#cb3-2245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2_current<span class="op">&lt;</span>max_Chi2:</span>
<span id="cb3-2246"><a href="#cb3-2246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> optimised_centroid, optimised_d, optimised_coords, combinations, Chi2_current, dT, dZ, test_coords</span>
<span id="cb3-2247"><a href="#cb3-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2248"><a href="#cb3-2248" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-2249"><a href="#cb3-2249" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Failed to reconstruct, Chi2 too large")</span></span>
<span id="cb3-2250"><a href="#cb3-2250" aria-hidden="true" tabindex="-1"></a>        <span class="co">#return optimised_centroid, optimised_d, optimised_coords, combinations, residuals_current</span></span>
<span id="cb3-2251"><a href="#cb3-2251" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2252"><a href="#cb3-2252" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_event_attributes_by_RPC(event, min_chamber_number, min_RPC_number, RPC_excluded):</span>
<span id="cb3-2253"><a href="#cb3-2253" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Used in filter_events() function to decide whether or not to save an event as described by the user's inputs.</span></span>
<span id="cb3-2254"><a href="#cb3-2254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The user selects an RPC to exclude from the filter.</span></span>
<span id="cb3-2255"><a href="#cb3-2255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># e.g. say we want to exclude RPC 4 and the user selects a min_RPC_number of 4.</span></span>
<span id="cb3-2256"><a href="#cb3-2256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The function will check if the event has at least 4 RPCs hit.</span></span>
<span id="cb3-2257"><a href="#cb3-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2258"><a href="#cb3-2258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># USING ONLY ETA FILTER HERE SINCE THIS IS WHAT TRIGGERS THE CHANNEL!</span></span>
<span id="cb3-2259"><a href="#cb3-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2260"><a href="#cb3-2260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x', TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-2261"><a href="#cb3-2261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2262"><a href="#cb3-2262" aria-hidden="true" tabindex="-1"></a>    RPC_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2263"><a href="#cb3-2263" aria-hidden="true" tabindex="-1"></a>    chamber_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2264"><a href="#cb3-2264" aria-hidden="true" tabindex="-1"></a>    condition_1 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-2265"><a href="#cb3-2265" aria-hidden="true" tabindex="-1"></a>    condition_2 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-2266"><a href="#cb3-2266" aria-hidden="true" tabindex="-1"></a>    condition_3 <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-2267"><a href="#cb3-2267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2268"><a href="#cb3-2268" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if any of the excluded RPCs have ETA clusters</span></span>
<span id="cb3-2269"><a href="#cb3-2269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for excluded_RPC in RPC_excluded:</span></span>
<span id="cb3-2270"><a href="#cb3-2270" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> event[<span class="dv">2</span>][RPC_excluded][<span class="dv">1</span>] <span class="op">!=</span> []:</span>
<span id="cb3-2271"><a href="#cb3-2271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb3-2272"><a href="#cb3-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2273"><a href="#cb3-2273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> RPC <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-2274"><a href="#cb3-2274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> RPC <span class="op">!=</span> RPC_excluded:</span>
<span id="cb3-2275"><a href="#cb3-2275" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the RPC is not excluded, we check for ETA clusters.</span></span>
<span id="cb3-2276"><a href="#cb3-2276" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> event[<span class="dv">2</span>][RPC][<span class="dv">1</span>]:</span>
<span id="cb3-2277"><a href="#cb3-2277" aria-hidden="true" tabindex="-1"></a>                RPC_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2278"><a href="#cb3-2278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2279"><a href="#cb3-2279" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> RPC <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb3-2280"><a href="#cb3-2280" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Checking triplet layer.</span></span>
<span id="cb3-2281"><a href="#cb3-2281" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> condition_1:</span>
<span id="cb3-2282"><a href="#cb3-2282" aria-hidden="true" tabindex="-1"></a>                        chamber_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2283"><a href="#cb3-2283" aria-hidden="true" tabindex="-1"></a>                        condition_1 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-2284"><a href="#cb3-2284" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> RPC <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-2285"><a href="#cb3-2285" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Checking singlet layer.</span></span>
<span id="cb3-2286"><a href="#cb3-2286" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> condition_2:</span>
<span id="cb3-2287"><a href="#cb3-2287" aria-hidden="true" tabindex="-1"></a>                        chamber_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2288"><a href="#cb3-2288" aria-hidden="true" tabindex="-1"></a>                        condition_2 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-2289"><a href="#cb3-2289" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb3-2290"><a href="#cb3-2290" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Checking doublet layer.</span></span>
<span id="cb3-2291"><a href="#cb3-2291" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> condition_3:</span>
<span id="cb3-2292"><a href="#cb3-2292" aria-hidden="true" tabindex="-1"></a>                        chamber_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2293"><a href="#cb3-2293" aria-hidden="true" tabindex="-1"></a>                        condition_3 <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-2294"><a href="#cb3-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2295"><a href="#cb3-2295" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RPC_counter <span class="op">&gt;=</span> min_RPC_number <span class="kw">and</span> chamber_counter <span class="op">&gt;=</span> min_chamber_number</span>
<span id="cb3-2296"><a href="#cb3-2296" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_events_by_RPC(events,min_chamber_number,min_RPC_number,RPC_excluded):</span>
<span id="cb3-2297"><a href="#cb3-2297" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Initiliase array of filtered events</span></span>
<span id="cb3-2298"><a href="#cb3-2298" aria-hidden="true" tabindex="-1"></a>    filtered_events <span class="op">=</span> []</span>
<span id="cb3-2299"><a href="#cb3-2299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2300"><a href="#cb3-2300" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event <span class="kw">in</span> events:</span>
<span id="cb3-2301"><a href="#cb3-2301" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> check_event_attributes_by_RPC(event,min_chamber_number,min_RPC_number,RPC_excluded):</span>
<span id="cb3-2302"><a href="#cb3-2302" aria-hidden="true" tabindex="-1"></a>            filtered_events.append(event)</span>
<span id="cb3-2303"><a href="#cb3-2303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> :</span>
<span id="cb3-2304"><a href="#cb3-2304" aria-hidden="true" tabindex="-1"></a>            event[<span class="dv">2</span>][RPC_excluded][<span class="dv">1</span>] <span class="op">=</span> []</span>
<span id="cb3-2305"><a href="#cb3-2305" aria-hidden="true" tabindex="-1"></a>            event[<span class="dv">2</span>][RPC_excluded][<span class="dv">0</span>] <span class="op">=</span> []</span>
<span id="cb3-2306"><a href="#cb3-2306" aria-hidden="true" tabindex="-1"></a>            filtered_events.append(event)</span>
<span id="cb3-2307"><a href="#cb3-2307" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-2308"><a href="#cb3-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2309"><a href="#cb3-2309" aria-hidden="true" tabindex="-1"></a>   <span class="co"># print(f"Number of events in filter = {len(filtered_events)}")</span></span>
<span id="cb3-2310"><a href="#cb3-2310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2311"><a href="#cb3-2311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filtered_events</span>
<span id="cb3-2312"><a href="#cb3-2312" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reconstruct_timed_Chi2(event,max_cluster_size, max_length<span class="op">=</span><span class="va">None</span>, exact_length<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-2313"><a href="#cb3-2313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2314"><a href="#cb3-2314" aria-hidden="true" tabindex="-1"></a>    <span class="co">#timed tag indicates that timing information from RPC is used to determine direction of vertical transversal of "particle" in the event.</span></span>
<span id="cb3-2315"><a href="#cb3-2315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2316"><a href="#cb3-2316" aria-hidden="true" tabindex="-1"></a>    max_Chi2 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-2317"><a href="#cb3-2317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2318"><a href="#cb3-2318" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x',TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-2319"><a href="#cb3-2319" aria-hidden="true" tabindex="-1"></a>    RPC_heights <span class="op">=</span> [<span class="fl">0.6</span>,<span class="fl">1.8</span>,<span class="fl">3.0</span>,<span class="fl">61.8</span>,<span class="fl">121.8</span>,<span class="dv">123</span>] <span class="co">#Heights of middle point of each RPC, measured from the bottom of the Triplet Low RPC. Units are cm.</span></span>
<span id="cb3-2320"><a href="#cb3-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2321"><a href="#cb3-2321" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Extract x and y coords of cluster in event</span></span>
<span id="cb3-2322"><a href="#cb3-2322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2323"><a href="#cb3-2323" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> extract_coords_timed_Chi2(event,max_cluster_size)</span>
<span id="cb3-2324"><a href="#cb3-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2325"><a href="#cb3-2325" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the number of empty RPCs</span></span>
<span id="cb3-2326"><a href="#cb3-2326" aria-hidden="true" tabindex="-1"></a>    empty_RPC_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> item <span class="kw">in</span> coords <span class="cf">if</span> item <span class="op">==</span> [[], [],<span class="st">'N'</span>])</span>
<span id="cb3-2327"><a href="#cb3-2327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2328"><a href="#cb3-2328" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If less than 3 elements of coords are occupied, exit the function</span></span>
<span id="cb3-2329"><a href="#cb3-2329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> empty_RPC_count <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb3-2330"><a href="#cb3-2330" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Failed to reconstruct, not enough coords")</span></span>
<span id="cb3-2331"><a href="#cb3-2331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Exit the function</span></span>
<span id="cb3-2332"><a href="#cb3-2332" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2333"><a href="#cb3-2333" aria-hidden="true" tabindex="-1"></a>    <span class="co">#NEED TO CHECK IF STILL CROSS CHAMBER! </span></span>
<span id="cb3-2334"><a href="#cb3-2334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2335"><a href="#cb3-2335" aria-hidden="true" tabindex="-1"></a>    cross_chamberness <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2336"><a href="#cb3-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2337"><a href="#cb3-2337" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">0</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">1</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">2</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2338"><a href="#cb3-2338" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2339"><a href="#cb3-2339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2340"><a href="#cb3-2340" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">3</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2341"><a href="#cb3-2341" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2342"><a href="#cb3-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2343"><a href="#cb3-2343" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">4</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">5</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2344"><a href="#cb3-2344" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2345"><a href="#cb3-2345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2346"><a href="#cb3-2346" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[0])</span></span>
<span id="cb3-2347"><a href="#cb3-2347" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[1])</span></span>
<span id="cb3-2348"><a href="#cb3-2348" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[2])</span></span>
<span id="cb3-2349"><a href="#cb3-2349" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[3])</span></span>
<span id="cb3-2350"><a href="#cb3-2350" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[4])</span></span>
<span id="cb3-2351"><a href="#cb3-2351" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[5])</span></span>
<span id="cb3-2352"><a href="#cb3-2352" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(cross_chamberness)</span></span>
<span id="cb3-2353"><a href="#cb3-2353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2354"><a href="#cb3-2354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cross_chamberness <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb3-2355"><a href="#cb3-2355" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Failed to reconstruct, too few chambers")</span></span>
<span id="cb3-2356"><a href="#cb3-2356" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2357"><a href="#cb3-2357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2358"><a href="#cb3-2358" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ITERATING OVER EVERY POSSIBLE COMBINATION OF x,y,z over all 3 RPCs (limited to one x,y per RPC).</span></span>
<span id="cb3-2359"><a href="#cb3-2359" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Doesn't look particularly nice, but there are not many coordinates to loop over usually....</span></span>
<span id="cb3-2360"><a href="#cb3-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2361"><a href="#cb3-2361" aria-hidden="true" tabindex="-1"></a>    combinations <span class="op">=</span> generate_hit_coords_combo_Chi2(coords,RPC_heights, max_length<span class="op">=</span>max_length, exact_length<span class="op">=</span>exact_length)</span>
<span id="cb3-2362"><a href="#cb3-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2363"><a href="#cb3-2363" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Now for each combo in combinations, attempt to reconstruct a path. See which one gives the best trajectory.</span></span>
<span id="cb3-2364"><a href="#cb3-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2365"><a href="#cb3-2365" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If success, print parameters of fitting function.</span></span>
<span id="cb3-2366"><a href="#cb3-2366" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If fail, print reconstruction failed.</span></span>
<span id="cb3-2367"><a href="#cb3-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2368"><a href="#cb3-2368" aria-hidden="true" tabindex="-1"></a>    Chi2_current <span class="op">=</span> np.inf</span>
<span id="cb3-2369"><a href="#cb3-2369" aria-hidden="true" tabindex="-1"></a>    optimised_coords <span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2370"><a href="#cb3-2370" aria-hidden="true" tabindex="-1"></a>    optimised_d<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2371"><a href="#cb3-2371" aria-hidden="true" tabindex="-1"></a>    optimised_centroid<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2372"><a href="#cb3-2372" aria-hidden="true" tabindex="-1"></a>    dT <span class="op">=</span> np.inf</span>
<span id="cb3-2373"><a href="#cb3-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2374"><a href="#cb3-2374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ind,combo <span class="kw">in</span> <span class="bu">enumerate</span>(combinations):</span>
<span id="cb3-2375"><a href="#cb3-2375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2376"><a href="#cb3-2376" aria-hidden="true" tabindex="-1"></a>        centroid, d, Chi2, coordinates, delta_T, delta_Z<span class="op">=</span> fit_event_chi2(combo)</span>
<span id="cb3-2377"><a href="#cb3-2377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2 <span class="op">&lt;</span> Chi2_current:</span>
<span id="cb3-2378"><a href="#cb3-2378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2379"><a href="#cb3-2379" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If new fit is better than old then replace old fit properties.</span></span>
<span id="cb3-2380"><a href="#cb3-2380" aria-hidden="true" tabindex="-1"></a>            dZ <span class="op">=</span> delta_Z </span>
<span id="cb3-2381"><a href="#cb3-2381" aria-hidden="true" tabindex="-1"></a>            dT <span class="op">=</span> delta_T</span>
<span id="cb3-2382"><a href="#cb3-2382" aria-hidden="true" tabindex="-1"></a>            Chi2_current <span class="op">=</span> Chi2</span>
<span id="cb3-2383"><a href="#cb3-2383" aria-hidden="true" tabindex="-1"></a>            optimised_centroid <span class="op">=</span> centroid</span>
<span id="cb3-2384"><a href="#cb3-2384" aria-hidden="true" tabindex="-1"></a>            optimised_d <span class="op">=</span> d</span>
<span id="cb3-2385"><a href="#cb3-2385" aria-hidden="true" tabindex="-1"></a>            optimised_coords <span class="op">=</span> coordinates</span>
<span id="cb3-2386"><a href="#cb3-2386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2387"><a href="#cb3-2387" aria-hidden="true" tabindex="-1"></a>    <span class="co">#if dT&gt;0 this implies the particles hit the higher RPC after the lower one, so the particle is travelling upwards here.</span></span>
<span id="cb3-2388"><a href="#cb3-2388" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Vice-versa for dT &lt; 0.</span></span>
<span id="cb3-2389"><a href="#cb3-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2390"><a href="#cb3-2390" aria-hidden="true" tabindex="-1"></a>    <span class="co">#dT = 0 case?</span></span>
<span id="cb3-2391"><a href="#cb3-2391" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2392"><a href="#cb3-2392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dT <span class="op">!=</span> np.inf:</span>
<span id="cb3-2393"><a href="#cb3-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2394"><a href="#cb3-2394" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dT <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2395"><a href="#cb3-2395" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> optimised_d[<span class="dv">2</span>] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2396"><a href="#cb3-2396" aria-hidden="true" tabindex="-1"></a>                optimised_d <span class="op">=</span> np.multiply(optimised_d,<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2397"><a href="#cb3-2397" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2398"><a href="#cb3-2398" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> optimised_d[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2399"><a href="#cb3-2399" aria-hidden="true" tabindex="-1"></a>                optimised_d <span class="op">=</span> np.multiply(optimised_d,<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2400"><a href="#cb3-2400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2401"><a href="#cb3-2401" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2_current<span class="op">&lt;</span>max_Chi2:</span>
<span id="cb3-2402"><a href="#cb3-2402" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> optimised_centroid, optimised_d, optimised_coords, combinations, Chi2_current, dT, dZ</span>
<span id="cb3-2403"><a href="#cb3-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2404"><a href="#cb3-2404" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2405"><a href="#cb3-2405" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print("Failed to reconstruct, Chi2 too large")</span></span>
<span id="cb3-2406"><a href="#cb3-2406" aria-hidden="true" tabindex="-1"></a>            <span class="co">#return optimised_centroid, optimised_d, optimised_coords, combinations, residuals_current</span></span>
<span id="cb3-2407"><a href="#cb3-2407" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2408"><a href="#cb3-2408" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_angles_phi_eta_timed_DZ(filtered_events, max_length<span class="op">=</span><span class="va">None</span>, exact_length<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-2409"><a href="#cb3-2409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2410"><a href="#cb3-2410" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Input is filtered_events, output of ANT.filter_events() function</span></span>
<span id="cb3-2411"><a href="#cb3-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2412"><a href="#cb3-2412" aria-hidden="true" tabindex="-1"></a>    angles_eta <span class="op">=</span> []</span>
<span id="cb3-2413"><a href="#cb3-2413" aria-hidden="true" tabindex="-1"></a>    angles_phi <span class="op">=</span> []</span>
<span id="cb3-2414"><a href="#cb3-2414" aria-hidden="true" tabindex="-1"></a>    delta_times <span class="op">=</span> []</span>
<span id="cb3-2415"><a href="#cb3-2415" aria-hidden="true" tabindex="-1"></a>    dZ <span class="op">=</span> []</span>
<span id="cb3-2416"><a href="#cb3-2416" aria-hidden="true" tabindex="-1"></a>    chi2_values <span class="op">=</span> []</span>
<span id="cb3-2417"><a href="#cb3-2417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2418"><a href="#cb3-2418" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i,filtered_event <span class="kw">in</span> <span class="bu">enumerate</span>(filtered_events):</span>
<span id="cb3-2419"><a href="#cb3-2419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2420"><a href="#cb3-2420" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f"Index= {i}") </span></span>
<span id="cb3-2421"><a href="#cb3-2421" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2422"><a href="#cb3-2422" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> reconstruct_timed_Chi2(filtered_event,<span class="dv">3</span>, max_length<span class="op">=</span>max_length, exact_length<span class="op">=</span>exact_length)</span>
<span id="cb3-2423"><a href="#cb3-2423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2424"><a href="#cb3-2424" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-2425"><a href="#cb3-2425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2426"><a href="#cb3-2426" aria-hidden="true" tabindex="-1"></a>            delta_times.append(result[<span class="dv">5</span>])</span>
<span id="cb3-2427"><a href="#cb3-2427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2428"><a href="#cb3-2428" aria-hidden="true" tabindex="-1"></a>            chi2_values.append(result[<span class="dv">4</span>])</span>
<span id="cb3-2429"><a href="#cb3-2429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2430"><a href="#cb3-2430" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if abs(result[5])&gt;40:</span></span>
<span id="cb3-2431"><a href="#cb3-2431" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     print(f"Index of abnormal event= {i}")</span></span>
<span id="cb3-2432"><a href="#cb3-2432" aria-hidden="true" tabindex="-1"></a>            <span class="co"># #Only save angles that actually were reconstructed well</span></span>
<span id="cb3-2433"><a href="#cb3-2433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2434"><a href="#cb3-2434" aria-hidden="true" tabindex="-1"></a>            dZ.append(result[<span class="dv">6</span>])</span>
<span id="cb3-2435"><a href="#cb3-2435" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2436"><a href="#cb3-2436" aria-hidden="true" tabindex="-1"></a>            <span class="co"># a.b = |a||b|cos(x)</span></span>
<span id="cb3-2437"><a href="#cb3-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2438"><a href="#cb3-2438" aria-hidden="true" tabindex="-1"></a>            <span class="co">#eta angle. </span></span>
<span id="cb3-2439"><a href="#cb3-2439" aria-hidden="true" tabindex="-1"></a>            <span class="co">#work out the projection of the direction vector in the plane.</span></span>
<span id="cb3-2440"><a href="#cb3-2440" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2441"><a href="#cb3-2441" aria-hidden="true" tabindex="-1"></a>            v_parr_eta <span class="op">=</span> np.array([<span class="dv">0</span>,result[<span class="dv">1</span>][<span class="dv">1</span>],result[<span class="dv">1</span>][<span class="dv">2</span>]])</span>
<span id="cb3-2442"><a href="#cb3-2442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2443"><a href="#cb3-2443" aria-hidden="true" tabindex="-1"></a>            theta_eta <span class="op">=</span> np.arccos(np.dot(v_parr_eta,[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>]) <span class="op">/</span> np.linalg.norm(v_parr_eta))</span>
<span id="cb3-2444"><a href="#cb3-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2445"><a href="#cb3-2445" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theta_eta <span class="op">&gt;</span> np.pi <span class="op">/</span> <span class="dv">2</span>:</span>
<span id="cb3-2446"><a href="#cb3-2446" aria-hidden="true" tabindex="-1"></a>                theta_eta<span class="op">=</span> np.pi <span class="op">-</span> theta_eta</span>
<span id="cb3-2447"><a href="#cb3-2447" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2448"><a href="#cb3-2448" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> v_parr_eta[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2449"><a href="#cb3-2449" aria-hidden="true" tabindex="-1"></a>                theta_eta<span class="op">*=-</span><span class="dv">1</span></span>
<span id="cb3-2450"><a href="#cb3-2450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2451"><a href="#cb3-2451" aria-hidden="true" tabindex="-1"></a>            angles_eta.append(theta_eta)</span>
<span id="cb3-2452"><a href="#cb3-2452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2453"><a href="#cb3-2453" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Phi angles</span></span>
<span id="cb3-2454"><a href="#cb3-2454" aria-hidden="true" tabindex="-1"></a>            <span class="co">#work out the projection of the direction vector in the plane.</span></span>
<span id="cb3-2455"><a href="#cb3-2455" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2456"><a href="#cb3-2456" aria-hidden="true" tabindex="-1"></a>            v_parr_phi <span class="op">=</span> np.array([result[<span class="dv">1</span>][<span class="dv">0</span>],<span class="dv">0</span>,result[<span class="dv">1</span>][<span class="dv">2</span>]])</span>
<span id="cb3-2457"><a href="#cb3-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2458"><a href="#cb3-2458" aria-hidden="true" tabindex="-1"></a>            theta_phi <span class="op">=</span> np.arccos(np.dot(v_parr_phi,[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>]) <span class="op">/</span> np.linalg.norm(v_parr_phi))</span>
<span id="cb3-2459"><a href="#cb3-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2460"><a href="#cb3-2460" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theta_phi <span class="op">&gt;</span> np.pi <span class="op">/</span> <span class="dv">2</span>:</span>
<span id="cb3-2461"><a href="#cb3-2461" aria-hidden="true" tabindex="-1"></a>                theta_phi<span class="op">=</span> np.pi <span class="op">-</span> theta_phi</span>
<span id="cb3-2462"><a href="#cb3-2462" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-2463"><a href="#cb3-2463" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> v_parr_phi[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2464"><a href="#cb3-2464" aria-hidden="true" tabindex="-1"></a>                theta_phi<span class="op">*=-</span><span class="dv">1</span></span>
<span id="cb3-2465"><a href="#cb3-2465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2466"><a href="#cb3-2466" aria-hidden="true" tabindex="-1"></a>            angles_phi.append(theta_phi)</span>
<span id="cb3-2467"><a href="#cb3-2467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2468"><a href="#cb3-2468" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> angles_eta, angles_phi, delta_times, dZ, chi2_values</span>
<span id="cb3-2469"><a href="#cb3-2469" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interactive_muon_plot(centroid,d,event_coords):</span>
<span id="cb3-2470"><a href="#cb3-2470" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Coefficients = [a,b,c]</span></span>
<span id="cb3-2471"><a href="#cb3-2471" aria-hidden="true" tabindex="-1"></a>    <span class="co">#event_coords = [[x0,y0,z0],[x1,y1,z1],...,[x5,y5,z5]]</span></span>
<span id="cb3-2472"><a href="#cb3-2472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2473"><a href="#cb3-2473" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate line coordinates</span></span>
<span id="cb3-2474"><a href="#cb3-2474" aria-hidden="true" tabindex="-1"></a>    t_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">150</span>, <span class="dv">150</span>, <span class="dv">100</span>)</span>
<span id="cb3-2475"><a href="#cb3-2475" aria-hidden="true" tabindex="-1"></a>    line_coordinates <span class="op">=</span> centroid.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">+</span> d.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span> t_values.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2476"><a href="#cb3-2476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2477"><a href="#cb3-2477" aria-hidden="true" tabindex="-1"></a>    x_coords <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> event_coords]</span>
<span id="cb3-2478"><a href="#cb3-2478" aria-hidden="true" tabindex="-1"></a>    y_coords <span class="op">=</span> [y[<span class="dv">1</span>] <span class="cf">for</span> y <span class="kw">in</span> event_coords]</span>
<span id="cb3-2479"><a href="#cb3-2479" aria-hidden="true" tabindex="-1"></a>    z_coords <span class="op">=</span> [z[<span class="dv">2</span>] <span class="cf">for</span> z <span class="kw">in</span> event_coords]</span>
<span id="cb3-2480"><a href="#cb3-2480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2481"><a href="#cb3-2481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2482"><a href="#cb3-2482" aria-hidden="true" tabindex="-1"></a>    RPC_origins <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>],[<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">1.2</span>],[<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">2.4</span>],[<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">61.2</span>],[<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">121.2</span>],[<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">122.4</span>]]</span>
<span id="cb3-2483"><a href="#cb3-2483" aria-hidden="true" tabindex="-1"></a>    RPC_dimensions <span class="op">=</span> [<span class="dv">180</span>,<span class="dv">99</span>,<span class="fl">1.2</span>]</span>
<span id="cb3-2484"><a href="#cb3-2484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2485"><a href="#cb3-2485" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Calculate vertices for RPCs</span></span>
<span id="cb3-2486"><a href="#cb3-2486" aria-hidden="true" tabindex="-1"></a>    rpc_vertices <span class="op">=</span> []</span>
<span id="cb3-2487"><a href="#cb3-2487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb3-2488"><a href="#cb3-2488" aria-hidden="true" tabindex="-1"></a>        rpc_vertices.append(calculate_cuboid_vertices(RPC_origins[i],RPC_dimensions))</span>
<span id="cb3-2489"><a href="#cb3-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2490"><a href="#cb3-2490" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure Plotly to be rendered inline in the notebook.</span></span>
<span id="cb3-2491"><a href="#cb3-2491" aria-hidden="true" tabindex="-1"></a>    plotly.offline.init_notebook_mode()</span>
<span id="cb3-2492"><a href="#cb3-2492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2493"><a href="#cb3-2493" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure the trace for the RPCs</span></span>
<span id="cb3-2494"><a href="#cb3-2494" aria-hidden="true" tabindex="-1"></a>    rpc_0 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2495"><a href="#cb3-2495" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">0</span>]],</span>
<span id="cb3-2496"><a href="#cb3-2496" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">0</span>]],</span>
<span id="cb3-2497"><a href="#cb3-2497" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">0</span>]],</span>
<span id="cb3-2498"><a href="#cb3-2498" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2499"><a href="#cb3-2499" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2500"><a href="#cb3-2500" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2501"><a href="#cb3-2501" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2502"><a href="#cb3-2502" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2503"><a href="#cb3-2503" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2504"><a href="#cb3-2504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2505"><a href="#cb3-2505" aria-hidden="true" tabindex="-1"></a>    rpc_1 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2506"><a href="#cb3-2506" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">1</span>]],</span>
<span id="cb3-2507"><a href="#cb3-2507" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">1</span>]],</span>
<span id="cb3-2508"><a href="#cb3-2508" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">1</span>]],</span>
<span id="cb3-2509"><a href="#cb3-2509" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2510"><a href="#cb3-2510" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2511"><a href="#cb3-2511" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2512"><a href="#cb3-2512" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2513"><a href="#cb3-2513" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2514"><a href="#cb3-2514" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2515"><a href="#cb3-2515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2516"><a href="#cb3-2516" aria-hidden="true" tabindex="-1"></a>    rpc_2 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2517"><a href="#cb3-2517" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">2</span>]],</span>
<span id="cb3-2518"><a href="#cb3-2518" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">2</span>]],</span>
<span id="cb3-2519"><a href="#cb3-2519" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">2</span>]],</span>
<span id="cb3-2520"><a href="#cb3-2520" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2521"><a href="#cb3-2521" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2522"><a href="#cb3-2522" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2523"><a href="#cb3-2523" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2524"><a href="#cb3-2524" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2525"><a href="#cb3-2525" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2526"><a href="#cb3-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2527"><a href="#cb3-2527" aria-hidden="true" tabindex="-1"></a>    rpc_3 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2528"><a href="#cb3-2528" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">3</span>]],</span>
<span id="cb3-2529"><a href="#cb3-2529" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">3</span>]],</span>
<span id="cb3-2530"><a href="#cb3-2530" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">3</span>]],</span>
<span id="cb3-2531"><a href="#cb3-2531" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2532"><a href="#cb3-2532" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2533"><a href="#cb3-2533" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2534"><a href="#cb3-2534" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2535"><a href="#cb3-2535" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2536"><a href="#cb3-2536" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2537"><a href="#cb3-2537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2538"><a href="#cb3-2538" aria-hidden="true" tabindex="-1"></a>    rpc_4 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2539"><a href="#cb3-2539" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">4</span>]],</span>
<span id="cb3-2540"><a href="#cb3-2540" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">4</span>]],</span>
<span id="cb3-2541"><a href="#cb3-2541" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">4</span>]],</span>
<span id="cb3-2542"><a href="#cb3-2542" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2543"><a href="#cb3-2543" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2544"><a href="#cb3-2544" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2545"><a href="#cb3-2545" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2546"><a href="#cb3-2546" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2547"><a href="#cb3-2547" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2548"><a href="#cb3-2548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2549"><a href="#cb3-2549" aria-hidden="true" tabindex="-1"></a>    rpc_5 <span class="op">=</span> go.Mesh3d(</span>
<span id="cb3-2550"><a href="#cb3-2550" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[vertex[<span class="dv">0</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">5</span>]],</span>
<span id="cb3-2551"><a href="#cb3-2551" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[vertex[<span class="dv">1</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">5</span>]],</span>
<span id="cb3-2552"><a href="#cb3-2552" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[vertex[<span class="dv">2</span>] <span class="cf">for</span> vertex <span class="kw">in</span> rpc_vertices[<span class="dv">5</span>]],</span>
<span id="cb3-2553"><a href="#cb3-2553" aria-hidden="true" tabindex="-1"></a>        i<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">3</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2554"><a href="#cb3-2554" aria-hidden="true" tabindex="-1"></a>        j<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2555"><a href="#cb3-2555" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">0</span>],  <span class="co"># Indices for faces</span></span>
<span id="cb3-2556"><a href="#cb3-2556" aria-hidden="true" tabindex="-1"></a>        opacity<span class="op">=</span><span class="fl">0.1</span>,  <span class="co"># Set the opacity as needed</span></span>
<span id="cb3-2557"><a href="#cb3-2557" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'green'</span>  <span class="co"># Set the color of the cuboid</span></span>
<span id="cb3-2558"><a href="#cb3-2558" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2559"><a href="#cb3-2559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2560"><a href="#cb3-2560" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure the trace.</span></span>
<span id="cb3-2561"><a href="#cb3-2561" aria-hidden="true" tabindex="-1"></a>    trace <span class="op">=</span> go.Scatter3d(</span>
<span id="cb3-2562"><a href="#cb3-2562" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>x_coords,  <span class="co"># &lt;-- Put your data instead</span></span>
<span id="cb3-2563"><a href="#cb3-2563" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>y_coords,  <span class="co"># &lt;-- Put your data instead</span></span>
<span id="cb3-2564"><a href="#cb3-2564" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>z_coords, <span class="co"># &lt;-- Put your data instead</span></span>
<span id="cb3-2565"><a href="#cb3-2565" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">'markers'</span>,</span>
<span id="cb3-2566"><a href="#cb3-2566" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span>{</span>
<span id="cb3-2567"><a href="#cb3-2567" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">10</span>,</span>
<span id="cb3-2568"><a href="#cb3-2568" aria-hidden="true" tabindex="-1"></a>            <span class="st">'opacity'</span>: <span class="fl">1.0</span>,</span>
<span id="cb3-2569"><a href="#cb3-2569" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-2570"><a href="#cb3-2570" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2571"><a href="#cb3-2571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2572"><a href="#cb3-2572" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot zenith angle</span></span>
<span id="cb3-2573"><a href="#cb3-2573" aria-hidden="true" tabindex="-1"></a>    <span class="co"># zenith = go.Vector(...)</span></span>
<span id="cb3-2574"><a href="#cb3-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2575"><a href="#cb3-2575" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract x, y, z coordinates from line coordinates</span></span>
<span id="cb3-2576"><a href="#cb3-2576" aria-hidden="true" tabindex="-1"></a>    x_line <span class="op">=</span> line_coordinates[<span class="dv">0</span>]</span>
<span id="cb3-2577"><a href="#cb3-2577" aria-hidden="true" tabindex="-1"></a>    y_line <span class="op">=</span> line_coordinates[<span class="dv">1</span>]</span>
<span id="cb3-2578"><a href="#cb3-2578" aria-hidden="true" tabindex="-1"></a>    z_line <span class="op">=</span> line_coordinates[<span class="dv">2</span>]</span>
<span id="cb3-2579"><a href="#cb3-2579" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2580"><a href="#cb3-2580" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure the trace for the line</span></span>
<span id="cb3-2581"><a href="#cb3-2581" aria-hidden="true" tabindex="-1"></a>    trace_line <span class="op">=</span> go.Scatter3d(</span>
<span id="cb3-2582"><a href="#cb3-2582" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>x_line,</span>
<span id="cb3-2583"><a href="#cb3-2583" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>y_line,</span>
<span id="cb3-2584"><a href="#cb3-2584" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>z_line,</span>
<span id="cb3-2585"><a href="#cb3-2585" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb3-2586"><a href="#cb3-2586" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span>{</span>
<span id="cb3-2587"><a href="#cb3-2587" aria-hidden="true" tabindex="-1"></a>            <span class="st">'color'</span>: <span class="st">'red'</span>,</span>
<span id="cb3-2588"><a href="#cb3-2588" aria-hidden="true" tabindex="-1"></a>            <span class="st">'width'</span>: <span class="dv">2</span>,</span>
<span id="cb3-2589"><a href="#cb3-2589" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb3-2590"><a href="#cb3-2590" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Line'</span></span>
<span id="cb3-2591"><a href="#cb3-2591" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2592"><a href="#cb3-2592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2593"><a href="#cb3-2593" aria-hidden="true" tabindex="-1"></a>    trace_centroid <span class="op">=</span> go.Scatter3d(</span>
<span id="cb3-2594"><a href="#cb3-2594" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[centroid[<span class="dv">0</span>]],</span>
<span id="cb3-2595"><a href="#cb3-2595" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[centroid[<span class="dv">1</span>]],</span>
<span id="cb3-2596"><a href="#cb3-2596" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>[centroid[<span class="dv">2</span>]],</span>
<span id="cb3-2597"><a href="#cb3-2597" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">'markers'</span>,</span>
<span id="cb3-2598"><a href="#cb3-2598" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span>{</span>
<span id="cb3-2599"><a href="#cb3-2599" aria-hidden="true" tabindex="-1"></a>            <span class="st">'size'</span>: <span class="dv">5</span>,</span>
<span id="cb3-2600"><a href="#cb3-2600" aria-hidden="true" tabindex="-1"></a>            <span class="st">'color'</span>: <span class="st">'green'</span>,</span>
<span id="cb3-2601"><a href="#cb3-2601" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb3-2602"><a href="#cb3-2602" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Centroid'</span></span>
<span id="cb3-2603"><a href="#cb3-2603" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2604"><a href="#cb3-2604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2605"><a href="#cb3-2605" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure the layout.</span></span>
<span id="cb3-2606"><a href="#cb3-2606" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">=</span> go.Layout(</span>
<span id="cb3-2607"><a href="#cb3-2607" aria-hidden="true" tabindex="-1"></a>        margin<span class="op">=</span>{<span class="st">'l'</span>: <span class="dv">0</span>, <span class="st">'r'</span>: <span class="dv">0</span>, <span class="st">'b'</span>: <span class="dv">0</span>, <span class="st">'t'</span>: <span class="dv">0</span>},</span>
<span id="cb3-2608"><a href="#cb3-2608" aria-hidden="true" tabindex="-1"></a>        scene<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb3-2609"><a href="#cb3-2609" aria-hidden="true" tabindex="-1"></a>            xaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">True</span>, gridcolor<span class="op">=</span><span class="st">'rgb(211,211,211)'</span>, gridwidth<span class="op">=</span><span class="dv">2</span>,<span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="dv">5</span>,<span class="dv">185</span>], title <span class="op">=</span> <span class="st">"x/cm"</span>),</span>
<span id="cb3-2610"><a href="#cb3-2610" aria-hidden="true" tabindex="-1"></a>            yaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">True</span>, gridcolor<span class="op">=</span><span class="st">'rgb(211,211,211)'</span>, gridwidth<span class="op">=</span><span class="dv">2</span>,<span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="dv">5</span>, <span class="dv">105</span>],title <span class="op">=</span> <span class="st">"y/cm"</span>),</span>
<span id="cb3-2611"><a href="#cb3-2611" aria-hidden="true" tabindex="-1"></a>            zaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">True</span>, gridcolor<span class="op">=</span><span class="st">'rgb(211,211,211)'</span>, gridwidth<span class="op">=</span><span class="dv">2</span>,<span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="dv">5</span>, <span class="dv">125</span>],title<span class="op">=</span><span class="st">"z/cm"</span>)</span>
<span id="cb3-2612"><a href="#cb3-2612" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-2613"><a href="#cb3-2613" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-2614"><a href="#cb3-2614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2615"><a href="#cb3-2615" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Include trace_centroid in data= [] to plot centroid on the plot.</span></span>
<span id="cb3-2616"><a href="#cb3-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2617"><a href="#cb3-2617" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> [trace,trace_line,rpc_0,rpc_1,rpc_2,rpc_3,rpc_4,rpc_5]</span>
<span id="cb3-2618"><a href="#cb3-2618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2619"><a href="#cb3-2619" aria-hidden="true" tabindex="-1"></a>    plot_figure <span class="op">=</span> go.Figure(data<span class="op">=</span>data, layout<span class="op">=</span>layout)</span>
<span id="cb3-2620"><a href="#cb3-2620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2621"><a href="#cb3-2621" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Render the plot.</span></span>
<span id="cb3-2622"><a href="#cb3-2622" aria-hidden="true" tabindex="-1"></a>    plotly.offline.iplot(plot_figure)</span>
<span id="cb3-2623"><a href="#cb3-2623" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_cuboid_vertices(origin, dimensions):</span>
<span id="cb3-2624"><a href="#cb3-2624" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to calculate vertices of cuboid from origin and dimensions</span></span>
<span id="cb3-2625"><a href="#cb3-2625" aria-hidden="true" tabindex="-1"></a>    x_min, y_min, z_min <span class="op">=</span> origin</span>
<span id="cb3-2626"><a href="#cb3-2626" aria-hidden="true" tabindex="-1"></a>    x_max <span class="op">=</span> x_min <span class="op">+</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb3-2627"><a href="#cb3-2627" aria-hidden="true" tabindex="-1"></a>    y_max <span class="op">=</span> y_min <span class="op">+</span> dimensions[<span class="dv">1</span>]</span>
<span id="cb3-2628"><a href="#cb3-2628" aria-hidden="true" tabindex="-1"></a>    z_max <span class="op">=</span> z_min <span class="op">+</span> dimensions[<span class="dv">2</span>]</span>
<span id="cb3-2629"><a href="#cb3-2629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2630"><a href="#cb3-2630" aria-hidden="true" tabindex="-1"></a>    vertices <span class="op">=</span> [</span>
<span id="cb3-2631"><a href="#cb3-2631" aria-hidden="true" tabindex="-1"></a>        [x_min, y_min, z_min], [x_max, y_min, z_min],</span>
<span id="cb3-2632"><a href="#cb3-2632" aria-hidden="true" tabindex="-1"></a>        [x_max, y_max, z_min], [x_min, y_max, z_min],</span>
<span id="cb3-2633"><a href="#cb3-2633" aria-hidden="true" tabindex="-1"></a>        [x_min, y_min, z_max], [x_max, y_min, z_max],</span>
<span id="cb3-2634"><a href="#cb3-2634" aria-hidden="true" tabindex="-1"></a>        [x_max, y_max, z_max], [x_min, y_max, z_max]</span>
<span id="cb3-2635"><a href="#cb3-2635" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-2636"><a href="#cb3-2636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2637"><a href="#cb3-2637" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vertices</span>
<span id="cb3-2638"><a href="#cb3-2638" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_tdc_alignment_metric(tdc0, tdc1):</span>
<span id="cb3-2639"><a href="#cb3-2639" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc0 <span class="op">&gt;</span> tdc1:</span>
<span id="cb3-2640"><a href="#cb3-2640" aria-hidden="true" tabindex="-1"></a>        tdc0, tdc1 <span class="op">=</span> tdc1, tdc0</span>
<span id="cb3-2641"><a href="#cb3-2641" aria-hidden="true" tabindex="-1"></a>    i, j, k, l <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb3-2642"><a href="#cb3-2642" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc0 <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-2643"><a href="#cb3-2643" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb3-2644"><a href="#cb3-2644" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb3-2645"><a href="#cb3-2645" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb3-2646"><a href="#cb3-2646" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span></span>
<span id="cb3-2647"><a href="#cb3-2647" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-2648"><a href="#cb3-2648" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span></span>
<span id="cb3-2649"><a href="#cb3-2649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-2650"><a href="#cb3-2650" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">0</span></span>
<span id="cb3-2651"><a href="#cb3-2651" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc0 <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb3-2652"><a href="#cb3-2652" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb3-2653"><a href="#cb3-2653" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span></span>
<span id="cb3-2654"><a href="#cb3-2654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-2655"><a href="#cb3-2655" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span></span>
<span id="cb3-2656"><a href="#cb3-2656" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-2657"><a href="#cb3-2657" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span></span>
<span id="cb3-2658"><a href="#cb3-2658" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc0 <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb3-2659"><a href="#cb3-2659" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-2660"><a href="#cb3-2660" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span></span>
<span id="cb3-2661"><a href="#cb3-2661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-2662"><a href="#cb3-2662" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb3-2663"><a href="#cb3-2663" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tdc0 <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb3-2664"><a href="#cb3-2664" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tdc1 <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb3-2665"><a href="#cb3-2665" aria-hidden="true" tabindex="-1"></a>            i, j, k, l <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span></span>
<span id="cb3-2666"><a href="#cb3-2666" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2667"><a href="#cb3-2667" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> i, j, k, l</span>
<span id="cb3-2668"><a href="#cb3-2668" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2669"><a href="#cb3-2669" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_element(i, j, data):</span>
<span id="cb3-2670"><a href="#cb3-2670" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> j:</span>
<span id="cb3-2671"><a href="#cb3-2671" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2672"><a href="#cb3-2672" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> j:</span>
<span id="cb3-2673"><a href="#cb3-2673" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data.get((i, j), <span class="va">None</span>)</span>
<span id="cb3-2674"><a href="#cb3-2674" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-2675"><a href="#cb3-2675" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data.get((j, i), <span class="va">None</span>)    </span>
<span id="cb3-2676"><a href="#cb3-2676" aria-hidden="true" tabindex="-1"></a><span class="co">#Reconstruction, with timing of RPC hit taken into account in trajectory.</span></span>
<span id="cb3-2677"><a href="#cb3-2677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2678"><a href="#cb3-2678" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_entries(matrix):</span>
<span id="cb3-2679"><a href="#cb3-2679" aria-hidden="true" tabindex="-1"></a>    total_entries <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2680"><a href="#cb3-2680" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> matrix:</span>
<span id="cb3-2681"><a href="#cb3-2681" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> cell <span class="kw">in</span> row:</span>
<span id="cb3-2682"><a href="#cb3-2682" aria-hidden="true" tabindex="-1"></a>            total_entries <span class="op">+=</span> <span class="bu">len</span>(cell)</span>
<span id="cb3-2683"><a href="#cb3-2683" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_entries</span>
<span id="cb3-2684"><a href="#cb3-2684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2685"><a href="#cb3-2685" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reconstruct_timed_Chi2_modified(event,max_cluster_size, max_length<span class="op">=</span><span class="va">None</span>, exact_length<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-2686"><a href="#cb3-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2687"><a href="#cb3-2687" aria-hidden="true" tabindex="-1"></a>    <span class="co">#timed tag indicates that timing information from RPC is used to determine direction of vertical transversal of "particle" in the event.</span></span>
<span id="cb3-2688"><a href="#cb3-2688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2689"><a href="#cb3-2689" aria-hidden="true" tabindex="-1"></a>    max_Chi2 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-2690"><a href="#cb3-2690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2691"><a href="#cb3-2691" aria-hidden="true" tabindex="-1"></a>    <span class="co"># event = ['Event x',TIMEBIN, [[[RPC1_PHI_CLUSTERS],[RPC1_ETA_CLUSTERS]],[[...],[...]],...]</span></span>
<span id="cb3-2692"><a href="#cb3-2692" aria-hidden="true" tabindex="-1"></a>    RPC_heights <span class="op">=</span> [<span class="fl">0.6</span>,<span class="fl">1.8</span>,<span class="fl">3.0</span>,<span class="fl">61.8</span>,<span class="fl">121.8</span>,<span class="dv">123</span>] <span class="co">#Heights of middle point of each RPC, measured from the bottom of the Triplet Low RPC. Units are cm.</span></span>
<span id="cb3-2693"><a href="#cb3-2693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2694"><a href="#cb3-2694" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Extract x and y coords of cluster in event</span></span>
<span id="cb3-2695"><a href="#cb3-2695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2696"><a href="#cb3-2696" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> extract_coords_timed_Chi2(event,max_cluster_size)</span>
<span id="cb3-2697"><a href="#cb3-2697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2698"><a href="#cb3-2698" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the number of empty RPCs</span></span>
<span id="cb3-2699"><a href="#cb3-2699" aria-hidden="true" tabindex="-1"></a>    empty_RPC_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> item <span class="kw">in</span> coords <span class="cf">if</span> item <span class="op">==</span> [[], [],<span class="st">'N'</span>])</span>
<span id="cb3-2700"><a href="#cb3-2700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2701"><a href="#cb3-2701" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If less than 3 elements of coords are occupied, exit the function</span></span>
<span id="cb3-2702"><a href="#cb3-2702" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> empty_RPC_count <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb3-2703"><a href="#cb3-2703" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Failed to reconstruct, not enough coords")</span></span>
<span id="cb3-2704"><a href="#cb3-2704" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Exit the function</span></span>
<span id="cb3-2705"><a href="#cb3-2705" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2706"><a href="#cb3-2706" aria-hidden="true" tabindex="-1"></a>    <span class="co">#NEED TO CHECK IF STILL CROSS CHAMBER! </span></span>
<span id="cb3-2707"><a href="#cb3-2707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2708"><a href="#cb3-2708" aria-hidden="true" tabindex="-1"></a>    cross_chamberness <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2709"><a href="#cb3-2709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2710"><a href="#cb3-2710" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">0</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">1</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">2</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2711"><a href="#cb3-2711" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2712"><a href="#cb3-2712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2713"><a href="#cb3-2713" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">3</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2714"><a href="#cb3-2714" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2715"><a href="#cb3-2715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2716"><a href="#cb3-2716" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> coords[<span class="dv">4</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>] <span class="kw">or</span> coords[<span class="dv">5</span>] <span class="op">!=</span> [[], [], <span class="st">'N'</span>]:</span>
<span id="cb3-2717"><a href="#cb3-2717" aria-hidden="true" tabindex="-1"></a>        cross_chamberness <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2718"><a href="#cb3-2718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2719"><a href="#cb3-2719" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[0])</span></span>
<span id="cb3-2720"><a href="#cb3-2720" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[1])</span></span>
<span id="cb3-2721"><a href="#cb3-2721" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[2])</span></span>
<span id="cb3-2722"><a href="#cb3-2722" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[3])</span></span>
<span id="cb3-2723"><a href="#cb3-2723" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[4])</span></span>
<span id="cb3-2724"><a href="#cb3-2724" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords[5])</span></span>
<span id="cb3-2725"><a href="#cb3-2725" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(cross_chamberness)</span></span>
<span id="cb3-2726"><a href="#cb3-2726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2727"><a href="#cb3-2727" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if cross_chamberness &lt; 2:</span></span>
<span id="cb3-2728"><a href="#cb3-2728" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     #print("Failed to reconstruct, too few chambers")</span></span>
<span id="cb3-2729"><a href="#cb3-2729" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return None</span></span>
<span id="cb3-2730"><a href="#cb3-2730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2731"><a href="#cb3-2731" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ITERATING OVER EVERY POSSIBLE COMBINATION OF x,y,z over all 3 RPCs (limited to one x,y per RPC).</span></span>
<span id="cb3-2732"><a href="#cb3-2732" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Doesn't look particularly nice, but there are not many coordinates to loop over usually....</span></span>
<span id="cb3-2733"><a href="#cb3-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2734"><a href="#cb3-2734" aria-hidden="true" tabindex="-1"></a>    combinations <span class="op">=</span> generate_hit_coords_combo_Chi2(coords,RPC_heights, max_length<span class="op">=</span>max_length, exact_length<span class="op">=</span>exact_length)</span>
<span id="cb3-2735"><a href="#cb3-2735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2736"><a href="#cb3-2736" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Now for each combo in combinations, attempt to reconstruct a path. See which one gives the best trajectory.</span></span>
<span id="cb3-2737"><a href="#cb3-2737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2738"><a href="#cb3-2738" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If success, print parameters of fitting function.</span></span>
<span id="cb3-2739"><a href="#cb3-2739" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If fail, print reconstruction failed.</span></span>
<span id="cb3-2740"><a href="#cb3-2740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2741"><a href="#cb3-2741" aria-hidden="true" tabindex="-1"></a>    Chi2_current <span class="op">=</span> np.inf</span>
<span id="cb3-2742"><a href="#cb3-2742" aria-hidden="true" tabindex="-1"></a>    optimised_coords <span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2743"><a href="#cb3-2743" aria-hidden="true" tabindex="-1"></a>    optimised_d<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2744"><a href="#cb3-2744" aria-hidden="true" tabindex="-1"></a>    optimised_centroid<span class="op">=</span> <span class="va">None</span></span>
<span id="cb3-2745"><a href="#cb3-2745" aria-hidden="true" tabindex="-1"></a>    dT <span class="op">=</span> np.inf</span>
<span id="cb3-2746"><a href="#cb3-2746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2747"><a href="#cb3-2747" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ind,combo <span class="kw">in</span> <span class="bu">enumerate</span>(combinations):</span>
<span id="cb3-2748"><a href="#cb3-2748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2749"><a href="#cb3-2749" aria-hidden="true" tabindex="-1"></a>        centroid, d, Chi2, coordinates, delta_T, delta_Z<span class="op">=</span> fit_event_chi2(combo)</span>
<span id="cb3-2750"><a href="#cb3-2750" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2 <span class="op">&lt;</span> Chi2_current:</span>
<span id="cb3-2751"><a href="#cb3-2751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2752"><a href="#cb3-2752" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If new fit is better than old then replace old fit properties.</span></span>
<span id="cb3-2753"><a href="#cb3-2753" aria-hidden="true" tabindex="-1"></a>            dZ <span class="op">=</span> delta_Z </span>
<span id="cb3-2754"><a href="#cb3-2754" aria-hidden="true" tabindex="-1"></a>            dT <span class="op">=</span> delta_T</span>
<span id="cb3-2755"><a href="#cb3-2755" aria-hidden="true" tabindex="-1"></a>            Chi2_current <span class="op">=</span> Chi2</span>
<span id="cb3-2756"><a href="#cb3-2756" aria-hidden="true" tabindex="-1"></a>            optimised_centroid <span class="op">=</span> centroid</span>
<span id="cb3-2757"><a href="#cb3-2757" aria-hidden="true" tabindex="-1"></a>            optimised_d <span class="op">=</span> d</span>
<span id="cb3-2758"><a href="#cb3-2758" aria-hidden="true" tabindex="-1"></a>            optimised_coords <span class="op">=</span> coordinates</span>
<span id="cb3-2759"><a href="#cb3-2759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2760"><a href="#cb3-2760" aria-hidden="true" tabindex="-1"></a>    <span class="co">#if dT&gt;0 this implies the particles hit the higher RPC after the lower one, so the particle is travelling upwards here.</span></span>
<span id="cb3-2761"><a href="#cb3-2761" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Vice-versa for dT &lt; 0.</span></span>
<span id="cb3-2762"><a href="#cb3-2762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2763"><a href="#cb3-2763" aria-hidden="true" tabindex="-1"></a>    <span class="co">#dT = 0 case?</span></span>
<span id="cb3-2764"><a href="#cb3-2764" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2765"><a href="#cb3-2765" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dT <span class="op">!=</span> np.inf:</span>
<span id="cb3-2766"><a href="#cb3-2766" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2767"><a href="#cb3-2767" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> optimised_d[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb3-2768"><a href="#cb3-2768" aria-hidden="true" tabindex="-1"></a>            optimised_d <span class="op">=</span> np.multiply(optimised_d,<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-2769"><a href="#cb3-2769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2770"><a href="#cb3-2770" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Chi2_current<span class="op">&lt;</span>max_Chi2:</span>
<span id="cb3-2771"><a href="#cb3-2771" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> optimised_centroid, optimised_d, optimised_coords, combinations, Chi2_current, dT, dZ</span>
<span id="cb3-2772"><a href="#cb3-2772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2773"><a href="#cb3-2773" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-2774"><a href="#cb3-2774" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print("Failed to reconstruct, Chi2 too large")</span></span>
<span id="cb3-2775"><a href="#cb3-2775" aria-hidden="true" tabindex="-1"></a>            <span class="co">#return optimised_centroid, optimised_d, optimised_coords, combinations, residuals_current</span></span>
<span id="cb3-2776"><a href="#cb3-2776" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-2777"><a href="#cb3-2777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2778"><a href="#cb3-2778" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> does_muon_hit_RPC(optimised_centroid, optimised_d, RPC):</span>
<span id="cb3-2779"><a href="#cb3-2779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2780"><a href="#cb3-2780" aria-hidden="true" tabindex="-1"></a>    RPC_heights <span class="op">=</span> [<span class="fl">0.6</span>,<span class="fl">1.8</span>,<span class="fl">3.0</span>,<span class="fl">61.8</span>,<span class="fl">121.8</span>,<span class="dv">123</span>] </span>
<span id="cb3-2781"><a href="#cb3-2781" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Heights of middle point of each RPC, measured from the bottom of the Triplet Low RPC. Units are cm.</span></span>
<span id="cb3-2782"><a href="#cb3-2782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2783"><a href="#cb3-2783" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x_bar = x_centroid + d_vector * t</span></span>
<span id="cb3-2784"><a href="#cb3-2784" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find value of paramter t when the muon trajectory passes through the RPC height.</span></span>
<span id="cb3-2785"><a href="#cb3-2785" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2786"><a href="#cb3-2786" aria-hidden="true" tabindex="-1"></a>    z_0 <span class="op">=</span> optimised_centroid[<span class="dv">2</span>]</span>
<span id="cb3-2787"><a href="#cb3-2787" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> RPC_heights[RPC]</span>
<span id="cb3-2788"><a href="#cb3-2788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2789"><a href="#cb3-2789" aria-hidden="true" tabindex="-1"></a>    <span class="co"># t = (z-z_0)/d_z</span></span>
<span id="cb3-2790"><a href="#cb3-2790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2791"><a href="#cb3-2791" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> (z<span class="op">-</span>z_0)<span class="op">/</span>optimised_d[<span class="dv">2</span>]</span>
<span id="cb3-2792"><a href="#cb3-2792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2793"><a href="#cb3-2793" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find expected (x,y) coordinates at that height.</span></span>
<span id="cb3-2794"><a href="#cb3-2794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2795"><a href="#cb3-2795" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> optimised_centroid[<span class="dv">0</span>] <span class="op">+</span> t<span class="op">*</span>optimised_d[<span class="dv">0</span>]</span>
<span id="cb3-2796"><a href="#cb3-2796" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> optimised_centroid[<span class="dv">1</span>] <span class="op">+</span> t<span class="op">*</span>optimised_d[<span class="dv">1</span>]</span>
<span id="cb3-2797"><a href="#cb3-2797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2798"><a href="#cb3-2798" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if these (x,y) coordinates lie within the RPC. </span></span>
<span id="cb3-2799"><a href="#cb3-2799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2800"><a href="#cb3-2800" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Extract x and y coords of cluster in event</span></span>
<span id="cb3-2801"><a href="#cb3-2801" aria-hidden="true" tabindex="-1"></a>    distance_per_phi_channel <span class="op">=</span> <span class="fl">2.7625</span> <span class="co">#cm</span></span>
<span id="cb3-2802"><a href="#cb3-2802" aria-hidden="true" tabindex="-1"></a>    distance_per_eta_channel <span class="op">=</span> <span class="fl">2.9844</span> <span class="co">#cm</span></span>
<span id="cb3-2803"><a href="#cb3-2803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2804"><a href="#cb3-2804" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max y (eta side) is 31.5 * distance_per_eta_channel</span></span>
<span id="cb3-2805"><a href="#cb3-2805" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max x (phi side) is 63.5 * distance_per_phi_channel</span></span>
<span id="cb3-2806"><a href="#cb3-2806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2807"><a href="#cb3-2807" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> x <span class="op">&lt;</span> <span class="fl">63.5</span><span class="op">*</span>distance_per_phi_channel <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;</span> y <span class="op">&lt;</span> <span class="fl">31.5</span><span class="op">*</span>distance_per_eta_channel:</span>
<span id="cb3-2808"><a href="#cb3-2808" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Return coordinates where you expect the muon to hit this RPC from the reconstructed event.</span></span>
<span id="cb3-2809"><a href="#cb3-2809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [x,y]</span>
<span id="cb3-2810"><a href="#cb3-2810" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-2811"><a href="#cb3-2811" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("Muon does not hit RPC")</span></span>
<span id="cb3-2812"><a href="#cb3-2812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>    </span>
<span id="cb3-2813"><a href="#cb3-2813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2814"><a href="#cb3-2814" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> does_RPC_detect_muon(muon_coords,test_coords,tol):</span>
<span id="cb3-2815"><a href="#cb3-2815" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Tolerance in units of cm. </span></span>
<span id="cb3-2816"><a href="#cb3-2816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2817"><a href="#cb3-2817" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Could experiment with tolerance.</span></span>
<span id="cb3-2818"><a href="#cb3-2818" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> test_coords <span class="op">!=</span> [[],[],<span class="st">"N"</span>]: </span>
<span id="cb3-2819"><a href="#cb3-2819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2820"><a href="#cb3-2820" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> test_coords[<span class="dv">0</span>]</span>
<span id="cb3-2821"><a href="#cb3-2821" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> test_coords[<span class="dv">1</span>]</span>
<span id="cb3-2822"><a href="#cb3-2822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2823"><a href="#cb3-2823" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x_set <span class="kw">in</span> x_coords:</span>
<span id="cb3-2824"><a href="#cb3-2824" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> y_set <span class="kw">in</span> y_coords:</span>
<span id="cb3-2825"><a href="#cb3-2825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2826"><a href="#cb3-2826" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> x_set[<span class="dv">0</span>]</span>
<span id="cb3-2827"><a href="#cb3-2827" aria-hidden="true" tabindex="-1"></a>                y <span class="op">=</span> y_set[<span class="dv">0</span>]</span>
<span id="cb3-2828"><a href="#cb3-2828" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2829"><a href="#cb3-2829" aria-hidden="true" tabindex="-1"></a>                <span class="co">#If statement ensures only calculate the coords if the test_coords actually exist.</span></span>
<span id="cb3-2830"><a href="#cb3-2830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2831"><a href="#cb3-2831" aria-hidden="true" tabindex="-1"></a>                <span class="co">#Offset is 2D vector that represents difference </span></span>
<span id="cb3-2832"><a href="#cb3-2832" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> np.subtract(np.array([x,y]),muon_coords)</span>
<span id="cb3-2833"><a href="#cb3-2833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2834"><a href="#cb3-2834" aria-hidden="true" tabindex="-1"></a>                separation <span class="op">=</span> np.linalg.norm(offset)</span>
<span id="cb3-2835"><a href="#cb3-2835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2836"><a href="#cb3-2836" aria-hidden="true" tabindex="-1"></a>                <span class="co">#print(separation)</span></span>
<span id="cb3-2837"><a href="#cb3-2837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2838"><a href="#cb3-2838" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> separation <span class="op">&lt;=</span> tol:</span>
<span id="cb3-2839"><a href="#cb3-2839" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#Say the RPC only successfully reconstructs an event </span></span>
<span id="cb3-2840"><a href="#cb3-2840" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#if the distance between expected hit and reconstructed hit is less than tolerance.</span></span>
<span id="cb3-2841"><a href="#cb3-2841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2842"><a href="#cb3-2842" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#print("RPC successfully detects hit!")</span></span>
<span id="cb3-2843"><a href="#cb3-2843" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> separation</span>
<span id="cb3-2844"><a href="#cb3-2844" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-2845"><a href="#cb3-2845" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("No RPC coordinates constructed pass near the expected point!")</span></span>
<span id="cb3-2846"><a href="#cb3-2846" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb3-2847"><a href="#cb3-2847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2848"><a href="#cb3-2848" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-2849"><a href="#cb3-2849" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("No coordinates reconstructed by RPC")</span></span>
<span id="cb3-2850"><a href="#cb3-2850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>   </span>
<span id="cb3-2851"><a href="#cb3-2851" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-2852"><a href="#cb3-2852" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_efficiency_RPC(dataset, RPC, tol):</span>
<span id="cb3-2853"><a href="#cb3-2853" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure RPC is a list, even if it's a single integer</span></span>
<span id="cb3-2854"><a href="#cb3-2854" aria-hidden="true" tabindex="-1"></a>    RPC_excluded <span class="op">=</span> RPC</span>
<span id="cb3-2855"><a href="#cb3-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2856"><a href="#cb3-2856" aria-hidden="true" tabindex="-1"></a>    <span class="co"># events = filter_events_by_RPC(dataset, 2, 5, RPC_excluded)</span></span>
<span id="cb3-2857"><a href="#cb3-2857" aria-hidden="true" tabindex="-1"></a>    datas <span class="op">=</span> dataset</span>
<span id="cb3-2858"><a href="#cb3-2858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2859"><a href="#cb3-2859" aria-hidden="true" tabindex="-1"></a>    possible_reconstructions <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2860"><a href="#cb3-2860" aria-hidden="true" tabindex="-1"></a>    successful_reconstructions <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tol))]</span>
<span id="cb3-2861"><a href="#cb3-2861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2862"><a href="#cb3-2862" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, data <span class="kw">in</span> <span class="bu">enumerate</span>(datas):</span>
<span id="cb3-2863"><a href="#cb3-2863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2864"><a href="#cb3-2864" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f"Event index {i}")</span></span>
<span id="cb3-2865"><a href="#cb3-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2866"><a href="#cb3-2866" aria-hidden="true" tabindex="-1"></a>        E_recon <span class="op">=</span> reconstruct_timed_Chi2_ByRPC(data, <span class="dv">3</span>, RPC_excluded)</span>
<span id="cb3-2867"><a href="#cb3-2867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2868"><a href="#cb3-2868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> E_recon:</span>
<span id="cb3-2869"><a href="#cb3-2869" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(E_recon[<span class="dv">2</span>]) <span class="op">&gt;=</span> <span class="dv">5</span>:</span>
<span id="cb3-2870"><a href="#cb3-2870" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Adding this check to see if other 5 RPCs are in reconstructed event.</span></span>
<span id="cb3-2871"><a href="#cb3-2871" aria-hidden="true" tabindex="-1"></a>                <span class="co"># This is necessary to ensure the reconstructed path is accurate.</span></span>
<span id="cb3-2872"><a href="#cb3-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2873"><a href="#cb3-2873" aria-hidden="true" tabindex="-1"></a>                muon_coords <span class="op">=</span> does_muon_hit_RPC(E_recon[<span class="dv">0</span>], E_recon[<span class="dv">1</span>], RPC_excluded)</span>
<span id="cb3-2874"><a href="#cb3-2874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2875"><a href="#cb3-2875" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> muon_coords:</span>
<span id="cb3-2876"><a href="#cb3-2876" aria-hidden="true" tabindex="-1"></a>                    possible_reconstructions <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2877"><a href="#cb3-2877" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> idx, t <span class="kw">in</span> <span class="bu">enumerate</span>(tol):</span>
<span id="cb3-2878"><a href="#cb3-2878" aria-hidden="true" tabindex="-1"></a>                        check <span class="op">=</span> does_RPC_detect_muon(muon_coords, E_recon[<span class="dv">7</span>], t)</span>
<span id="cb3-2879"><a href="#cb3-2879" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> check:</span>
<span id="cb3-2880"><a href="#cb3-2880" aria-hidden="true" tabindex="-1"></a>                            successful_reconstructions[idx] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-2881"><a href="#cb3-2881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2882"><a href="#cb3-2882" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(possible_reconstructions)</span></span>
<span id="cb3-2883"><a href="#cb3-2883" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(successful_reconstructions)</span></span>
<span id="cb3-2884"><a href="#cb3-2884" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if possible_reconstructions == 0:</span></span>
<span id="cb3-2885"><a href="#cb3-2885" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return -1</span></span>
<span id="cb3-2886"><a href="#cb3-2886" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(possible_reconstructions)</span></span>
<span id="cb3-2887"><a href="#cb3-2887" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(successful_reconstructions)</span></span>
<span id="cb3-2888"><a href="#cb3-2888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2889"><a href="#cb3-2889" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> possible_reconstructions <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-2890"><a href="#cb3-2890" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-2891"><a href="#cb3-2891" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [i <span class="op">/</span> possible_reconstructions <span class="cf">for</span> i <span class="kw">in</span> successful_reconstructions]</span>
<span id="cb3-2892"><a href="#cb3-2892" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tdcEventToRPCData(event,activeTDCs<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>], event_num <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb3-2893"><a href="#cb3-2893" aria-hidden="true" tabindex="-1"></a>    rpcHits <span class="op">=</span> [[] <span class="cf">for</span> rpc <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb3-2894"><a href="#cb3-2894" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tdc <span class="kw">in</span> activeTDCs:</span>
<span id="cb3-2895"><a href="#cb3-2895" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> word <span class="kw">in</span> event.tdcEvents[tdc].words:</span>
<span id="cb3-2896"><a href="#cb3-2896" aria-hidden="true" tabindex="-1"></a>            rpc, thisHit <span class="op">=</span> tdcChanToRPCHit(word,tdc, event_num<span class="op">=</span>event_num)</span>
<span id="cb3-2897"><a href="#cb3-2897" aria-hidden="true" tabindex="-1"></a>            rpcHits[rpc].append(thisHit)</span>
<span id="cb3-2898"><a href="#cb3-2898" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rpcHits</span>
<span id="cb3-2899"><a href="#cb3-2899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2900"><a href="#cb3-2900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2901"><a href="#cb3-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2902"><a href="#cb3-2902" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-2903"><a href="#cb3-2903" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cluster_size_histograms(cluster_sizes):</span>
<span id="cb3-2904"><a href="#cb3-2904" aria-hidden="true" tabindex="-1"></a>    phi_cluster_sizes <span class="op">=</span> []</span>
<span id="cb3-2905"><a href="#cb3-2905" aria-hidden="true" tabindex="-1"></a>    eta_cluster_sizes <span class="op">=</span> []</span>
<span id="cb3-2906"><a href="#cb3-2906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2907"><a href="#cb3-2907" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event_cluster_sizes <span class="kw">in</span> cluster_sizes:</span>
<span id="cb3-2908"><a href="#cb3-2908" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rpc_cluster_sizes <span class="kw">in</span> event_cluster_sizes:</span>
<span id="cb3-2909"><a href="#cb3-2909" aria-hidden="true" tabindex="-1"></a>            phi_cluster_sizes.extend(rpc_cluster_sizes[<span class="dv">0</span>])</span>
<span id="cb3-2910"><a href="#cb3-2910" aria-hidden="true" tabindex="-1"></a>            eta_cluster_sizes.extend(rpc_cluster_sizes[<span class="dv">1</span>])</span>
<span id="cb3-2911"><a href="#cb3-2911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2912"><a href="#cb3-2912" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate bin edges</span></span>
<span id="cb3-2913"><a href="#cb3-2913" aria-hidden="true" tabindex="-1"></a>    phi_bin_edges <span class="op">=</span> np.arange(<span class="fl">0.5</span>, <span class="bu">max</span>(phi_cluster_sizes) <span class="op">+</span> <span class="fl">1.5</span>, <span class="dv">1</span>)</span>
<span id="cb3-2914"><a href="#cb3-2914" aria-hidden="true" tabindex="-1"></a>    eta_bin_edges <span class="op">=</span> np.arange(<span class="fl">0.5</span>, <span class="bu">max</span>(eta_cluster_sizes) <span class="op">+</span> <span class="fl">1.5</span>, <span class="dv">1</span>)</span>
<span id="cb3-2915"><a href="#cb3-2915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2916"><a href="#cb3-2916" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the phi cluster size histogram</span></span>
<span id="cb3-2917"><a href="#cb3-2917" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-2918"><a href="#cb3-2918" aria-hidden="true" tabindex="-1"></a>    plt.hist(phi_cluster_sizes, bins<span class="op">=</span>phi_bin_edges, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'mid'</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-2919"><a href="#cb3-2919" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Cluster Size'</span>)</span>
<span id="cb3-2920"><a href="#cb3-2920" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Proportion of Events'</span>)</span>
<span id="cb3-2921"><a href="#cb3-2921" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Phi Cluster Size Distribution'</span>)</span>
<span id="cb3-2922"><a href="#cb3-2922" aria-hidden="true" tabindex="-1"></a>    plt.xticks(np.arange(<span class="dv">1</span>, <span class="bu">max</span>(phi_cluster_sizes) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb3-2923"><a href="#cb3-2923" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb3-2924"><a href="#cb3-2924" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb3-2925"><a href="#cb3-2925" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb3-2926"><a href="#cb3-2926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2927"><a href="#cb3-2927" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the eta cluster size histogram</span></span>
<span id="cb3-2928"><a href="#cb3-2928" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-2929"><a href="#cb3-2929" aria-hidden="true" tabindex="-1"></a>    plt.hist(eta_cluster_sizes, bins<span class="op">=</span>eta_bin_edges, edgecolor<span class="op">=</span><span class="st">'black'</span>, align<span class="op">=</span><span class="st">'mid'</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-2930"><a href="#cb3-2930" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Cluster Size'</span>)</span>
<span id="cb3-2931"><a href="#cb3-2931" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Proportion of Events'</span>)</span>
<span id="cb3-2932"><a href="#cb3-2932" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Eta Cluster Size Distribution'</span>)</span>
<span id="cb3-2933"><a href="#cb3-2933" aria-hidden="true" tabindex="-1"></a>    plt.xticks(np.arange(<span class="dv">1</span>, <span class="bu">max</span>(eta_cluster_sizes) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb3-2934"><a href="#cb3-2934" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb3-2935"><a href="#cb3-2935" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb3-2936"><a href="#cb3-2936" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:831: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:849: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:919: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:934: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:953: SyntaxWarning: invalid escape sequence '\s'
&lt;&gt;:1219: SyntaxWarning: invalid escape sequence '\s'
&lt;&gt;:831: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:849: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:919: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:934: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:953: SyntaxWarning: invalid escape sequence '\s'
&lt;&gt;:1219: SyntaxWarning: invalid escape sequence '\s'
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:831: SyntaxWarning: invalid escape sequence '\e'
  thisHist.cbar.set_label('$\eta$ hit time - $\phi$ hit time, Average (ns)', rotation=270, y=0.3,labelpad=23)
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:849: SyntaxWarning: invalid escape sequence '\e'
  thisHist.cbar.set_label('$\eta$ hit time - $\phi$ hit time, Average (ns)', rotation=270, y=0.3,labelpad=23)
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:919: SyntaxWarning: invalid escape sequence '\p'
  ax.set_xlabel('$\phi$ Channel')
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:934: SyntaxWarning: invalid escape sequence '\e'
  ax.set_xlabel('$\eta$ Channel')
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:953: SyntaxWarning: invalid escape sequence '\s'
  ax.set_ylabel('Average $\sqrt{d\eta^2+d\phi^2}$')
C:\Users\Peter\AppData\Local\Temp\ipykernel_27128\2796798919.py:1219: SyntaxWarning: invalid escape sequence '\s'
  ax.set_ylabel('Average $\sqrt{d\eta^2+d\phi^2}$')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">10000</span>, monitor_factor<span class="op">=</span><span class="dv">10</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>rAligner.plot_count_entries()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-4-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/Fixed.raw'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">10000</span>, monitor_factor<span class="op">=</span><span class="dv">10</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>rAligner.plot_count_entries()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 100, insertions [0, 0, 0, 1, 3], updates [0, 0, -1, -2]
New alignment, Event number 300, insertions [0, 4, 8, 8, 8], updates [-4, -4, 0, 0]
New alignment, Event number 700, insertions [0, 0, 1, 1, 1], updates [0, -1, 0, 0]
New alignment, Event number 2100, insertions [1, 1, 0, 1, 0], updates [0, 1, -1, 1]
New alignment, Event number 3300, insertions [0, 0, 1, 0, 1], updates [0, -1, 1, -1]
New alignment, Event number 4000, insertions [1, 1, 0, 0, 0], updates [0, 1, 0, 0]
New alignment, Event number 4100, insertions [0, 1, 1, 1, 1], updates [-1, 0, 0, 0]
New alignment, Event number 4800, insertions [0, 0, 1, 1, 1], updates [0, -1, 0, 0]
New alignment, Event number 4900, insertions [1, 1, 0, 0, 0], updates [0, 1, 0, 0]
New alignment, Event number 7600, insertions [0, 0, 0, 1, 0], updates [0, 0, -1, 1]
New alignment, Event number 8100, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 8300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 8500, insertions [1, 1, 0, 0, 0], updates [0, 1, 0, 0]
New alignment, Event number 9200, insertions [2, 0, 1, 1, 1], updates [2, -1, 0, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-5-output-7.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rAligner.plot_efficiency()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 0, 0, 0, 0, 0]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">10</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_global_alignment_metric()</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>rAligner.plot_alignment_metric()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_times()</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_channels()</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_state_metric()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-7-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.plot(rAligner.processed_event_values, rAligner.only_header_values, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Processed Events'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Only Header'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Only Header vs Processed Events'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_global_alignment_metric()</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_event_count()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_times()</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_channels()</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_error_times_separate_ranges()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_error_channels_separate_ranges()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_alignment_times()</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_alignment_channels()</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1200x800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-11.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-10-output-12.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_times_separate_ranges()</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_channels_separate_ranges()</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_alignment_times()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_alignment_channels()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-11-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_times_separate_ranges()</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_channels_separate_ranges()</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_alignment_channels_separate_ranges()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>rAligner.plot_tdc_alignment_times_separate_ranges()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1200x800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-11.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-12-output-12.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event <span class="op">=</span> <span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">15</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_times_separate_ranges()</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_error_channels_separate_ranges()</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_alignment_channels_separate_ranges()</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plot_tdc_alignment_times_separate_ranges()</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># rAligner.plotTDCTimeDiffs()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(rAligner.TDC_alignment_time[<span class="dv">4</span>]))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(rAligner.TDC_alignment_time[<span class="dv">3</span>]))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(rAligner.TDC_alignment_time[<span class="dv">2</span>]))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(rAligner.TDC_alignment_time[<span class="dv">1</span>]))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(rAligner.TDC_alignment_time[<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>16950
56266
98567
113881
54630</code></pre>
</div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> min_time, min_word <span class="kw">in</span> rAligner.TDC_alignment_time[<span class="dv">0</span>]:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(min_time)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(min_word)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>207.20000000000002
(0, 108)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rAligner.count1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'realigner' object has no attribute 'count1'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Early <span class="op">=</span> rAligner.count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Late <span class="op">=</span> rAligner.count2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>event_counts_windows <span class="op">=</span> [<span class="bu">len</span>(Early[count]) <span class="cf">for</span> count <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>event_counts_linux <span class="op">=</span> [<span class="bu">len</span>(Late[count]) <span class="cf">for</span> count <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating total events</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>total_windows <span class="op">=</span> <span class="bu">sum</span>(event_counts_windows)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>total_linux <span class="op">=</span> <span class="bu">sum</span>(event_counts_linux)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizing event counts</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>normalized_windows <span class="op">=</span> [count <span class="op">/</span> total_windows <span class="cf">for</span> count <span class="kw">in</span> event_counts_windows]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>normalized_linux <span class="op">=</span> [count <span class="op">/</span> total_linux <span class="cf">for</span> count <span class="kw">in</span> event_counts_linux]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding padding value to make the curve end smoothly at 6.5</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>normalized_windows.append(normalized_windows[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>normalized_linux.append(normalized_linux[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">7</span>)) <span class="op">+</span> [<span class="fl">6.5</span>]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.step(r1, normalized_linux, color='mediumseagreen', linestyle='-', linewidth=2, markersize=6, label='0-15000', alpha=1, where='mid')</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>plt.step(r1, normalized_windows, color<span class="op">=</span><span class="st">'dodgerblue'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, label<span class="op">=</span><span class="st">'0-15000?'</span>, alpha<span class="op">=</span><span class="dv">1</span>, where<span class="op">=</span><span class="st">'mid'</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>plt.step(r1, normalized_linux, color<span class="op">=</span><span class="st">'dodgerblue'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, label<span class="op">=</span><span class="st">'25000-40000?'</span>, alpha<span class="op">=</span><span class="dv">1</span>, where<span class="op">=</span><span class="st">'mid'</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding labels and title</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Trigger Number'</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Events Normalized'</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Normalized Event Count'</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">6.5</span>)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(<span class="dv">7</span>))</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding legend</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>rAligner.plotTDCTimeDiffs(showplot<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-14.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-16.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-18.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-20.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-22.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-21-output-24.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>residEta <span class="op">=</span> rAligner.residEtaLatest</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>residPhi <span class="op">=</span> rAligner.residPhiLatest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>readDict<span class="op">=</span>rAligner.outDict</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ph <span class="op">=</span> <span class="dv">19</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>et <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>rpc<span class="op">=</span> <span class="dv">1</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>rpcTitles <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>readDict[<span class="st">'diffHists'</span>][rpc][ph][et].plot1d(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"teal"</span>, lw<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'proANUBIS Data'</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'$\eta$ Hit Time - $\phi$ Hit Time (ns)'</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>yrange <span class="op">=</span> ax.get_ylim()</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="op">-</span><span class="dv">2</span>, <span class="fl">0.8</span><span class="op">*</span>yrange[<span class="dv">1</span>], rpcTitles[rpc]<span class="op">+</span><span class="st">", $\eta$="</span><span class="op">+</span><span class="bu">str</span>(et)<span class="op">+</span><span class="st">" $\phi$="</span><span class="op">+</span><span class="bu">str</span>(ph), fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                verticalalignment<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_yscale('log')</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gaus(x,a,x0,sigma):</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">*</span>np.exp(<span class="op">-</span>(x<span class="op">-</span>x0)<span class="op">**</span><span class="dv">2</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co"># popt,pcov = curve_fit(gaus,readDict['diffHists'][rpc][ph][et].axes.centers[0],readDict['diffHists'][rpc][ph][et].values(),p0=[1,13,5])</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co"># fitX = [0.1*x-10 for x in range(400)]</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(fitX,gaus(fitX,*popt),'r:',label='Gaussian Fit')</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="op">-</span><span class="dv">100</span>,<span class="dv">100</span>])</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.text(-2, 0.7*yrange[1], "Fit mean:"+str(round(popt[1],2))+", $\sigma$: "+str(round(popt[2],2)), fontsize=14,</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                 verticalalignment='top')</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:10: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:10: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\p'
C:\Users\Peter\AppData\Local\Temp\ipykernel_24044\3604423767.py:10: SyntaxWarning: invalid escape sequence '\e'
  ax.set_xlabel('$\eta$ Hit Time - $\phi$ Hit Time (ns)')
C:\Users\Peter\AppData\Local\Temp\ipykernel_24044\3604423767.py:12: SyntaxWarning: invalid escape sequence '\e'
  ax.text(-2, 0.8*yrange[1], rpcTitles[rpc]+", $\eta$="+str(et)+" $\phi$="+str(ph), fontsize=14,
C:\Users\Peter\AppData\Local\Temp\ipykernel_24044\3604423767.py:12: SyntaxWarning: invalid escape sequence '\p'
  ax.text(-2, 0.8*yrange[1], rpcTitles[rpc]+", $\eta$="+str(et)+" $\phi$="+str(ph), fontsize=14,
c:\Users\Peter\AppData\Local\Programs\Python\Python312\Lib\site-packages\mplhep\utils.py:199: RuntimeWarning: All sumw are zero!  Cannot compute meaningful error bars
  return np.abs(method_fcn(self.values, variances) - self.values)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fitDiffs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>excludedEta <span class="op">=</span> [<span class="dv">31</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>excludedPhi <span class="op">=</span> [<span class="dv">19</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>fitPhChan <span class="op">=</span> [<span class="fl">0.5</span><span class="op">+</span>chan <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>fitEtChan <span class="op">=</span> [<span class="fl">0.5</span><span class="op">+</span>chan <span class="cf">for</span> chan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>fitDiffs <span class="op">=</span> [row[:] <span class="cf">for</span> row <span class="kw">in</span> rAligner.scDiffs]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>distance_per_phi_channel <span class="op">=</span> <span class="fl">2.7625</span> <span class="co">#cm</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>distance_per_eta_channel <span class="op">=</span> <span class="fl">2.9844</span> <span class="co">#cm</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> phchan <span class="kw">in</span> excludedPhi:</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>            fitDiffs[phchan][etchan] <span class="op">=</span> rAligner.scDiffs[phchan <span class="op">+</span> <span class="dv">1</span>][etchan]</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> etchan <span class="kw">in</span> excludedEta:</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>            fitDiffs[phchan].pop(etchan)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> etChan <span class="kw">in</span> excludedEta:</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    fitEtChan.pop(etChan)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fitPhDist = [chan * distance_per_phi_channel for chan in fitPhChan]</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co"># fitEtDist = [chan * distance_per_eta_channel for chan in fitEtChan]</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plane(xy, a, b):</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> xy</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (a <span class="op">*</span> (x <span class="op">-</span> y) <span class="op">+</span> b).ravel()</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> np.meshgrid(fitEtChan, fitPhChan)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>popt, pcov <span class="op">=</span> curve_fit(plane, (x, y), np.array(fitDiffs).ravel(), p0<span class="op">=</span>[<span class="fl">0.175</span>, <span class="dv">13</span>])</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(popt[<span class="dv">0</span>], popt[<span class="dv">1</span>])</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate fitted data and residuals</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>data_fitted <span class="op">=</span> plane((x, y), <span class="op">*</span>popt)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> np.array(fitDiffs).ravel() <span class="op">-</span> data_fitted</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>ss_res <span class="op">=</span> np.<span class="bu">sum</span>(residuals<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>ss_tot <span class="op">=</span> np.<span class="bu">sum</span>((np.array(fitDiffs).ravel() <span class="op">-</span> np.mean(np.array(fitDiffs).ravel()))<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>r_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (ss_res <span class="op">/</span> ss_tot)</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R value: </span><span class="sc">{</span>r_squared<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>heatmap <span class="op">=</span> ax.imshow(np.array(fitDiffs).reshape(<span class="dv">64</span>, <span class="bu">len</span>(fitEtChan)), cmap<span class="op">=</span>plt.cm.jet, origin<span class="op">=</span><span class="st">'lower'</span>,</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>                    extent<span class="op">=</span>(<span class="dv">0</span>, <span class="bu">max</span>(fitEtChan), <span class="dv">0</span>, <span class="bu">max</span>(fitPhChan)), vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>plt.colorbar(heatmap, ax<span class="op">=</span>ax)</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>ax.contour(x, y, data_fitted.reshape(<span class="dv">64</span>, <span class="bu">len</span>(fitEtChan)), <span class="dv">16</span>, colors<span class="op">=</span><span class="st">'w'</span>)</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Eta channel'</span>)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Phi channel'</span>)</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Heatmap and Fitted Plane Contours'</span>)</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.15377708086449335 16.142891774718695
R value: 0.6241079567643311</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-25-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>phichannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">65</span>)]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>rpcNames <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, rpc <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]):</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    plotPhiResids <span class="op">=</span> rAligner.residPhiLatest[idx].copy()</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    plotPhiResids.append(plotPhiResids[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    plt.step(phichannels,plotPhiResids,linewidth<span class="op">=</span><span class="dv">3</span>,label<span class="op">=</span>rpcNames[rpc],where<span class="op">=</span><span class="st">'post'</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>yrange <span class="op">=</span> ax.get_ylim()</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.text(40, 0.8*yrange[1], "Slope: "+str(round(popt[0],3))+" ns/channel, Offset: "+str(round(popt[1],2))+" ns", fontsize=14,</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a> <span class="co">#               verticalalignment='top')</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'$\phi$ Channel'</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Time Residual (ns)'</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">63.5</span>])</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>etchannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>)]</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, rpc <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]):</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    plotEtaResids <span class="op">=</span> rAligner.residEtaLatest[idx].copy()</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    plotEtaResids.append(plotEtaResids[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    plt.step(etchannels,plotEtaResids,linewidth<span class="op">=</span><span class="dv">3</span>,label<span class="op">=</span>rpcNames[rpc],where<span class="op">=</span><span class="st">'post'</span>)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>yrange <span class="op">=</span> ax.get_ylim()</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.text(40, 0.8*yrange[1], "Slope: "+str(round(popt[0],3))+" ns/channel, Offset: "+str(round(popt[1],2))+" ns", fontsize=14,</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a> <span class="co">#               verticalalignment='top')</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'$\eta$ Channel'</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Time Residual (ns)'</span>)</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">31.5</span>])</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:26: SyntaxWarning: invalid escape sequence '\e'
&lt;&gt;:12: SyntaxWarning: invalid escape sequence '\p'
&lt;&gt;:26: SyntaxWarning: invalid escape sequence '\e'
C:\Users\Peter\AppData\Local\Temp\ipykernel_9328\798755218.py:12: SyntaxWarning: invalid escape sequence '\p'
  ax.set_xlabel('$\phi$ Channel')
C:\Users\Peter\AppData\Local\Temp\ipykernel_9328\798755218.py:26: SyntaxWarning: invalid escape sequence '\e'
  ax.set_xlabel('$\eta$ Channel')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-26-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-26-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event<span class="op">=</span><span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">30</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>, residPhi<span class="op">=</span>residPhi.copy(), residEta<span class="op">=</span>residEta.copy())</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events_timing_compensated()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>global alignmend at 100
global alignmend at 200
global alignmend at 300
global alignmend at 400
global alignmend at 500
global alignmend at 600
global alignmend at 700
global alignmend at 800
global alignmend at 900
global alignmend at 1000
global alignmend at 1100
global alignmend at 1200
global alignmend at 1300
global alignmend at 1400
global alignmend at 1500
global alignmend at 1600
global alignmend at 1700
global alignmend at 1800
global alignmend at 1900
global alignmend at 2000
global alignmend at 2100
global alignmend at 2200
global alignmend at 2300
global alignmend at 2400
global alignmend at 2500
global alignmend at 2600
global alignmend at 2700
global alignmend at 2800
global alignmend at 2900
global alignmend at 3000
global alignmend at 3100
global alignmend at 3200
global alignmend at 3300
global alignmend at 3400
global alignmend at 3500
global alignmend at 3600
global alignmend at 3700
global alignmend at 3800
global alignmend at 3900
global alignmend at 4000
global alignmend at 4100
global alignmend at 4200
global alignmend at 4300
global alignmend at 4400
global alignmend at 4500
global alignmend at 4600
global alignmend at 4700
global alignmend at 4800
global alignmend at 4900
global alignmend at 5000
global alignmend at 5100
global alignmend at 5200
global alignmend at 5300
global alignmend at 5400
global alignmend at 5500
global alignmend at 5600
global alignmend at 5700
global alignmend at 5800
global alignmend at 5900
global alignmend at 6000
global alignmend at 6100
global alignmend at 6200
global alignmend at 6300
global alignmend at 6400
global alignmend at 6500
global alignmend at 6600
global alignmend at 6700
global alignmend at 6800
global alignmend at 6900
global alignmend at 7000
global alignmend at 7100
global alignmend at 7200
global alignmend at 7300
global alignmend at 7400
global alignmend at 7500
global alignmend at 7600
global alignmend at 7700
global alignmend at 7800
global alignmend at 7900
global alignmend at 8000
global alignmend at 8100
global alignmend at 8200
global alignmend at 8300
global alignmend at 8400
global alignmend at 8500
global alignmend at 8600
global alignmend at 8700
global alignmend at 8800
global alignmend at 8900
global alignmend at 9000
global alignmend at 9100
global alignmend at 9200
global alignmend at 9300
global alignmend at 9400
global alignmend at 9500
global alignmend at 9600
global alignmend at 9700
global alignmend at 9800
global alignmend at 9900
global alignmend at 10000
global alignmend at 10100
global alignmend at 10200
global alignmend at 10300
global alignmend at 10400
global alignmend at 10600
global alignmend at 10700
global alignmend at 10800
global alignmend at 10900
global alignmend at 11000
global alignmend at 11100
global alignmend at 11200
global alignmend at 11300
global alignmend at 11400
global alignmend at 11500
global alignmend at 11600
global alignmend at 11700
global alignmend at 11800
global alignmend at 11900
global alignmend at 12000
global alignmend at 12100
global alignmend at 12200
global alignmend at 12300
global alignmend at 12400
global alignmend at 12500
global alignmend at 12600
global alignmend at 12700
global alignmend at 12800
global alignmend at 12900
global alignmend at 13000
global alignmend at 13100
global alignmend at 13200
global alignmend at 13300
global alignmend at 13400
global alignmend at 13500
global alignmend at 13600
global alignmend at 13700
global alignmend at 13800
global alignmend at 13900
global alignmend at 14000
global alignmend at 14100
global alignmend at 14200
global alignmend at 14300
global alignmend at 14400
global alignmend at 14500
global alignmend at 14600
global alignmend at 14700
global alignmend at 14800
global alignmend at 14900
global alignmend at 15000
global alignmend at 15100
global alignmend at 15200
global alignmend at 15300
global alignmend at 15400
global alignmend at 15500
global alignmend at 15600
global alignmend at 15700
global alignmend at 15800
global alignmend at 15900
global alignmend at 16000
global alignmend at 16100
global alignmend at 16200
global alignmend at 16300
global alignmend at 16400
global alignmend at 16500
global alignmend at 16600
global alignmend at 16700
global alignmend at 16800
global alignmend at 16900
global alignmend at 17000
global alignmend at 17100
global alignmend at 17200
global alignmend at 17300
global alignmend at 17400
global alignmend at 17500
global alignmend at 17600
global alignmend at 17700
global alignmend at 17800
global alignmend at 17900
global alignmend at 18000
global alignmend at 18100
global alignmend at 18200
global alignmend at 18300
global alignmend at 18400
global alignmend at 18500
global alignmend at 18600
global alignmend at 18700
global alignmend at 18800
global alignmend at 18900
global alignmend at 19000
global alignmend at 19100
global alignmend at 19200
global alignmend at 19300
global alignmend at 19400
global alignmend at 19500
global alignmend at 19600
global alignmend at 19700
global alignmend at 19800
global alignmend at 19900
global alignmend at 20000
global alignmend at 20100
global alignmend at 20200
global alignmend at 20300
global alignmend at 20400
global alignmend at 20500
global alignmend at 20600
global alignmend at 20700
global alignmend at 20800
global alignmend at 20900
global alignmend at 21000
global alignmend at 21100
global alignmend at 21200
global alignmend at 21300
global alignmend at 21400
global alignmend at 21500
global alignmend at 21600
global alignmend at 21700
global alignmend at 21800
global alignmend at 21900
global alignmend at 22000
global alignmend at 22100
global alignmend at 22200
global alignmend at 22300
global alignmend at 22400
global alignmend at 22500
global alignmend at 22600
global alignmend at 22700
global alignmend at 22800
global alignmend at 22900
global alignmend at 23000
global alignmend at 23100
global alignmend at 23200
global alignmend at 23300
global alignmend at 23400
global alignmend at 23500
global alignmend at 23600
global alignmend at 23700
global alignmend at 23800
global alignmend at 23900
global alignmend at 24000
global alignmend at 24100
global alignmend at 24200
global alignmend at 24300
global alignmend at 24400
global alignmend at 24500
global alignmend at 24600
global alignmend at 24700
global alignmend at 24800
global alignmend at 24900
global alignmend at 25000
global alignmend at 25100
global alignmend at 25200
global alignmend at 25300
global alignmend at 25400
global alignmend at 25500
global alignmend at 25600
global alignmend at 25700
global alignmend at 25800
global alignmend at 25900
global alignmend at 26000
global alignmend at 26100
global alignmend at 26200
global alignmend at 26300
global alignmend at 26400
global alignmend at 26500
global alignmend at 26600
global alignmend at 26700
global alignmend at 26800
global alignmend at 26900
global alignmend at 27000
global alignmend at 27100
global alignmend at 27200
global alignmend at 27300
global alignmend at 27400
global alignmend at 27500
global alignmend at 27600
global alignmend at 27700
global alignmend at 27800
global alignmend at 27900
global alignmend at 28000
global alignmend at 28100
global alignmend at 28200
global alignmend at 28300
global alignmend at 28400
global alignmend at 28500
global alignmend at 28600
global alignmend at 28700
global alignmend at 28800
global alignmend at 28900
global alignmend at 29000
global alignmend at 29100
global alignmend at 29200
global alignmend at 29300
global alignmend at 29400
global alignmend at 29500
global alignmend at 29600
global alignmend at 29700
global alignmend at 29800
global alignmend at 29900
global alignmend at 30000
global alignmend at 30100
global alignmend at 30200
global alignmend at 30300
global alignmend at 30400
global alignmend at 30500
global alignmend at 30600
New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
global alignmend at 30800
global alignmend at 30900
global alignmend at 31000
global alignmend at 31100
global alignmend at 31200
global alignmend at 31300
global alignmend at 31400
global alignmend at 31500
global alignmend at 31600
global alignmend at 31700
global alignmend at 31800
global alignmend at 31900
global alignmend at 32000
global alignmend at 32100
global alignmend at 32200
global alignmend at 32300
global alignmend at 32400
global alignmend at 32500
global alignmend at 32600
global alignmend at 32700
global alignmend at 32800
global alignmend at 32900
global alignmend at 33000
global alignmend at 33100
global alignmend at 33200
global alignmend at 33300
global alignmend at 33400
global alignmend at 33500
global alignmend at 33600
global alignmend at 33700
global alignmend at 33800
global alignmend at 33900
global alignmend at 34000
global alignmend at 34100
global alignmend at 34200
global alignmend at 34300
global alignmend at 34400
global alignmend at 34500
global alignmend at 34600
global alignmend at 34700
global alignmend at 34800
global alignmend at 34900
global alignmend at 35000
global alignmend at 35100
global alignmend at 35200
global alignmend at 35300
global alignmend at 35400
global alignmend at 35500
global alignmend at 35600
global alignmend at 35700
global alignmend at 35800
global alignmend at 35900
global alignmend at 36000
global alignmend at 36100
global alignmend at 36200
global alignmend at 36300
global alignmend at 36400
global alignmend at 36500
global alignmend at 36600
global alignmend at 36700
global alignmend at 36800
global alignmend at 36900
global alignmend at 37000
global alignmend at 37100
global alignmend at 37200
global alignmend at 37300
global alignmend at 37400
global alignmend at 37500
global alignmend at 37600
global alignmend at 37700
global alignmend at 37800
global alignmend at 37900
global alignmend at 38000
global alignmend at 38100
global alignmend at 38200
global alignmend at 38300
global alignmend at 38400
global alignmend at 38500
global alignmend at 38600
global alignmend at 38700
global alignmend at 38800
global alignmend at 38900
global alignmend at 39000
global alignmend at 39100
global alignmend at 39200
global alignmend at 39300
global alignmend at 39400
global alignmend at 39500
global alignmend at 39600
global alignmend at 39700
global alignmend at 39800
global alignmend at 39900
global alignmend at 40000
global alignmend at 40100
global alignmend at 40200
global alignmend at 40300
global alignmend at 40400
global alignmend at 40500
global alignmend at 40600
global alignmend at 40700
global alignmend at 40800
global alignmend at 40900
global alignmend at 41000
global alignmend at 41100
global alignmend at 41200
global alignmend at 41300
global alignmend at 41400
global alignmend at 41500
global alignmend at 41600
global alignmend at 41700
global alignmend at 41800
global alignmend at 41900
global alignmend at 42000
global alignmend at 42100
global alignmend at 42200
global alignmend at 42300
global alignmend at 42400
global alignmend at 42500
global alignmend at 42600
global alignmend at 42700
global alignmend at 42800
global alignmend at 42900
global alignmend at 43000
global alignmend at 43100
global alignmend at 43200
global alignmend at 43300
global alignmend at 43400
global alignmend at 43500
global alignmend at 43600
global alignmend at 43700
global alignmend at 43800
global alignmend at 43900
global alignmend at 44000
global alignmend at 44100
global alignmend at 44200
global alignmend at 44300
global alignmend at 44400
global alignmend at 44500
global alignmend at 44600
global alignmend at 44700
global alignmend at 44800
global alignmend at 44900
global alignmend at 45000
global alignmend at 45100
global alignmend at 45200
global alignmend at 45300
global alignmend at 45400
global alignmend at 45500
global alignmend at 45600
global alignmend at 45700
global alignmend at 45800
global alignmend at 45900
global alignmend at 46000
global alignmend at 46100
global alignmend at 46200
global alignmend at 46300
global alignmend at 46400
global alignmend at 46500
global alignmend at 46600
global alignmend at 46700
global alignmend at 46800
global alignmend at 46900
global alignmend at 47000
global alignmend at 47100
global alignmend at 47200
global alignmend at 47300
global alignmend at 47400
global alignmend at 47500
global alignmend at 47600
global alignmend at 47700
global alignmend at 47800
global alignmend at 47900
global alignmend at 48000
global alignmend at 48100
global alignmend at 48200
global alignmend at 48300
global alignmend at 48400
global alignmend at 48500
global alignmend at 48600
global alignmend at 48700
global alignmend at 48800
global alignmend at 48900
global alignmend at 49000
global alignmend at 49100
global alignmend at 49200
global alignmend at 49300
global alignmend at 49400
global alignmend at 49500
global alignmend at 49600
global alignmend at 49700
global alignmend at 49800
global alignmend at 49900
global alignmend at 50000
global alignmend at 50100
global alignmend at 50200
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
global alignmend at 50400
global alignmend at 50500
global alignmend at 50600
global alignmend at 50700
global alignmend at 50800
global alignmend at 50900
global alignmend at 51000
global alignmend at 51100
global alignmend at 51200
global alignmend at 51300
global alignmend at 51400
global alignmend at 51500
global alignmend at 51600
global alignmend at 51700
global alignmend at 51800
global alignmend at 51900
global alignmend at 52000
global alignmend at 52100
global alignmend at 52200
global alignmend at 52300
global alignmend at 52400
global alignmend at 52500
global alignmend at 52600
global alignmend at 52700
global alignmend at 52800
global alignmend at 52900
global alignmend at 53000
global alignmend at 53100
global alignmend at 53200
global alignmend at 53300
global alignmend at 53400
global alignmend at 53500
global alignmend at 53600
global alignmend at 53700
global alignmend at 53800
global alignmend at 53900
global alignmend at 54000
global alignmend at 54100
global alignmend at 54200
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
global alignmend at 54400
global alignmend at 54500
global alignmend at 54600
global alignmend at 54700
global alignmend at 54800
global alignmend at 54900
global alignmend at 55000
global alignmend at 55100
global alignmend at 55200
global alignmend at 55300
global alignmend at 55400
global alignmend at 55500
global alignmend at 55600
global alignmend at 55700
global alignmend at 55800
global alignmend at 55900
global alignmend at 56000
global alignmend at 56100
global alignmend at 56200
global alignmend at 56300
global alignmend at 56400
global alignmend at 56500
global alignmend at 56600
global alignmend at 56700
global alignmend at 56800
global alignmend at 56900
global alignmend at 57000
global alignmend at 57100
global alignmend at 57200
global alignmend at 57300
global alignmend at 57400
global alignmend at 57500
global alignmend at 57600
global alignmend at 57700
global alignmend at 57800
global alignmend at 57900
global alignmend at 58000
global alignmend at 58100
global alignmend at 58200
global alignmend at 58300
global alignmend at 58400
global alignmend at 58500
global alignmend at 58600
global alignmend at 58700
global alignmend at 58800
global alignmend at 58900
global alignmend at 59000
global alignmend at 59100
global alignmend at 59200
global alignmend at 59300
global alignmend at 59400
global alignmend at 59500
global alignmend at 59600
global alignmend at 59700
global alignmend at 59800
global alignmend at 59900
global alignmend at 60000
global alignmend at 60100
global alignmend at 60200
global alignmend at 60300
global alignmend at 60400
global alignmend at 60500
global alignmend at 60600
global alignmend at 60700
global alignmend at 60800
global alignmend at 60900
global alignmend at 61000
global alignmend at 61100
global alignmend at 61200
global alignmend at 61300
global alignmend at 61400
global alignmend at 61500
global alignmend at 61600
global alignmend at 61700
global alignmend at 61800
global alignmend at 61900
global alignmend at 62000
global alignmend at 62100
global alignmend at 62200
global alignmend at 62300
global alignmend at 62400
global alignmend at 62500
global alignmend at 62600
global alignmend at 62700
global alignmend at 62800
global alignmend at 62900
global alignmend at 63000
global alignmend at 63100
global alignmend at 63200
global alignmend at 63300
global alignmend at 63400
global alignmend at 63500
global alignmend at 63600
global alignmend at 63700
global alignmend at 63800
global alignmend at 63900
global alignmend at 64000
global alignmend at 64100
global alignmend at 64200
global alignmend at 64300
global alignmend at 64400
global alignmend at 64500
global alignmend at 64600
global alignmend at 64700
global alignmend at 64800
global alignmend at 64900
global alignmend at 65000
global alignmend at 65100
global alignmend at 65200
global alignmend at 65300
global alignmend at 65400
global alignmend at 65500
global alignmend at 65600
global alignmend at 65700
global alignmend at 65800
global alignmend at 65900
global alignmend at 66000
global alignmend at 66100
global alignmend at 66200
global alignmend at 66300
global alignmend at 66400
global alignmend at 66500
global alignmend at 66600
global alignmend at 66700
global alignmend at 66800
global alignmend at 66900
global alignmend at 67000
global alignmend at 67100
global alignmend at 67200
global alignmend at 67300
global alignmend at 67400
global alignmend at 67500
global alignmend at 67600
global alignmend at 67700
global alignmend at 67800
global alignmend at 67900
global alignmend at 68000
global alignmend at 68100
global alignmend at 68200
global alignmend at 68300
global alignmend at 68400
global alignmend at 68500
global alignmend at 68600
global alignmend at 68700
global alignmend at 68800
global alignmend at 68900
global alignmend at 69000
global alignmend at 69100
global alignmend at 69200
global alignmend at 69300
global alignmend at 69400
global alignmend at 69500
global alignmend at 69600
global alignmend at 69700
global alignmend at 69800
global alignmend at 69900
global alignmend at 70000
global alignmend at 70100
global alignmend at 70200
global alignmend at 70300
global alignmend at 70400
global alignmend at 70500
global alignmend at 70600
global alignmend at 70700
global alignmend at 70800
global alignmend at 70900
global alignmend at 71000
global alignmend at 71100
global alignmend at 71200
global alignmend at 71300
global alignmend at 71400
global alignmend at 71500
global alignmend at 71600
global alignmend at 71700
global alignmend at 71800
global alignmend at 71900
global alignmend at 72000
global alignmend at 72100
global alignmend at 72200
global alignmend at 72300
global alignmend at 72400
global alignmend at 72500
global alignmend at 72600
global alignmend at 72700
global alignmend at 72800
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
global alignmend at 73100
global alignmend at 73200
global alignmend at 73300
global alignmend at 73400
global alignmend at 73500
global alignmend at 73600
global alignmend at 73700
global alignmend at 73800
global alignmend at 73900
global alignmend at 74000
global alignmend at 74100
global alignmend at 74200
global alignmend at 74300
global alignmend at 74400
global alignmend at 74500
global alignmend at 74600
global alignmend at 74700
global alignmend at 74800
global alignmend at 74900
global alignmend at 75000
global alignmend at 75100
global alignmend at 75200
global alignmend at 75300
global alignmend at 75400
global alignmend at 75500
global alignmend at 75600
global alignmend at 75700
global alignmend at 75800
global alignmend at 75900
global alignmend at 76000
global alignmend at 76100
global alignmend at 76200
global alignmend at 76300
global alignmend at 76400
global alignmend at 76500
global alignmend at 76600
global alignmend at 76700
global alignmend at 76800
global alignmend at 76900
global alignmend at 77000
global alignmend at 77100
global alignmend at 77200
global alignmend at 77300
global alignmend at 77400
global alignmend at 77500
global alignmend at 77600
global alignmend at 77700
global alignmend at 77800
global alignmend at 77900
global alignmend at 78000
global alignmend at 78100
global alignmend at 78200
global alignmend at 78300
global alignmend at 78400
global alignmend at 78500
global alignmend at 78600
global alignmend at 78700
global alignmend at 78800
global alignmend at 78900
global alignmend at 79000
global alignmend at 79100
global alignmend at 79200
global alignmend at 79300
global alignmend at 79400
global alignmend at 79500
global alignmend at 79600
global alignmend at 79700
global alignmend at 79800
global alignmend at 79900
global alignmend at 80000
global alignmend at 80100
global alignmend at 80200
global alignmend at 80300
global alignmend at 80400
global alignmend at 80500
global alignmend at 80600
global alignmend at 80700
global alignmend at 80800
global alignmend at 80900
global alignmend at 81000
global alignmend at 81100
global alignmend at 81200
global alignmend at 81300
global alignmend at 81400
global alignmend at 81500
global alignmend at 81600
global alignmend at 81700
global alignmend at 81800
global alignmend at 81900
global alignmend at 82000
global alignmend at 82100
global alignmend at 82200
global alignmend at 82300
global alignmend at 82400
global alignmend at 82500
global alignmend at 82600
global alignmend at 82700
global alignmend at 82800
global alignmend at 82900
global alignmend at 83000
global alignmend at 83100
global alignmend at 83200
global alignmend at 83300
global alignmend at 83400
global alignmend at 83500
global alignmend at 83600
global alignmend at 83700
global alignmend at 83800
global alignmend at 83900
global alignmend at 84000
global alignmend at 84100
global alignmend at 84200
global alignmend at 84300
global alignmend at 84400
global alignmend at 84500
global alignmend at 84600
global alignmend at 84700
global alignmend at 84800
global alignmend at 84900
global alignmend at 85000
global alignmend at 85100
global alignmend at 85200
global alignmend at 85300
global alignmend at 85400
global alignmend at 85500
global alignmend at 85600
global alignmend at 85700
global alignmend at 85800
global alignmend at 85900
global alignmend at 86000
global alignmend at 86100
global alignmend at 86200
global alignmend at 86300
global alignmend at 86400
global alignmend at 86500
global alignmend at 86600
global alignmend at 86700
global alignmend at 86800
global alignmend at 86900
global alignmend at 87000
global alignmend at 87100
global alignmend at 87200
global alignmend at 87300
global alignmend at 87400
global alignmend at 87500
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
global alignmend at 87800
global alignmend at 87900
global alignmend at 88000
global alignmend at 88100
global alignmend at 88200
global alignmend at 88300
global alignmend at 88400
global alignmend at 88500
global alignmend at 88600
global alignmend at 88700
global alignmend at 88800
global alignmend at 88900
global alignmend at 89000
global alignmend at 89100
global alignmend at 89200
global alignmend at 89300
global alignmend at 89400
global alignmend at 89500
global alignmend at 89600
global alignmend at 89700
global alignmend at 89800
global alignmend at 89900
global alignmend at 90000
global alignmend at 90100
global alignmend at 90200
global alignmend at 90300
global alignmend at 90400
global alignmend at 90500
global alignmend at 90600
global alignmend at 90700
global alignmend at 90800
global alignmend at 90900
global alignmend at 91000
global alignmend at 91100
global alignmend at 91200
global alignmend at 91300
global alignmend at 91400
global alignmend at 91500
global alignmend at 91600
global alignmend at 91700
global alignmend at 91800
global alignmend at 91900
global alignmend at 92000
global alignmend at 92100
global alignmend at 92200
global alignmend at 92300
global alignmend at 92400
global alignmend at 92500
global alignmend at 92600
global alignmend at 92700
global alignmend at 92800
global alignmend at 92900
global alignmend at 93000
global alignmend at 93100
global alignmend at 93200
global alignmend at 93300
global alignmend at 93400
global alignmend at 93500
global alignmend at 93600
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]
global alignmend at 93800
global alignmend at 93900
global alignmend at 94000
global alignmend at 94100
global alignmend at 94200
global alignmend at 94300
global alignmend at 94400
global alignmend at 94500
global alignmend at 94600
global alignmend at 94700
global alignmend at 94800
global alignmend at 94900
global alignmend at 95000
global alignmend at 95100
global alignmend at 95200
global alignmend at 95300
global alignmend at 95400
global alignmend at 95500
global alignmend at 95600
global alignmend at 95700
global alignmend at 95800
global alignmend at 95900
global alignmend at 96000
global alignmend at 96100
global alignmend at 96200
global alignmend at 96300
global alignmend at 96400
global alignmend at 96500
global alignmend at 96600
global alignmend at 96700
global alignmend at 96800
global alignmend at 96900
global alignmend at 97000
global alignmend at 97100
global alignmend at 97200
global alignmend at 97300
global alignmend at 97400
global alignmend at 97500
global alignmend at 97600
global alignmend at 97700
global alignmend at 97800
global alignmend at 97900
global alignmend at 98000
global alignmend at 98100
global alignmend at 98200
global alignmend at 98300
global alignmend at 98400
global alignmend at 98500
global alignmend at 98600
global alignmend at 98700
global alignmend at 98800
global alignmend at 98900
global alignmend at 99000
global alignmend at 99100
global alignmend at 99200
global alignmend at 99300
global alignmend at 99400
global alignmend at 99500
global alignmend at 99600
global alignmend at 99700
global alignmend at 99800
global alignmend at 99900
global alignmend at 100000</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tof <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dT <span class="kw">in</span> rAligner.dT:</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        tof[i].append(dT[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> opt</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gauss(x, a, mu, sigma):</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> np.exp(<span class="op">-</span>(x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>rpc_indicies <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>], [<span class="dv">4</span>,<span class="dv">5</span>]]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting individual histograms and Gaussian fits</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    mid_average <span class="op">=</span> np.mean(tof[i])</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Mid average value for RPC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">-5: </span><span class="sc">{</span>mid_average<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform Gaussian fit</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    hist, bin_edges <span class="op">=</span> np.histogram(tof[i], bins<span class="op">=</span><span class="dv">300</span>, <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    bin_centers <span class="op">=</span> (bin_edges[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> bin_edges[<span class="dv">1</span>:]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>        popt, pcov <span class="op">=</span> opt.curve_fit(gauss, bin_centers, hist, p0<span class="op">=</span>[<span class="bu">max</span>(hist), <span class="dv">0</span>, <span class="dv">10</span>])</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot histogram with Gaussian fit</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>        plt.figure()</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        plt.hist(tof[i], bins<span class="op">=</span><span class="dv">1000</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1000</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        y_fit <span class="op">=</span> gauss(x_fit, <span class="op">*</span>popt)</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        plt.plot(x_fit, y_fit, <span class="st">'r-'</span>, label<span class="op">=</span><span class="st">'Gaussian fit'</span>)</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Systematically and tof Corrected, RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'tof / ns'</span>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'events'</span>)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Annotate the plot with Gaussian fit parameters</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>        fit_params_text <span class="op">=</span> <span class="ss">f'Amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Std Dev = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        plt.annotate(fit_params_text, xy<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), xycoords<span class="op">=</span><span class="st">'axes fraction'</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Show plot</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit parameters for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">: amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, std deviation = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">RuntimeError</span>:</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit failed for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting combined pseudograph for Gaussian fits</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>    hist, bin_edges <span class="op">=</span> np.histogram(tof[i], bins<span class="op">=</span><span class="dv">100</span>, <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>    bin_centers <span class="op">=</span> (bin_edges[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> bin_edges[<span class="dv">1</span>:]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>        popt, pcov <span class="op">=</span> opt.curve_fit(gauss, bin_centers, hist, p0<span class="op">=</span>[<span class="bu">max</span>(hist), <span class="dv">0</span>, <span class="dv">10</span>])</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>        x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1000</span>)</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>        y_fit <span class="op">=</span> gauss(x_fit, <span class="op">*</span>popt)</span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>        plt.plot(x_fit, y_fit, label<span class="op">=</span><span class="ss">f'RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss"> fit'</span>)</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">RuntimeError</span>:</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit failed for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Combined Gaussian Fits for RPC0-5 to RPC4-5 larger sample of 100,000'</span>)</span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'tof / ns'</span>)</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'events'</span>)</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Show combined fit plot</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mid average value for RPC0-5: 1.3567527415472156</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 1]: amplitude = 433.91825405082756, mean = 1.1879070331451431, std deviation = 1.0064261388619589
Mid average value for RPC1-5: 1.0081501490744862</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 2]: amplitude = 449.7320723198423, mean = 0.7238451130435709, std deviation = -0.9708539097213003
Mid average value for RPC2-5: 3.777692656443649</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 3]: amplitude = 267.08460918162683, mean = 3.385701398486754, std deviation = 1.6654607352451358
Mid average value for RPC3-5: 7.089086962541097</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 4]: amplitude = 155.66139241640974, mean = 7.177240726093822, std deviation = 2.921301631339286
Mid average value for RPC4-5: 7.484869590466341</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 5]: amplitude = 158.07552471853342, mean = 7.280717962867561, std deviation = 2.8820375039484656
Mid average value for RPC5-5: 0.3957826279252454</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[4, 5]: amplitude = 454.3555155050978, mean = 0.12132453175574043, std deviation = -0.9504172901741453</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-29-output-14.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(rawFileReader)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../Data/proAnubis_240716_2142.raw'</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>fReader <span class="op">=</span> rawFileReader.fileReader(file_path)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>rAligner <span class="op">=</span> realigner(fReader<span class="op">=</span> fReader, max_process_event<span class="op">=</span><span class="dv">100000</span>, monitor_factor<span class="op">=</span><span class="dv">25</span>, tof_correction<span class="op">=</span><span class="va">True</span>, order<span class="op">=</span>order, dev_mode<span class="op">=</span><span class="va">True</span>, window_size<span class="op">=</span><span class="dv">30</span>, record_inserted_events<span class="op">=</span><span class="va">False</span>, residPhi<span class="op">=</span>residPhi.copy(), residEta<span class="op">=</span>residEta.copy())</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>rAligner.get_aligned_events_timing_compensated()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>global alignmend at 100
global alignmend at 200
global alignmend at 300
global alignmend at 400
global alignmend at 500
global alignmend at 600
global alignmend at 700
global alignmend at 800
global alignmend at 900
global alignmend at 1000
global alignmend at 1100
global alignmend at 1200
global alignmend at 1300
global alignmend at 1400
global alignmend at 1500
global alignmend at 1600
global alignmend at 1700
global alignmend at 1800
global alignmend at 1900
global alignmend at 2000
global alignmend at 2100
global alignmend at 2200
global alignmend at 2300
global alignmend at 2400
global alignmend at 2500
global alignmend at 2600
global alignmend at 2700
global alignmend at 2800
global alignmend at 2900
global alignmend at 3000
global alignmend at 3100
global alignmend at 3200
global alignmend at 3300
global alignmend at 3400
global alignmend at 3500
global alignmend at 3600
global alignmend at 3700
global alignmend at 3800
global alignmend at 3900
global alignmend at 4000
global alignmend at 4100
global alignmend at 4200
global alignmend at 4300
global alignmend at 4400
global alignmend at 4500
global alignmend at 4600
global alignmend at 4700
global alignmend at 4800
global alignmend at 4900
global alignmend at 5000
global alignmend at 5100
global alignmend at 5200
global alignmend at 5300
global alignmend at 5400
global alignmend at 5500
global alignmend at 5600
global alignmend at 5700
global alignmend at 5800
global alignmend at 5900
global alignmend at 6000
global alignmend at 6100
global alignmend at 6200
global alignmend at 6300
global alignmend at 6400
global alignmend at 6500
global alignmend at 6600
global alignmend at 6700
global alignmend at 6800
global alignmend at 6900
global alignmend at 7000
global alignmend at 7100
global alignmend at 7200
global alignmend at 7300
global alignmend at 7400
global alignmend at 7500
global alignmend at 7600
global alignmend at 7700
global alignmend at 7800
global alignmend at 7900
global alignmend at 8000
global alignmend at 8100
global alignmend at 8200
global alignmend at 8300
global alignmend at 8400
global alignmend at 8500
global alignmend at 8600
global alignmend at 8700
global alignmend at 8800
global alignmend at 8900
global alignmend at 9000
global alignmend at 9100
global alignmend at 9200
global alignmend at 9300
global alignmend at 9400
global alignmend at 9500
global alignmend at 9600
global alignmend at 9700
global alignmend at 9800
global alignmend at 9900
global alignmend at 10000
global alignmend at 10100
global alignmend at 10200
global alignmend at 10300
global alignmend at 10400
global alignmend at 10600
global alignmend at 10700
global alignmend at 10800
global alignmend at 10900
global alignmend at 11000
global alignmend at 11100
global alignmend at 11200
global alignmend at 11300
global alignmend at 11400
global alignmend at 11500
global alignmend at 11600
global alignmend at 11700
global alignmend at 11800
global alignmend at 11900
global alignmend at 12000
global alignmend at 12100
global alignmend at 12200
global alignmend at 12300
global alignmend at 12400
global alignmend at 12500
global alignmend at 12600
global alignmend at 12700
global alignmend at 12800
global alignmend at 12900
global alignmend at 13000
global alignmend at 13100
global alignmend at 13200
global alignmend at 13300
global alignmend at 13400
global alignmend at 13500
global alignmend at 13600
global alignmend at 13700
global alignmend at 13800
global alignmend at 13900
global alignmend at 14000
global alignmend at 14100
global alignmend at 14200
global alignmend at 14300
global alignmend at 14400
global alignmend at 14500
global alignmend at 14600
global alignmend at 14700
global alignmend at 14800
global alignmend at 14900
global alignmend at 15000
global alignmend at 15100
global alignmend at 15200
global alignmend at 15300
global alignmend at 15400
global alignmend at 15500
global alignmend at 15600
global alignmend at 15700
global alignmend at 15800
global alignmend at 15900
global alignmend at 16000
global alignmend at 16100
global alignmend at 16200
global alignmend at 16300
global alignmend at 16400
global alignmend at 16500
global alignmend at 16600
global alignmend at 16700
global alignmend at 16800
global alignmend at 16900
global alignmend at 17000
global alignmend at 17100
global alignmend at 17200
global alignmend at 17300
global alignmend at 17400
global alignmend at 17500
global alignmend at 17600
global alignmend at 17700
global alignmend at 17800
global alignmend at 17900
global alignmend at 18000
global alignmend at 18100
global alignmend at 18200
global alignmend at 18300
global alignmend at 18400
global alignmend at 18500
global alignmend at 18600
global alignmend at 18700
global alignmend at 18800
global alignmend at 18900
global alignmend at 19000
global alignmend at 19100
global alignmend at 19200
global alignmend at 19300
global alignmend at 19400
global alignmend at 19500
global alignmend at 19600
global alignmend at 19700
global alignmend at 19800
global alignmend at 19900
global alignmend at 20000
global alignmend at 20100
global alignmend at 20200
global alignmend at 20300
global alignmend at 20400
global alignmend at 20500
global alignmend at 20600
global alignmend at 20700
global alignmend at 20800
global alignmend at 20900
global alignmend at 21000
global alignmend at 21100
global alignmend at 21200
global alignmend at 21300
global alignmend at 21400
global alignmend at 21500
global alignmend at 21600
global alignmend at 21700
global alignmend at 21800
global alignmend at 21900
global alignmend at 22000
global alignmend at 22100
global alignmend at 22200
global alignmend at 22300
global alignmend at 22400
global alignmend at 22500
global alignmend at 22600
global alignmend at 22700
global alignmend at 22800
global alignmend at 22900
global alignmend at 23000
global alignmend at 23100
global alignmend at 23200
global alignmend at 23300
global alignmend at 23400
global alignmend at 23500
global alignmend at 23600
global alignmend at 23700
global alignmend at 23800
global alignmend at 23900
global alignmend at 24000
global alignmend at 24100
global alignmend at 24200
global alignmend at 24300
global alignmend at 24400
global alignmend at 24500
global alignmend at 24600
global alignmend at 24700
global alignmend at 24800
global alignmend at 24900
global alignmend at 25000
global alignmend at 25100
global alignmend at 25200
global alignmend at 25300
global alignmend at 25400
global alignmend at 25500
global alignmend at 25600
global alignmend at 25700
global alignmend at 25800
global alignmend at 25900
global alignmend at 26000
global alignmend at 26100
global alignmend at 26200
global alignmend at 26300
global alignmend at 26400
global alignmend at 26500
global alignmend at 26600
global alignmend at 26700
global alignmend at 26800
global alignmend at 26900
global alignmend at 27000
global alignmend at 27100
global alignmend at 27200
global alignmend at 27300
global alignmend at 27400
global alignmend at 27500
global alignmend at 27600
global alignmend at 27700
global alignmend at 27800
global alignmend at 27900
global alignmend at 28000
global alignmend at 28100
global alignmend at 28200
global alignmend at 28300
global alignmend at 28400
global alignmend at 28500
global alignmend at 28600
global alignmend at 28700
global alignmend at 28800
global alignmend at 28900
global alignmend at 29000
global alignmend at 29100
global alignmend at 29200
global alignmend at 29300
global alignmend at 29400
global alignmend at 29500
global alignmend at 29600
global alignmend at 29700
global alignmend at 29800
global alignmend at 29900
global alignmend at 30000
global alignmend at 30100
global alignmend at 30200
global alignmend at 30300
global alignmend at 30400
global alignmend at 30500
global alignmend at 30600
New alignment, Event number 30700, insertions [0, 1, 1, 0, 1], updates [-1, 0, 1, -1]
global alignmend at 30800
global alignmend at 30900
global alignmend at 31000
global alignmend at 31100
global alignmend at 31200
global alignmend at 31300
global alignmend at 31400
global alignmend at 31500
global alignmend at 31600
global alignmend at 31700
global alignmend at 31800
global alignmend at 31900
global alignmend at 32000
global alignmend at 32100
global alignmend at 32200
global alignmend at 32300
global alignmend at 32400
global alignmend at 32500
global alignmend at 32600
global alignmend at 32700
global alignmend at 32800
global alignmend at 32900
global alignmend at 33000
global alignmend at 33100
global alignmend at 33200
global alignmend at 33300
global alignmend at 33400
global alignmend at 33500
global alignmend at 33600
global alignmend at 33700
global alignmend at 33800
global alignmend at 33900
global alignmend at 34000
global alignmend at 34100
global alignmend at 34200
global alignmend at 34300
global alignmend at 34400
global alignmend at 34500
global alignmend at 34600
global alignmend at 34700
global alignmend at 34800
global alignmend at 34900
global alignmend at 35000
global alignmend at 35100
global alignmend at 35200
global alignmend at 35300
global alignmend at 35400
global alignmend at 35500
global alignmend at 35600
global alignmend at 35700
global alignmend at 35800
global alignmend at 35900
global alignmend at 36000
global alignmend at 36100
global alignmend at 36200
global alignmend at 36300
global alignmend at 36400
global alignmend at 36500
global alignmend at 36600
global alignmend at 36700
global alignmend at 36800
global alignmend at 36900
global alignmend at 37000
global alignmend at 37100
global alignmend at 37200
global alignmend at 37300
global alignmend at 37400
global alignmend at 37500
global alignmend at 37600
global alignmend at 37700
global alignmend at 37800
global alignmend at 37900
global alignmend at 38000
global alignmend at 38100
global alignmend at 38200
global alignmend at 38300
global alignmend at 38400
global alignmend at 38500
global alignmend at 38600
global alignmend at 38700
global alignmend at 38800
global alignmend at 38900
global alignmend at 39000
global alignmend at 39100
global alignmend at 39200
global alignmend at 39300
global alignmend at 39400
global alignmend at 39500
global alignmend at 39600
global alignmend at 39700
global alignmend at 39800
global alignmend at 39900
global alignmend at 40000
global alignmend at 40100
global alignmend at 40200
global alignmend at 40300
global alignmend at 40400
global alignmend at 40500
global alignmend at 40600
global alignmend at 40700
global alignmend at 40800
global alignmend at 40900
global alignmend at 41000
global alignmend at 41100
global alignmend at 41200
global alignmend at 41300
global alignmend at 41400
global alignmend at 41500
global alignmend at 41600
global alignmend at 41700
global alignmend at 41800
global alignmend at 41900
global alignmend at 42000
global alignmend at 42100
global alignmend at 42200
global alignmend at 42300
global alignmend at 42400
global alignmend at 42500
global alignmend at 42600
global alignmend at 42700
global alignmend at 42800
global alignmend at 42900
global alignmend at 43000
global alignmend at 43100
global alignmend at 43200
global alignmend at 43300
global alignmend at 43400
global alignmend at 43500
global alignmend at 43600
global alignmend at 43700
global alignmend at 43800
global alignmend at 43900
global alignmend at 44000
global alignmend at 44100
global alignmend at 44200
global alignmend at 44300
global alignmend at 44400
global alignmend at 44500
global alignmend at 44600
global alignmend at 44700
global alignmend at 44800
global alignmend at 44900
global alignmend at 45000
global alignmend at 45100
global alignmend at 45200
global alignmend at 45300
global alignmend at 45400
global alignmend at 45500
global alignmend at 45600
global alignmend at 45700
global alignmend at 45800
global alignmend at 45900
global alignmend at 46000
global alignmend at 46100
global alignmend at 46200
global alignmend at 46300
global alignmend at 46400
global alignmend at 46500
global alignmend at 46600
global alignmend at 46700
global alignmend at 46800
global alignmend at 46900
global alignmend at 47000
global alignmend at 47100
global alignmend at 47200
global alignmend at 47300
global alignmend at 47400
global alignmend at 47500
global alignmend at 47600
global alignmend at 47700
global alignmend at 47800
global alignmend at 47900
global alignmend at 48000
global alignmend at 48100
global alignmend at 48200
global alignmend at 48300
global alignmend at 48400
global alignmend at 48500
global alignmend at 48600
global alignmend at 48700
global alignmend at 48800
global alignmend at 48900
global alignmend at 49000
global alignmend at 49100
global alignmend at 49200
global alignmend at 49300
global alignmend at 49400
global alignmend at 49500
global alignmend at 49600
global alignmend at 49700
global alignmend at 49800
global alignmend at 49900
global alignmend at 50000
global alignmend at 50100
global alignmend at 50200
New alignment, Event number 50300, insertions [1, 1, 1, 0, 1], updates [0, 0, 1, -1]
global alignmend at 50400
global alignmend at 50500
global alignmend at 50600
global alignmend at 50700
global alignmend at 50800
global alignmend at 50900
global alignmend at 51000
global alignmend at 51100
global alignmend at 51200
global alignmend at 51300
global alignmend at 51400
global alignmend at 51500
global alignmend at 51600
global alignmend at 51700
global alignmend at 51800
global alignmend at 51900
global alignmend at 52000
global alignmend at 52100
global alignmend at 52200
global alignmend at 52300
global alignmend at 52400
global alignmend at 52500
global alignmend at 52600
global alignmend at 52700
global alignmend at 52800
global alignmend at 52900
global alignmend at 53000
global alignmend at 53100
global alignmend at 53200
global alignmend at 53300
global alignmend at 53400
global alignmend at 53500
global alignmend at 53600
global alignmend at 53700
global alignmend at 53800
global alignmend at 53900
global alignmend at 54000
global alignmend at 54100
global alignmend at 54200
New alignment, Event number 54300, insertions [0, 1, 1, 0, 0], updates [-1, 0, 1, 0]
global alignmend at 54400
global alignmend at 54500
global alignmend at 54600
global alignmend at 54700
global alignmend at 54800
global alignmend at 54900
global alignmend at 55000
global alignmend at 55100
global alignmend at 55200
global alignmend at 55300
global alignmend at 55400
global alignmend at 55500
global alignmend at 55600
global alignmend at 55700
global alignmend at 55800
global alignmend at 55900
global alignmend at 56000
global alignmend at 56100
global alignmend at 56200
global alignmend at 56300
global alignmend at 56400
global alignmend at 56500
global alignmend at 56600
global alignmend at 56700
global alignmend at 56800
global alignmend at 56900
global alignmend at 57000
global alignmend at 57100
global alignmend at 57200
global alignmend at 57300
global alignmend at 57400
global alignmend at 57500
global alignmend at 57600
global alignmend at 57700
global alignmend at 57800
global alignmend at 57900
global alignmend at 58000
global alignmend at 58100
global alignmend at 58200
global alignmend at 58300
global alignmend at 58400
global alignmend at 58500
global alignmend at 58600
global alignmend at 58700
global alignmend at 58800
global alignmend at 58900
global alignmend at 59000
global alignmend at 59100
global alignmend at 59200
global alignmend at 59300
global alignmend at 59400
global alignmend at 59500
global alignmend at 59600
global alignmend at 59700
global alignmend at 59800
global alignmend at 59900
global alignmend at 60000
global alignmend at 60100
global alignmend at 60200
global alignmend at 60300
global alignmend at 60400
global alignmend at 60500
global alignmend at 60600
global alignmend at 60700
global alignmend at 60800
global alignmend at 60900
global alignmend at 61000
global alignmend at 61100
global alignmend at 61200
global alignmend at 61300
global alignmend at 61400
global alignmend at 61500
global alignmend at 61600
global alignmend at 61700
global alignmend at 61800
global alignmend at 61900
global alignmend at 62000
global alignmend at 62100
global alignmend at 62200
global alignmend at 62300
global alignmend at 62400
global alignmend at 62500
global alignmend at 62600
global alignmend at 62700
global alignmend at 62800
global alignmend at 62900
global alignmend at 63000
global alignmend at 63100
global alignmend at 63200
global alignmend at 63300
global alignmend at 63400
global alignmend at 63500
global alignmend at 63600
global alignmend at 63700
global alignmend at 63800
global alignmend at 63900
global alignmend at 64000
global alignmend at 64100
global alignmend at 64200
global alignmend at 64300
global alignmend at 64400
global alignmend at 64500
global alignmend at 64600
global alignmend at 64700
global alignmend at 64800
global alignmend at 64900
global alignmend at 65000
global alignmend at 65100
global alignmend at 65200
global alignmend at 65300
global alignmend at 65400
global alignmend at 65500
global alignmend at 65600
global alignmend at 65700
global alignmend at 65800
global alignmend at 65900
global alignmend at 66000
global alignmend at 66100
global alignmend at 66200
global alignmend at 66300
global alignmend at 66400
global alignmend at 66500
global alignmend at 66600
global alignmend at 66700
global alignmend at 66800
global alignmend at 66900
global alignmend at 67000
global alignmend at 67100
global alignmend at 67200
global alignmend at 67300
global alignmend at 67400
global alignmend at 67500
global alignmend at 67600
global alignmend at 67700
global alignmend at 67800
global alignmend at 67900
global alignmend at 68000
global alignmend at 68100
global alignmend at 68200
global alignmend at 68300
global alignmend at 68400
global alignmend at 68500
global alignmend at 68600
global alignmend at 68700
global alignmend at 68800
global alignmend at 68900
global alignmend at 69000
global alignmend at 69100
global alignmend at 69200
global alignmend at 69300
global alignmend at 69400
global alignmend at 69500
global alignmend at 69600
global alignmend at 69700
global alignmend at 69800
global alignmend at 69900
global alignmend at 70000
global alignmend at 70100
global alignmend at 70200
global alignmend at 70300
global alignmend at 70400
global alignmend at 70500
global alignmend at 70600
global alignmend at 70700
global alignmend at 70800
global alignmend at 70900
global alignmend at 71000
global alignmend at 71100
global alignmend at 71200
global alignmend at 71300
global alignmend at 71400
global alignmend at 71500
global alignmend at 71600
global alignmend at 71700
global alignmend at 71800
global alignmend at 71900
global alignmend at 72000
global alignmend at 72100
global alignmend at 72200
global alignmend at 72300
global alignmend at 72400
global alignmend at 72500
global alignmend at 72600
global alignmend at 72700
global alignmend at 72800
New alignment, Event number 73000, insertions [1, 0, 0, 1, 0], updates [1, 0, -1, 1]
global alignmend at 73100
global alignmend at 73200
global alignmend at 73300
global alignmend at 73400
global alignmend at 73500
global alignmend at 73600
global alignmend at 73700
global alignmend at 73800
global alignmend at 73900
global alignmend at 74000
global alignmend at 74100
global alignmend at 74200
global alignmend at 74300
global alignmend at 74400
global alignmend at 74500
global alignmend at 74600
global alignmend at 74700
global alignmend at 74800
global alignmend at 74900
global alignmend at 75000
global alignmend at 75100
global alignmend at 75200
global alignmend at 75300
global alignmend at 75400
global alignmend at 75500
global alignmend at 75600
global alignmend at 75700
global alignmend at 75800
global alignmend at 75900
global alignmend at 76000
global alignmend at 76100
global alignmend at 76200
global alignmend at 76300
global alignmend at 76400
global alignmend at 76500
global alignmend at 76600
global alignmend at 76700
global alignmend at 76800
global alignmend at 76900
global alignmend at 77000
global alignmend at 77100
global alignmend at 77200
global alignmend at 77300
global alignmend at 77400
global alignmend at 77500
global alignmend at 77600
global alignmend at 77700
global alignmend at 77800
global alignmend at 77900
global alignmend at 78000
global alignmend at 78100
global alignmend at 78200
global alignmend at 78300
global alignmend at 78400
global alignmend at 78500
global alignmend at 78600
global alignmend at 78700
global alignmend at 78800
global alignmend at 78900
global alignmend at 79000
global alignmend at 79100
global alignmend at 79200
global alignmend at 79300
global alignmend at 79400
global alignmend at 79500
global alignmend at 79600
global alignmend at 79700
global alignmend at 79800
global alignmend at 79900
global alignmend at 80000
global alignmend at 80100
global alignmend at 80200
global alignmend at 80300
global alignmend at 80400
global alignmend at 80500
global alignmend at 80600
global alignmend at 80700
global alignmend at 80800
global alignmend at 80900
global alignmend at 81000
global alignmend at 81100
global alignmend at 81200
global alignmend at 81300
global alignmend at 81400
global alignmend at 81500
global alignmend at 81600
global alignmend at 81700
global alignmend at 81800
global alignmend at 81900
global alignmend at 82000
global alignmend at 82100
global alignmend at 82200
global alignmend at 82300
global alignmend at 82400
global alignmend at 82500
global alignmend at 82600
global alignmend at 82700
global alignmend at 82800
global alignmend at 82900
global alignmend at 83000
global alignmend at 83100
global alignmend at 83200
global alignmend at 83300
global alignmend at 83400
global alignmend at 83500
global alignmend at 83600
global alignmend at 83700
global alignmend at 83800
global alignmend at 83900
global alignmend at 84000
global alignmend at 84100
global alignmend at 84200
global alignmend at 84300
global alignmend at 84400
global alignmend at 84500
global alignmend at 84600
global alignmend at 84700
global alignmend at 84800
global alignmend at 84900
global alignmend at 85000
global alignmend at 85100
global alignmend at 85200
global alignmend at 85300
global alignmend at 85400
global alignmend at 85500
global alignmend at 85600
global alignmend at 85700
global alignmend at 85800
global alignmend at 85900
global alignmend at 86000
global alignmend at 86100
global alignmend at 86200
global alignmend at 86300
global alignmend at 86400
global alignmend at 86500
global alignmend at 86600
global alignmend at 86700
global alignmend at 86800
global alignmend at 86900
global alignmend at 87000
global alignmend at 87100
global alignmend at 87200
global alignmend at 87300
global alignmend at 87400
global alignmend at 87500
New alignment, Event number 87600, insertions [0, 0, 0, 1, 1], updates [0, 0, -1, 0]
New alignment, Event number 87700, insertions [1, 1, 1, 1, 0], updates [0, 0, 0, 1]
global alignmend at 87800
global alignmend at 87900
global alignmend at 88000
global alignmend at 88100
global alignmend at 88200
global alignmend at 88300
global alignmend at 88400
global alignmend at 88500
global alignmend at 88600
global alignmend at 88700
global alignmend at 88800
global alignmend at 88900
global alignmend at 89000
global alignmend at 89100
global alignmend at 89200
global alignmend at 89300
global alignmend at 89400
global alignmend at 89500
global alignmend at 89600
global alignmend at 89700
global alignmend at 89800
global alignmend at 89900
global alignmend at 90000
global alignmend at 90100
global alignmend at 90200
global alignmend at 90300
global alignmend at 90400
global alignmend at 90500
global alignmend at 90600
global alignmend at 90700
global alignmend at 90800
global alignmend at 90900
global alignmend at 91000
global alignmend at 91100
global alignmend at 91200
global alignmend at 91300
global alignmend at 91400
global alignmend at 91500
global alignmend at 91600
global alignmend at 91700
global alignmend at 91800
global alignmend at 91900
global alignmend at 92000
global alignmend at 92100
global alignmend at 92200
global alignmend at 92300
global alignmend at 92400
global alignmend at 92500
global alignmend at 92600
global alignmend at 92700
global alignmend at 92800
global alignmend at 92900
global alignmend at 93000
global alignmend at 93100
global alignmend at 93200
global alignmend at 93300
global alignmend at 93400
global alignmend at 93500
global alignmend at 93600
New alignment, Event number 93700, insertions [0, 0, 1, 0, 0], updates [0, -1, 1, 0]
global alignmend at 93800
global alignmend at 93900
global alignmend at 94000
global alignmend at 94100
global alignmend at 94200
global alignmend at 94300
global alignmend at 94400
global alignmend at 94500
global alignmend at 94600
global alignmend at 94700
global alignmend at 94800
global alignmend at 94900
global alignmend at 95000
global alignmend at 95100
global alignmend at 95200
global alignmend at 95300
global alignmend at 95400
global alignmend at 95500
global alignmend at 95600
global alignmend at 95700
global alignmend at 95800
global alignmend at 95900
global alignmend at 96000
global alignmend at 96100
global alignmend at 96200
global alignmend at 96300
global alignmend at 96400
global alignmend at 96500
global alignmend at 96600
global alignmend at 96700
global alignmend at 96800
global alignmend at 96900
global alignmend at 97000
global alignmend at 97100
global alignmend at 97200
global alignmend at 97300
global alignmend at 97400
global alignmend at 97500
global alignmend at 97600
global alignmend at 97700
global alignmend at 97800
global alignmend at 97900
global alignmend at 98000
global alignmend at 98100
global alignmend at 98200
global alignmend at 98300
global alignmend at 98400
global alignmend at 98500
global alignmend at 98600
global alignmend at 98700
global alignmend at 98800
global alignmend at 98900
global alignmend at 99000
global alignmend at 99100
global alignmend at 99200
global alignmend at 99300
global alignmend at 99400
global alignmend at 99500
global alignmend at 99600
global alignmend at 99700
global alignmend at 99800
global alignmend at 99900
global alignmend at 100000</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tof <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dT <span class="kw">in</span> rAligner.dT:</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        tof[i].append(dT[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> opt</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gauss(x, a, mu, sigma):</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> np.exp(<span class="op">-</span>(x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>rpc_indicies <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>], [<span class="dv">4</span>,<span class="dv">5</span>]]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting individual histograms and Gaussian fits</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    mid_average <span class="op">=</span> np.mean(tof[i])</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Mid average value for RPC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">-5: </span><span class="sc">{</span>mid_average<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform Gaussian fit</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    hist, bin_edges <span class="op">=</span> np.histogram(tof[i], bins<span class="op">=</span><span class="dv">300</span>, <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    bin_centers <span class="op">=</span> (bin_edges[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> bin_edges[<span class="dv">1</span>:]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        popt, pcov <span class="op">=</span> opt.curve_fit(gauss, bin_centers, hist, p0<span class="op">=</span>[<span class="bu">max</span>(hist), <span class="dv">0</span>, <span class="dv">10</span>])</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot histogram with Gaussian fit</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        plt.figure()</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        plt.hist(tof[i], bins<span class="op">=</span><span class="dv">1000</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>        x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1000</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        y_fit <span class="op">=</span> gauss(x_fit, <span class="op">*</span>popt)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>        plt.plot(x_fit, y_fit, <span class="st">'r-'</span>, label<span class="op">=</span><span class="st">'Gaussian fit'</span>)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Systematically and tof Corrected, RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'tof / ns'</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'events'</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Annotate the plot with Gaussian fit parameters</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>        fit_params_text <span class="op">=</span> <span class="ss">f'Amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Std Dev = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>        plt.annotate(fit_params_text, xy<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), xycoords<span class="op">=</span><span class="st">'axes fraction'</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Show plot</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit parameters for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">: amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, std deviation = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">RuntimeError</span>:</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit failed for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting combined pseudograph for Gaussian fits</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>    hist, bin_edges <span class="op">=</span> np.histogram(tof[i], bins<span class="op">=</span><span class="dv">100</span>, <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>    bin_centers <span class="op">=</span> (bin_edges[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> bin_edges[<span class="dv">1</span>:]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>        popt, pcov <span class="op">=</span> opt.curve_fit(gauss, bin_centers, hist, p0<span class="op">=</span>[<span class="bu">max</span>(hist), <span class="dv">0</span>, <span class="dv">10</span>])</span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>        x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1000</span>)</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>        y_fit <span class="op">=</span> gauss(x_fit, <span class="op">*</span>popt)</span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>        plt.plot(x_fit, y_fit, label<span class="op">=</span><span class="ss">f'RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss"> fit'</span>)</span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">RuntimeError</span>:</span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Gaussian fit failed for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Combined Gaussian Fits for RPC0-5 to RPC4-5'</span>)</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'tof / ns'</span>)</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'events'</span>)</span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Show combined fit plot</span></span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mid average value for RPC0-5: 1.3567527415472156</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 1]: amplitude = 433.91825405082756, mean = 1.1879070331451431, std deviation = 1.0064261388619589
Mid average value for RPC1-5: 1.0081501490744862</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 2]: amplitude = 449.7320723198423, mean = 0.7238451130435709, std deviation = -0.9708539097213003
Mid average value for RPC2-5: 3.777692656443649</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 3]: amplitude = 267.08460918162683, mean = 3.385701398486754, std deviation = 1.6654607352451358
Mid average value for RPC3-5: 7.089086962541097</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 4]: amplitude = 155.66139241640974, mean = 7.177240726093822, std deviation = 2.921301631339286
Mid average value for RPC4-5: 7.484869590466341</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[0, 5]: amplitude = 158.07552471853342, mean = 7.280717962867561, std deviation = 2.8820375039484656
Mid average value for RPC5-5: 0.3957826279252454</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC[4, 5]: amplitude = 454.3555155050978, mean = 0.12132453175574043, std deviation = -0.9504172901741453</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-32-output-14.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gauss(x, a, mu, sigma):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> np.exp(<span class="op">-</span>(x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into 5 chunks (20% each)</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_into_chunks(data, num_chunks<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    chunk_size <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">//</span> num_chunks</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [data[i<span class="op">*</span>chunk_size:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>chunk_size] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_chunks)]</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>rpc_indicies <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">2</span>], [<span class="dv">0</span>,<span class="dv">3</span>], [<span class="dv">0</span>,<span class="dv">4</span>], [<span class="dv">0</span>,<span class="dv">5</span>], [<span class="dv">4</span>,<span class="dv">5</span>]]</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting individual histograms and Gaussian fits for each chunk</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the data into 5 chunks</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    tof_chunks <span class="op">=</span> split_into_chunks(tof[i])</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chunk_index, chunk <span class="kw">in</span> <span class="bu">enumerate</span>(tof_chunks):</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>        mid_average <span class="op">=</span> np.mean(chunk)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Mid average value for RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">, chunk</span><span class="sc">{</span>chunk_index <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mid_average<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform Gaussian fit</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>        hist, bin_edges <span class="op">=</span> np.histogram(chunk, bins<span class="op">=</span><span class="dv">300</span>, <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>        bin_centers <span class="op">=</span> (bin_edges[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> bin_edges[<span class="dv">1</span>:]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>            popt, pcov <span class="op">=</span> opt.curve_fit(gauss, bin_centers, hist, p0<span class="op">=</span>[<span class="bu">max</span>(hist), <span class="dv">0</span>, <span class="dv">10</span>])</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Plot histogram with Gaussian fit</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>            plt.figure()</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>            plt.hist(chunk, bins<span class="op">=</span><span class="dv">1000</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="st">'Data'</span>)</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>            x_fit <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">1000</span>)</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>            y_fit <span class="op">=</span> gauss(x_fit, <span class="op">*</span>popt)</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>            plt.plot(x_fit, y_fit, <span class="st">'r-'</span>, label<span class="op">=</span><span class="st">'Gaussian fit'</span>)</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f'Systematically and tof Corrected, RPC</span><span class="sc">{</span>rpc_indicies[i]<span class="sc">}</span><span class="ss">, chunk</span><span class="sc">{</span>chunk_index <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>            plt.xlim(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>)</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'tof / ns'</span>)</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'events'</span>)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Annotate the plot with Gaussian fit parameters</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>            fit_params_text <span class="op">=</span> <span class="ss">f'Amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">Std Dev = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>            plt.annotate(fit_params_text, xy<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), xycoords<span class="op">=</span><span class="st">'axes fraction'</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Show plot</span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Gaussian fit parameters for RPC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>chunk_index <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: amplitude = </span><span class="sc">{</span>popt[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, mean = </span><span class="sc">{</span>popt[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, std deviation = </span><span class="sc">{</span>popt[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">RuntimeError</span>:</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Gaussian fit failed for RPC</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>chunk_index <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting combined pseudograph for Gaussian fits in chunks</span></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a><span class="co"># for chunk_index in range(5):</span></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.figure()</span></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     for i in range(5):</span></span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a><span class="co">#         tof_chunks = split_into_chunks(tof[i])</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a><span class="co">#         chunk = tof_chunks[chunk_index]</span></span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="co">#         hist, bin_edges = np.histogram(chunk, bins=100, range=(-20, 20))</span></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a><span class="co">#         bin_centers = (bin_edges[:-1] + bin_edges[1:]) / 2</span></span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a><span class="co">#         try:</span></span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a><span class="co">#             popt, pcov = opt.curve_fit(gauss, bin_centers, hist, p0=[max(hist), 0, 10])</span></span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a><span class="co">#             x_fit = np.linspace(-20, 40, 1000)</span></span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a><span class="co">#             y_fit = gauss(x_fit, *popt)</span></span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a><span class="co">#             plt.plot(x_fit, y_fit, label=f'RPC{i}-{chunk_index + 1} fit')</span></span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a><span class="co">#         except RuntimeError:</span></span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a><span class="co">#             print(f'Gaussian fit failed for RPC{i}-{chunk_index + 1}')</span></span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.title(f'Combined Gaussian Fits for RPCs in Chunk {chunk_index + 1}')</span></span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.xlim(-20, 40)</span></span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.xlabel('tof / ns')</span></span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.ylabel('events')</span></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.legend()</span></span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Show combined fit plot</span></span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mid average value for RPC[0, 1], chunk1: 1.4058177057987733</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-1: amplitude = 44.048017654695364, mean = 1.21255465663703, std deviation = 0.980585197090859
Mid average value for RPC[0, 1], chunk2: 1.2078445992424682</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-2: amplitude = 40.55574967938813, mean = 1.0805878614258266, std deviation = 1.093391576727782
Mid average value for RPC[0, 1], chunk3: 1.3757437094479563</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-3: amplitude = 45.735932487886956, mean = 1.2958376463852865, std deviation = 0.954379129824469
Mid average value for RPC[0, 1], chunk4: 1.4811520793030826</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-4: amplitude = 39.639683595303126, mean = 1.2238132755989288, std deviation = 1.1179248638647468
Mid average value for RPC[0, 1], chunk5: 1.3454594796233317</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-5: amplitude = 46.720550844353134, mean = 1.1453649040323153, std deviation = -0.9286201683552135
Mid average value for RPC[0, 1], chunk6: 1.4066234682105885</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-6: amplitude = 43.51903505232616, mean = 1.3236807479099133, std deviation = 0.9929300449823758
Mid average value for RPC[0, 1], chunk7: 1.16633285444106</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-14.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-7: amplitude = 48.60158797029619, mean = 1.0855200386425088, std deviation = -0.8564507562518272
Mid average value for RPC[0, 1], chunk8: 1.3963486624492842</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-16.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-8: amplitude = 43.57845206340541, mean = 1.2759662394104743, std deviation = 1.0076352306918517
Mid average value for RPC[0, 1], chunk9: 1.2404808130382692</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-18.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-9: amplitude = 43.83963082610338, mean = 1.1665486577125947, std deviation = 0.9968999823703297
Mid average value for RPC[0, 1], chunk10: 1.5406708497798403</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-20.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC0-10: amplitude = 42.52153291524663, mean = 1.059075848173421, std deviation = -1.0280843238837107
Mid average value for RPC[0, 2], chunk1: 0.9278142130944926</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-22.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-1: amplitude = 45.316395816920526, mean = 0.7501107418723312, std deviation = -0.9763907053279727
Mid average value for RPC[0, 2], chunk2: 0.8062570950455955</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-24.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-2: amplitude = 45.623821970102455, mean = 0.6528722102046421, std deviation = -0.9450324923773307
Mid average value for RPC[0, 2], chunk3: 0.9503423399551807</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-26.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-3: amplitude = 43.80691139416113, mean = 0.8228019520798083, std deviation = -1.0043516064097784
Mid average value for RPC[0, 2], chunk4: 1.170744617524817</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-28.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-4: amplitude = 43.6146510877364, mean = 0.7192123707731622, std deviation = -1.0087101916086105
Mid average value for RPC[0, 2], chunk5: 1.2257075741087666</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-30.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-5: amplitude = 42.382153548794854, mean = 0.6543809568276415, std deviation = -1.026623246058593
Mid average value for RPC[0, 2], chunk6: 0.9961545403198782</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-32.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-6: amplitude = 47.882876591523114, mean = 0.7990748876190221, std deviation = -0.9124141589663483
Mid average value for RPC[0, 2], chunk7: 0.7860357466811874</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-34.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-7: amplitude = 46.108865663178214, mean = 0.5718121250771027, std deviation = -0.9471835090162367
Mid average value for RPC[0, 2], chunk8: 1.070149062031165</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-36.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-8: amplitude = 47.48256951499323, mean = 0.7938320246299178, std deviation = -0.9173457036950954
Mid average value for RPC[0, 2], chunk9: 1.099926572178739</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-38.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-9: amplitude = 44.562760633475214, mean = 0.7680431359623425, std deviation = -0.9658487599272213
Mid average value for RPC[0, 2], chunk10: 1.0463941309967337</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-40.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC1-10: amplitude = 45.401020223613855, mean = 0.6831314536569623, std deviation = -0.9517009438754187
Mid average value for RPC[0, 3], chunk1: 2.6398184600375925</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-42.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-1: amplitude = 40.834862466208016, mean = 2.376553005525066, std deviation = 0.9378638669145147
Mid average value for RPC[0, 3], chunk2: 3.7780657836724125</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-44.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-2: amplitude = 26.988844233762006, mean = 3.1667909482841967, std deviation = 1.6419883909767972
Mid average value for RPC[0, 3], chunk3: 3.86003301067487</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-46.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-3: amplitude = 27.1797099829165, mean = 3.6888219468067693, std deviation = 1.6680119410408274
Mid average value for RPC[0, 3], chunk4: 4.112685856914103</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-48.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-4: amplitude = 26.702163411045508, mean = 3.589685275563667, std deviation = 1.6846536254915412
Mid average value for RPC[0, 3], chunk5: 4.109370700452331</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-50.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-5: amplitude = 27.50717175396855, mean = 3.5569760826338697, std deviation = 1.6297901017294099
Mid average value for RPC[0, 3], chunk6: 3.783825306017179</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-52.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-6: amplitude = 25.909745491119512, mean = 3.6650201700765503, std deviation = 1.737174019425755
Mid average value for RPC[0, 3], chunk7: 3.7516266013336574</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-54.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-7: amplitude = 27.329620155709158, mean = 3.7066264452794444, std deviation = 1.6599188810142833
Mid average value for RPC[0, 3], chunk8: 4.013274314824228</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-56.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-8: amplitude = 27.18155004277642, mean = 3.6688186362142865, std deviation = 1.6524084062328497
Mid average value for RPC[0, 3], chunk9: 3.9235712505279245</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-58.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-9: amplitude = 27.511297668383474, mean = 3.4794123236112617, std deviation = 1.6162437036193897
Mid average value for RPC[0, 3], chunk10: 3.802421227508014</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-60.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC2-10: amplitude = 28.411759467022183, mean = 3.3397793585577364, std deviation = 1.5651385667748217
Mid average value for RPC[0, 4], chunk1: 3.766491672780283</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-62.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-1: amplitude = 34.771934964034735, mean = 5.110284305373043, std deviation = 1.0996777387236147
Mid average value for RPC[0, 4], chunk2: 6.890068741768118</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-64.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-2: amplitude = 16.019723129817972, mean = 6.770642772658111, std deviation = 2.809094699931075
Mid average value for RPC[0, 4], chunk3: 7.7518622048626895</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-66.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-3: amplitude = 15.487109410450195, mean = 7.810476723174787, std deviation = 3.0126484912781386
Mid average value for RPC[0, 4], chunk4: 7.601860894576357</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-68.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-4: amplitude = 15.4202303674915, mean = 7.545129988536811, std deviation = 2.9802812375443417
Mid average value for RPC[0, 4], chunk5: 7.393041063640259</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-70.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-5: amplitude = 16.602056072000334, mean = 7.606741334671303, std deviation = 2.762194051835786
Mid average value for RPC[0, 4], chunk6: 7.4412494537913325</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-72.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-6: amplitude = 16.231262773757134, mean = 7.663324059200415, std deviation = 2.8225476872171273
Mid average value for RPC[0, 4], chunk7: 7.527226670453362</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-74.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-7: amplitude = 15.391248067584062, mean = 7.70093436741373, std deviation = 3.021529633660337
Mid average value for RPC[0, 4], chunk8: 7.601718371333102</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-76.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-8: amplitude = 15.744784204542697, mean = 7.7697605544524695, std deviation = 2.9407818725143824
Mid average value for RPC[0, 4], chunk9: 7.435019135451168</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-78.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-9: amplitude = 16.172246837368096, mean = 7.489794261447344, std deviation = 2.8622253947215754
Mid average value for RPC[0, 4], chunk10: 7.474552747753439</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-80.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC3-10: amplitude = 16.333541239925424, mean = 7.347394053801035, std deviation = 2.796866740980333
Mid average value for RPC[0, 5], chunk1: 4.575466539215051</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-82.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-1: amplitude = 36.01767472802266, mean = 5.351892953922077, std deviation = 1.0410421787243462
Mid average value for RPC[0, 5], chunk2: 7.415093096141214</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-84.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-2: amplitude = 16.533939472502524, mean = 6.819406437005716, std deviation = 2.7384668448649108
Mid average value for RPC[0, 5], chunk3: 7.9146149798381265</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-86.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-3: amplitude = 15.724509779991369, mean = 7.91323588483852, std deviation = 2.952724856932011
Mid average value for RPC[0, 5], chunk4: 8.121422166473689</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-88.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-4: amplitude = 15.595567556962754, mean = 7.772991035294128, std deviation = 2.9404284681288306
Mid average value for RPC[0, 5], chunk5: 7.808977095149412</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-90.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-5: amplitude = 16.130627439992516, mean = 7.626500315968196, std deviation = 2.860665896065875
Mid average value for RPC[0, 5], chunk6: 7.935540066353239</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-92.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-6: amplitude = 16.151180724522327, mean = 7.8194321681677526, std deviation = 2.841213269102938
Mid average value for RPC[0, 5], chunk7: 7.8350833918411675</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-94.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-7: amplitude = 15.823813868950413, mean = 7.810006833300286, std deviation = 2.953242905790239
Mid average value for RPC[0, 5], chunk8: 7.815366155604801</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-96.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-8: amplitude = 15.716082304322642, mean = 7.843025712044254, std deviation = 2.9410039891191584
Mid average value for RPC[0, 5], chunk9: 7.786004195021803</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-98.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-9: amplitude = 16.49024343143823, mean = 7.5908007296116295, std deviation = 2.8156232191125192
Mid average value for RPC[0, 5], chunk10: 7.634434318648517</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-100.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC4-10: amplitude = 16.893775423839244, mean = 7.351464099819346, std deviation = 2.7229195797397785
Mid average value for RPC[4, 5], chunk1: 0.8089748664347677</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-102.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-1: amplitude = 42.33092067657133, mean = 0.1451777290977611, std deviation = -0.998134718023565
Mid average value for RPC[4, 5], chunk2: 0.525024354373094</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-104.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-2: amplitude = 44.802663955356486, mean = 0.07572140737887205, std deviation = -0.9642287325684191
Mid average value for RPC[4, 5], chunk3: 0.16275277497543839</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-106.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-3: amplitude = 45.67797759501344, mean = 0.11675206346292748, std deviation = -0.956108354761423
Mid average value for RPC[4, 5], chunk4: 0.5195612718973308</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-108.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-4: amplitude = 43.28765305241532, mean = 0.13342289622630815, std deviation = -0.9996873318670364
Mid average value for RPC[4, 5], chunk5: 0.41593603150915365</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-110.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-5: amplitude = 44.26751205376873, mean = 0.10620342073167634, std deviation = -0.9823643447855452
Mid average value for RPC[4, 5], chunk6: 0.49429061256190715</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-112.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-6: amplitude = 47.243890259219164, mean = 0.14389079720273223, std deviation = -0.8977311757204729
Mid average value for RPC[4, 5], chunk7: 0.30785672138780557</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-114.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-7: amplitude = 47.65786110595114, mean = 0.12935621533901284, std deviation = -0.9023653810888358
Mid average value for RPC[4, 5], chunk8: 0.2136477842716997</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-116.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-8: amplitude = 46.21857452264595, mean = 0.07434950903910194, std deviation = -0.9272165205115687
Mid average value for RPC[4, 5], chunk9: 0.3509850595706351</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-118.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-9: amplitude = 47.89342043202622, mean = 0.18021330519631626, std deviation = -0.906476044475071
Mid average value for RPC[4, 5], chunk10: 0.15988157089507907</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-33-output-120.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian fit parameters for RPC5-10: amplitude = 45.811800534907995, mean = 0.11388463008037122, std deviation = -0.9614045671107456</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>Test_coord <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> recon <span class="kw">in</span> rAligner.recon:</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    distance_per_phi_channel <span class="op">=</span> <span class="fl">2.7625</span> <span class="co">#cm</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    distance_per_eta_channel <span class="op">=</span> <span class="fl">2.9844</span> <span class="co">#cm</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>        recon[<span class="dv">2</span>][i][<span class="dv">0</span>] <span class="op">=</span> <span class="bu">int</span>(recon[<span class="dv">2</span>][i][<span class="dv">0</span>] <span class="op">/</span> distance_per_phi_channel)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>        recon[<span class="dv">2</span>][i][<span class="dv">1</span>] <span class="op">=</span> <span class="bu">int</span>(recon[<span class="dv">2</span>][i][<span class="dv">1</span>] <span class="op">/</span> distance_per_eta_channel)</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>        Test_coord[i].append([recon[<span class="dv">2</span>][i][<span class="dv">0</span>], recon[<span class="dv">2</span>][i][<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>Coordinate <span class="op">=</span> {<span class="dv">0</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)], </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>              <span class="dv">4</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)],</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>                <span class="dv">5</span>:[[[] <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]}</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>scDiffs <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>normDiffs <span class="op">=</span> [[<span class="dv">0</span> <span class="cf">for</span> etchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)] <span class="cf">for</span> phchan <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>)]</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>rpcNames <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Triplet Low"</span>,<span class="dv">1</span>: <span class="st">"Triplet Mid"</span>, <span class="dv">2</span>:<span class="st">"Triplet Top"</span>, <span class="dv">3</span>:<span class="st">"Singlet"</span>,<span class="dv">4</span>:<span class="st">"Doublet Low"</span>,<span class="dv">5</span>:<span class="st">"Doublet Top"</span>}</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tof[<span class="dv">0</span>])):</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>        Coordinate[j <span class="op">+</span> <span class="dv">1</span>][Test_coord[j <span class="op">+</span> <span class="dv">1</span>][i][<span class="dv">0</span>]][Test_coord[j <span class="op">+</span> <span class="dv">1</span>][i][<span class="dv">1</span>]].append(tof[j][i])</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> rpc <span class="kw">in</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]:</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ph <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">64</span>):</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> et <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>):</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if sum(width[rpc][ph][et].counts())&gt;0:</span></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>                scDiffs[ph][et]<span class="op">=</span>np.mean(Coordinate[rpc][ph][et])</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>    etachannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">33</span>)]</span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>    phichannels <span class="op">=</span> [x<span class="op">-</span><span class="fl">0.5</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">65</span>)]</span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>    etaHist <span class="op">=</span> (scDiffs,np.array(phichannels),np.array(etachannels))</span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>    zrange <span class="op">=</span> [<span class="op">-</span><span class="dv">20</span>,<span class="dv">30</span>]</span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>    thisHist <span class="op">=</span> hep.hist2dplot(etaHist,norm<span class="op">=</span>colors.Normalize(zrange[<span class="dv">0</span>],zrange[<span class="dv">1</span>]))</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>    thisHist.cbar.set_label(<span class="st">'tof with 0 as reference'</span>, rotation<span class="op">=</span><span class="dv">270</span>, y<span class="op">=</span><span class="fl">0.1</span>,labelpad<span class="op">=</span><span class="dv">23</span>)</span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="fl">31.5</span>,<span class="op">-</span><span class="fl">0.5</span>)</span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Eta Channel"</span>)</span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Phi Channel"</span>)</span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>    ax.set_title(rpcNames[rpc])</span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>    x_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">64.5</span>]</span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a>    y_points <span class="op">=</span> [<span class="fl">7.5</span>, <span class="fl">15.5</span>, <span class="fl">23.5</span>]</span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y_point <span class="kw">in</span> y_points:</span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a>        plt.plot(x_points, [y_point,y_point], <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a>    y_points <span class="op">=</span> [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">31.5</span>]</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a>    x_points <span class="op">=</span> [<span class="fl">7.5</span>,<span class="fl">15.5</span>, <span class="fl">23.5</span>, <span class="fl">31.5</span>, <span class="fl">39.5</span>, <span class="fl">47.5</span>, <span class="fl">55.5</span>]</span>
<span id="cb141-39"><a href="#cb141-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x_point <span class="kw">in</span> x_points:</span>
<span id="cb141-40"><a href="#cb141-40" aria-hidden="true" tabindex="-1"></a>        plt.plot([x_point,x_point], y_points, <span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb141-41"><a href="#cb141-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\Peter\AppData\Local\Programs\Python\Python312\Lib\site-packages\numpy\_core\fromnumeric.py:3596: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
c:\Users\Peter\AppData\Local\Programs\Python\Python312\Lib\site-packages\numpy\_core\_methods.py:138: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-35-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-35-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-35-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-35-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: &lt;class 'uhi.numpy_plottable.NumPyPlottableHistogram'&gt; is not allowed to get flow bins, flow bin option set to None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="16072024%20copy%203_files/figure-html/cell-35-output-11.png" class="img-fluid"></p>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>